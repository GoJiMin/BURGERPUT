"use strict";(self.webpackChunkzenput_mobile=self.webpackChunkzenput_mobile||[]).push([[584],{"./src/backbone-unorganized/sensors/models.js":function(e,t,i){i.d(t,{gi:function(){return r},Mw:function(){return l},Ze:function(){return _},Uz:function(){return m},eM:function(){return h},we:function(){return g},Sm:function(){return p}});var n=i("./src/backbone-unorganized/shared/forms.js"),s=i("./src/backbone-unorganized/shared/sensors/models.js"),o=i("./src/backbone-unorganized/sensors/sensors.js"),a=function(){return a=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},a.apply(this,arguments)},r=n.Dn.extend({defaults:{value:null,timestamp:null}}),l=n.Dn.extend({defaults:{id:null,name:null,gateway_type:null,battery_level:null,is_online:null,external_key:null,secondary_key:null,account:null,integration:null,manufacturer:null},submodels:{account:s.iv,integration:s.e1},account:null,url:function(){return"/api/v2/sensors/gateways/".concat(this.account.id,"/")},initialize:function(e){e=e||{},$.extend(this,e),this.account||(this.account=$f.mobile.dashboard.get_active_account_or_group())},update_barcode_value:function(e,t){t===$f.mobile.sensors.util.MANUFACTURER.MONNIT?this.set(a(a({},$f.mobile.sensors.util.get_gateway_ids_from_scanner(e)),{manufacturer:t})):this.set(a(a({},$f.mobile.sensors.util.get_info_from_lorawan_barcode(e,!1)),{manufacturer:t}))},set_device_id:function(e){this.set("external_key",e)},get_device_id:function(){return this.get("external_key")},sanitize_device_id:function(){var e=this.get_device_id();this.set_device_id((0,o.ax)(e.toUpperCase()))}}),_=n.DR.extend({model:l,account:null,initialize:function(e,t){t=t||{},$.extend(this,t),this.account||(this.account=$f.mobile.dashboard.get_active_account_or_group())},url:function(){return"/api/v2/sensors/gateways/".concat(this.account.id,"/")}}),c=n.Ds.extend({defaults:$.extend({},n.Ds.prototype.defaults,{order_by:"-date_started",limit:20}),override_default_query_string_attrs:["start","limit","order_by","account_id"],initialize:function(){c.__super__.initialize.apply(this,arguments),this.default_query_string_attrs=this.override_default_query_string_attrs}}),u=n.Dn.extend({defaults:{id:null,name:null}}),d=n.Dn.extend({defaults:{id:null,date_processed:null,date_reading:null,is_active:!0,operator_id:null,reading:null,sensor_reading:null,status:null},get_stage_number:function(){return this.collection.indexOf(this)+1},get_stage_title:function(){return"".concat(_t("mobile_sensors_cooldown_stage")," ").concat(this.get_stage_number())},get_date_reading:function(){return $f.shared.sensors.util.get_formatted_date_for_cooldown(this.get("date_reading"),$f.mobile.dashboard.get_active_account_or_group(),$f.utils.TIME_FMT)},get_duration:function(e){if(e)return $f.mobile.sensors.util.get_duration_between_dates(e.get("date_started"),this.get("date_reading"))}}),f=n.DR.extend({model:d}),m=n.Dn.extend({defaults:{id:null,food:null,stages:null},submodels:{stages:f}}),h=n.Dn.extend({defaults:{id:null,name:null,food:null,status:null,account:null,sensor:null,date_started:null,date_endded:null,stages:null},submodels:{account:s.iv,sensor:u,stages:f},validation:{food:{minLength:1,maxLength:255,msg:function(){return _t("mobile_sensors_cooldown_please_enter_food")},required:!0},sensor:{required:!0,msg:function(){return _t("mobile_sensors_cooldown_please_select_sensor")}}},url:function(){return"/api/v2/sensors/cooldowns/"},get_cooldown_status_for_display:function(){return{in_progress:_t("mobile_sensors_cooldown_status_in_progress"),failed:_t("mobile_sensors_cooldown_status_failed"),success:_t("mobile_sensors_cooldown_status_success")}[this.get("status")]},get_date_started:function(){return $f.shared.sensors.util.get_formatted_date_for_cooldown(this.get("date_started"),this.get("account"),$f.utils.DATE_AND_TIME_FMT)},get_date_ended:function(){return $f.shared.sensors.util.get_formatted_date_for_cooldown(this.get("date_ended"),this.get("account"),$f.utils.DATE_AND_TIME_FMT)},get_duration:function(){return $f.mobile.sensors.util.get_duration_between_dates(this.get("date_started"),this.get("date_ended"))},get_status_title:function(){return this.get("status")===$f.mobile.sensors.util.COOLDOWN_STATUS_FAILED?_t("mobile_sensors_cooldown_failed_cooldown_process"):_t("mobile_sensors_cooldown_cooldown_successful")},get_failing_reading:function(){var e=this.get("stages");if(this.get("status")!==$f.mobile.sensors.util.COOLDOWN_STATUS_SUCCESS&&0!==e.length)return e.last().get("sensor_reading")}}),g=n.DR.extend({model:h,initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator||(this.paginator=new c)},url:function(){return"/api/v2/sensors/cooldowns/?".concat(this.paginator.get_query_string())}}),p=n.Dn.extend({defaults:{location_id:null,recipient_email:null,date_start:null},url:function(){var e=new n.Ds,t=this.get("recipient_email"),i=this.get("date_start");t&&e.set("recipient_email",t),i&&e.set("date_start",i);var s=e.get_query_string({attrs:["recipient_email","date_start"]});return"/api/v2/sensors/export/location/".concat(this.get("location_id"),"/sensor_temp_log_report/?").concat(s)}})},"./src/backbone-unorganized/sensors/sensors.js":function(e,t,i){i.d(t,{In:function(){return a},Nz:function(){return r},ax:function(){return l},GB:function(){return c}});var n={util:{BATTERY_LEVEL:{DEAD:"dead",FULL:"full",GOOD:"good",LOW:"low"},ERROR_CODES:{NO_INTEGRATION:"NO_INTEGRATION",NO_LOGIN:"NO_LOGIN"},DECIMAL_PLACES:1,COOLDOWN_PROCESS_TEMPERATURE:{STAGE_ONE_STARTING:140,STAGE_ONE_ENDING:70,STAGE_TWO_ENDING:41},COOLDOWN_STATUS_FAILED:"failed",COOLDOWN_STATUS_IN_PROGRESS:"in_progress",COOLDOWN_STATUS_SUCCESS:"success",MANUFACTURER:{MONNIT:"monnit",LAIRD:"laird",RADIOBRIDGE:"radiobridge"},INTEGRATION_TYPE:{SENET:"senet",MONNIT:"monnit",TEMPALERT:"tempalert",DIGI:"digi"},convert_gateway_battery_percent_to_battery_level:function(e){e=parseInt(e,10);var t=this.BATTERY_LEVEL.DEAD;return e>=50?t=this.BATTERY_LEVEL.FULL:e<50&&e>=20?t=this.BATTERY_LEVEL.GOOD:e>=1&&e<20&&(t=this.BATTERY_LEVEL.LOW),t},convert_sensor_battery_percent_to_battery_level:function(e){return(e=parseInt(e,10))>=21?this.BATTERY_LEVEL.FULL:this.BATTERY_LEVEL.LOW},get_device_ids_from_scanner:function(e){if(e){var t=e.split(":");if(2===t.length)return t}},get_error_string_from_response:function(e,t){if(e&&e.errors&&e.errors.length)return t?"".concat(e.errors[0].message):"".concat(e.errors[0].field,": ").concat(e.errors[0].message)},get_sensor_ids_from_scanner:function(e){var t=this.get_device_ids_from_scanner(e);return{sensor_id:t[0],check_digit:t[1]}},get_gateway_ids_from_scanner:function(e){var t=this.get_device_ids_from_scanner(e);return{external_key:t[0],secondary_key:t[1]}},convert_graph_reading_to_company_temperature:function(e){var t=e;return"C"===$f.active_company.get("temperature_unit")&&(t=$f.utils.fahrenheit_to_centigrade(e)),$f.utils.round(t,this.DECIMAL_PLACES)},convert_graph_readings_to_company_temperature:function(e){var t=this;return _.map(e,(function(e){return t.convert_graph_reading_to_company_temperature(e)}))},get_temperature_for_display:function(e){var t="C"===$f.active_company.get("temperature_unit")?"°C":"°F",i=this.convert_graph_reading_to_company_temperature(e);return"".concat(i," ").concat(t)},get_cooldown_stage_one_starting_temperature:function(){return this.get_temperature_for_display(this.COOLDOWN_PROCESS_TEMPERATURE.STAGE_ONE_STARTING)},get_cooldown_stage_one_ending_temperature:function(){return this.get_temperature_for_display(this.COOLDOWN_PROCESS_TEMPERATURE.STAGE_ONE_ENDING)},get_cooldown_stage_two_ending_temperature:function(){return this.get_temperature_for_display(this.COOLDOWN_PROCESS_TEMPERATURE.STAGE_TWO_ENDING)},get_duration_between_dates:function(e,t){var i=moment(new Date(e)),n=moment(new Date(t)),s=moment.duration(n.diff(i)),o=s.hours(),a=s.minutes(),r=0!==a,l=0!==o,_="",c="";return r||l?(1===a&&(_=_t("mobile_sensors_cooldown_minute")),a>1&&(_=_t("mobile_sensors_cooldown_minute_plural")),1===o&&(c=_t("mobile_sensors_cooldown_hour")),o>1&&(c=_t("mobile_sensors_cooldown_hour_plural")),"( ".concat(l?o:""," ").concat(c," ").concat(r?a:""," ").concat(_," )").replace(/\s\s+/g," ")):""},get_info_from_lorawan_barcode:function(e,t){if(!e)return{};if(t)return{sensor_id:l(e.toUpperCase())};var i=(e=l(e.toUpperCase())).split(",").find((function(e){return o.test(e)}));return i?{external_key:i}:{}},display_battery:function(e){return Number.isInteger(e)},can_add_gateways:function(){return $f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.MONNIT)||$f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.SENET)},can_add_sensors:function(e){return e.has_sensor_integration_type(this.INTEGRATION_TYPE.MONNIT)||$f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.SENET)},get_manufacturer_sensor:function(e){return $f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.SENET)&&!e.has_sensor_integration_type(this.INTEGRATION_TYPE.MONNIT)?this.INTEGRATION_TYPE.SENET:e.has_sensor_integration_type(this.INTEGRATION_TYPE.MONNIT)&&!$f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.SENET)?this.MANUFACTURER.MONNIT:null},get_manufacturer_gateway:function(){return $f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.SENET)&&!$f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.MONNIT)?this.INTEGRATION_TYPE.SENET:$f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.MONNIT)&&!$f.active_company.has_sensor_integration_type(this.INTEGRATION_TYPE.SENET)?this.MANUFACTURER.MONNIT:null},can_select_manufacturer_sensor:function(e){return $f.active_company.has_sensor_integration_type($f.mobile.sensors.util.INTEGRATION_TYPE.SENET)&&e.has_sensor_integration_type($f.mobile.sensors.util.INTEGRATION_TYPE.MONNIT)},can_select_manufacturer_gateway:function(){return $f.active_company.has_sensor_integration_type($f.mobile.sensors.util.INTEGRATION_TYPE.SENET)&&$f.active_company.has_sensor_integration_type($f.mobile.sensors.util.INTEGRATION_TYPE.MONNIT)}}},s=new RegExp("(0{".concat(16,",}|F{").concat(16,",})"),"i"),o=new RegExp("^[A-F0-9]{".concat(16,"}$"),"i"),a=function(e,t){return e?t?_t("mobile_sensors_device_online"):_t("mobile_sensors_device_offline"):_t("Disabled")},r=function(e,t){return e?t?"online":"offline":"disabled"},l=function(e){return void 0===e&&(e=""),e.replace(/[:\s]/g,"")},c=function(e){if(!e)return!1;if("string"!=typeof e)return!1;var t=e.length;if(16!==t&&23!==t)return!1;var i=l(e);return 16===i.length&&!s.test(i)&&o.test(i)};t.ZP=n},"./src/backbone-unorganized/sensors/views.js":function(e,t,i){i.r(t),i.d(t,{CooldownItem:function(){return b},CooldownsList:function(){return v},SensorItem:function(){return w},SensorsList:function(){return y},GatewayItem:function(){return k},GatewaysList:function(){return T},DevicesLayout:function(){return x},DevicesSeeMore:function(){return E},SensorsLayout:function(){return S},GatewaysLayout:function(){return C},CooldownLayout:function(){return D},ComponentSensors:function(){return O},ComponentGateways:function(){return R},ComponentCooldown:function(){return M},DashboardCardSensors:function(){return A},DashboardCardGateways:function(){return N},DashboardCardCooldown:function(){return I},NoDevices:function(){return j},PlacementModal:function(){return z},PlacementTypeahead:function(){return P},SensorSettingsNickname:function(){return B},SensorStatusSelect:function(){return L},DeviceSuccess:function(){return q},AnimatedDeviceSuccessImage:function(){return F},StaticDeviceSuccessImage:function(){return U},SensorDetailPage:function(){return H},SensorSettingsPage:function(){return Y},CooldownSensorModal:function(){return Z},CooldownSensorsTypeahead:function(){return V},CooldownCreator:function(){return G},CooldownStageItemViewForTask:function(){return W},CooldownStageListViewForTask:function(){return K},CooldownStageItem:function(){return J},CooldownStageList:function(){return Q},CooldownStatus:function(){return X},CooldownDetailPage:function(){return ee},DashboardTabSensors:function(){return te}});var n=i("./src/backbone-unorganized/dashboard/views.js"),s=i("./src/backbone-unorganized/shared/sensors/models.js"),o=i("./src/backbone-unorganized/shared/sensors/util.js"),a=i("./src/backbone/shared/views/baseLayoutViews.js"),r=i("./src/backbone-unorganized/sensors/models.js"),l=i("./src/backbone-unorganized/dashboard/models.js"),_=i("./src/backbone-unorganized/sensors/sensors.js"),c=i("./src/backbone/shared/views/typeaheads.js"),u=i("./src/backbone/shared/views/EmptyListMessage.js"),d=i("./src/backbone/features/SetupDeviceWizard/DeviceNameStepView/view.js"),f=i("./src/backbone/features/SetupDeviceWizard/GatewayTypeStepView/view.js"),m=i("./src/backbone/features/SetupDeviceWizard/GatewayTypeStepView/GatewayMessageStepView/view.js"),h=i("./src/backbone/features/SetupDeviceWizard/PlacementStepView/view.js"),g=i("./src/backbone/features/SetupDeviceWizard/DeviceBarcodeStepView/view.js"),p=function(){return p=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},p.apply(this,arguments)},b=Backbone.Marionette.ItemView.extend({template:"#tpl_cooldown_row",tagName:"tr",model:null,events:{click:"display_cooldown_details_page"},templateHelpers:function(){return{sensor_name:this.model.get("sensor").get("name"),status_display:this.model.get_cooldown_status_for_display()}},display_cooldown_details_page:function(){$f.mobile.nav.show(ee,{model:this.model})}}),v=n.ComponentBodyViewTopItems.extend({itemView:b,collection:null,show_default_four_weeks_header:!1}),w=Backbone.Marionette.ItemView.extend({template:"#tpl_sensor_row",tagName:"tr",model:null,events:{click:"display_sensor_detail"},display_sensor_detail:function(){$f.mobile.nav.show(H,{model:this.model,sparkline:this.sensor_sparkline})},templateHelpers:function(){var e=this.sensor_sparkline.get("values"),t=$f.mobile.sensors.util.convert_graph_readings_to_company_temperature(e);return{last_reading_date_formatted:this.model.is_initializing()?_t("mobile_sensors_initializing"):this.model.get_last_reading_timedelta_str(),last_reading_value_formatted:this.model.get_last_reading_value(),sparkline_values:t,placement:this.model.get_placement_for_display(),equipment_location:this.getEquipmentLocationTitle(),sensor_status:(0,_.In)(this.model.get("is_enabled"),this.model.get("is_online")),sensor_status_class:(0,_.Nz)(this.model.get("is_enabled"),this.model.get("is_online")),show_equipment:this.showEquipment(),show_status:this.show_sensor()}},initialize:function(e){this._fetch_sparkline_data()},onRender:function(){this.render_chart()},show_sensor:function(){return(0,_.In)(this.model.get("is_enabled"),this.model.get("is_online"))!==_t("mobile_sensors_device_online")},showEquipment:function(){return $f.active_company.has_feature("sensor_equipment_readings")},getEquipmentLocationTitle:function(){if(!this.showEquipment())return null;if(!this.model.get("equipment_location"))return _t("mobile_sensors_no_equipment_linked");var e=[],t=this.model.get("equipment_location");return(null==t?void 0:t.equipment_model_name)&&e.push(t.equipment_model_name),(null==t?void 0:t.location_zone)&&e.push(t.location_zone),(null==t?void 0:t.identifier)&&e.push(t.identifier),e.join(" - ")},render_chart:function(){ZenputHighchartsLegacy.SparkLine=function(e,t,i){var n="string"==typeof e||e.nodeName,s=arguments[n?1:0],o={chart:{renderTo:s.chart&&s.chart.renderTo||this,backgroundColor:null,borderWidth:0,type:"line",margin:[2,0,2,0],height:50,style:{overflow:"visible"},skipClone:!0},title:{text:""},credits:{enabled:!1},xAxis:{visible:!1},yAxis:{visible:!1},legend:{enabled:!1},tooltip:{enabled:!0},plotOptions:{series:{animation:!1,lineWidth:1,shadow:!1,states:{hover:{lineWidth:1}},marker:{radius:1,states:{hover:{radius:2}}},fillOpacity:.25},column:{negativeColor:"#910000",borderColor:"silver"}}};return s=ZenputHighchartsLegacy.merge(o,s),n?new ZenputHighchartsLegacy.Chart(e,s,i):new ZenputHighchartsLegacy.Chart(s,t)};var e=$("div[data-sparkline]");!function t(){for(var i,n,s,o,a=new Date,r=e.length,l=0;l<r;l+=1)if(i=$(e[l]),n=String(i.data("sparkline")).split("; "),s=$.map(n[0].split(","),parseFloat),o={},n[1]&&(o.type=n[1]),i.highcharts("SparkLine",{series:[{data:s,pointStart:1,tooltip:{headerFormat:"",pointFormat:"<b>{point.y}</b> °".concat($f.active_company.get("temperature_unit"),"<br/>")}}],chart:o}),new Date-a>500){e.splice(0,l+1),setTimeout(t,0);break}}()},_fetch_sparkline_data:function(){this.sensor_sparkline=new s.DQ({id:this.model.get("id")}),this.sensor_sparkline.fetch({cache:!0,success:this.render})}}),y=n.ComponentBodyViewTopItems.extend({itemView:w,collection:null}),k=Backbone.Marionette.ItemView.extend({template:"#tpl_gateway_row",tagName:"tr",templateHelpers:function(){return{battery_level:this._get_gateway_battery_icon_class(),gateway_status_class:(0,_.Nz)(this.model.get("is_enabled"),this.model.get("is_online")),gateway_status:(0,_.In)(this.model.get("is_enabled"),this.model.get("is_online"))}},_get_gateway_battery_icon_class:function(){if(!this.model.get("is_online"))return"df-battery-dead offline";var e=this.model.get("battery_level"),t=$f.mobile.sensors.util.convert_gateway_battery_percent_to_battery_level(e),i="dead"===t;return"df-battery-".concat(t," ").concat(i?"offline":"")},_get_online_display:function(){return this.model.get("is_online")?_t("mobile_sensors_device_online"):_t("mobile_sensors_device_offline")}}),T=n.ComponentBodyViewTopItems.extend({itemView:k,collection:null}),x=Backbone.Marionette.Layout.extend({template:"#tpl_devices_layout",className:"devices_layout",view_class:null,collection:null,action_button_title_key:null,show_action_button:!0,allow_pagination:!1,events:{"click .display_wizard":"display_wizard"},regions:{r_devices:".r_devices",r_sensors_devices_see_more:".r_sensors_devices_see_more"},templateHelpers:function(){return{show_action_button:this.show_action_button,action_button_title:this.get_action_button_title()}},initialize:function(e){if(e=e||{},$.extend(this,e),!this.view_class)throw new Error("Programmer Error: You must set the view_class")},onRender:function(){var e=new this.view_class({collection:this.collection,show_default_four_weeks_header:!1});this.r_devices.show(e);var t=this;this.listenTo(this.collection,"sync",(function(){t._show_hide_see_more_devices_button()}))},get_action_button_title:function(){return _t(this.action_button_title_key)},_show_hide_see_more_devices_button:function(){this._should_show_see_more_devices()?this.r_sensors_devices_see_more.currentView||this.r_sensors_devices_see_more.show(new E({collection:this.collection})):this.r_sensors_devices_see_more.close()},_should_show_see_more_devices:function(){return!!this.allow_pagination&&this.collection.length!==this.collection.paginator.get("results_count")}}),E=Backbone.Marionette.ItemView.extend({template:"#tpl_sensors_devices_see_more",tagName:"a",className:"tasks_bucket_see_more",collection:null,attributes:{href:"#"},events:{click:"fetch_more"},fetch_more:function(e){var t=this;return this.$el.hasClass("disabled")||(this._disable_button(),this.collection.paginator.next_page(),this.collection.fetch({remove:!1,success:function(){t._enable_button()},error:function(){t._enable_button(),t.collection.paginator.previous_page(),$f.mobile.is.connected()||$f.mobile.notifications.show_offline_msg()}})),!1},_disable_button:function(){this.$el.addClass("disabled")},_enable_button:function(){this.$el.removeClass("disabled")}}),S=x.extend({action_button_title_key:"mobile_sensors_add_sensor",view_class:y,placements:null,wizard_options:null,allow_pagination:!0,initialize:function(e){this.account=$f.mobile.dashboard.get_active_account_or_group(),e=e||{},$.extend(this,e),this._fetch_initial_data()},onRender:function(){S.__super__.onRender.apply(this,arguments),this._set_sensor_button_state(!1)},display_wizard:function(){return $f.mobile.nav.show(this.wizard_options.wizard_class,{stepNumberKey:this.wizard_options.step_number_key,stepTitleKey:this.wizard_options.step_title_key,nextStepViewClass:this.wizard_options.next_step_view_class,type:this.wizard_options.type,selectedManufacturer:$f.mobile.sensors.util.get_manufacturer_sensor(this.account)}),!1},_set_sensor_button_state:function(e){e?this.$el.find(".display_wizard").show():this.$el.find(".display_wizard").hide()},_fetch_initial_data:function(){return e=this,t=void 0,n=function(){var e;return function(e,t){var i,n,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}}(this,(function(t){switch(t.label){case 0:e=$f.mobile.sensors.util.can_add_sensors(this.account),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._fetch_placements()];case 2:return t.sent(),this._set_sensor_button_state(e),this.wizard_options=this._get_wizard_options(),[3,4];case 3:return t.sent(),this._set_sensor_button_state(e),[3,4];case 4:return[2]}}))},new((i=void 0)||(i=Promise))((function(s,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}));var e,t,i,n},_fetch_placements:function(){var e=this;return this.placements=new s.lt,new Promise((function(t,i){e.placements.fetch({success:t,error:i})}))},_get_wizard_options:function(){var e=$f.mobile.sensors.util.can_select_manufacturer_sensor(this.account);return p(e?{wizard_class:f.q,next_step_view_class:h.u}:{wizard_class:h.u},{step_number_key:"mobile_sensors_wizard_step_one",type:"sensor"})},_are_company_placements_configured:function(){return 0!==this.placements.length}}),C=x.extend({action_button_title_key:"mobile_sensors_add_gateway",view_class:T,wizard_options:null,initialize:function(){this.account=$f.mobile.dashboard.get_active_account_or_group(),this.wizard_options=this._get_wizard_options()},_get_wizard_options:function(){var e=$f.mobile.sensors.util.can_select_manufacturer_gateway(),t=$f.mobile.sensors.util.get_manufacturer_gateway(),i={step_number_key:"mobile_sensors_wizard_step_one",type:"gateway"};return e?p({wizard_class:f.q,next_step_view_class:m.x},i):t===$f.mobile.sensors.util.MANUFACTURER.MONNIT?p({wizard_class:m.x,next_step_view_class:d.H},i):p({wizard_class:d.H,next_step_view_class:g.m},i)},display_wizard:function(){return $f.mobile.nav.show(this.wizard_options.wizard_class,{type:this.wizard_options.type,nextStepViewClass:this.wizard_options.next_step_view_class,stepNumberKey:this.wizard_options.step_number_key,selectedManufacturer:$f.mobile.sensors.util.get_manufacturer_gateway()}),!1}}),D=Backbone.Marionette.Layout.extend({template:"#tpl_cooldown_layout",className:"devices_layout",collection:null,events:{"click .start_cooldown":"display_cooldown_page"},regions:{r_cooldowns:".r_cooldowns"},templateHelpers:function(){return{action_button_title:_t("mobile_sensor_start_cooldown_process")}},onRender:function(){this._show_cooldowns()},display_cooldown_page:function(){return $f.mobile.nav.show(G),!1},_show_cooldowns:function(){this.r_cooldowns.show(new v({collection:this.collection}))}}),O=n.DashboardCardComponent.extend({query_collection_class:s.pf,loading_state_view_class:n.ComponentLoadingStateTableItem,query_key:null,query_structure:{metadata:{}},view_class:S,setup_query:function(){O.__super__.setup_query.apply(this,arguments),this.account=$f.mobile.dashboard.get_active_account_or_group(),this.query_collection.paginator.set({account_id:this.account.id})},show_down_state:function(){this.r_down_state.show(new u.G({icon_class:null,image_filename:"sensor_downstate.svg",i18n_key_title:"mobile_sensors_nothing_to_see_here",i18n_key_message:"mobile_sensors_contact_manager",zenput_codes:this.zenput_code,allow_retry:this.allow_retry}))},show_body_view:function(e,t){if(!this.isClosed){if(this.r_loading_state&&this.r_loading_state.reset(),this.trigger("query_collection_loaded"),t&&0===t.length&&!this.account.get("has_gateways"))return this.show_down_state(),void this.r_body.reset();this.r_down_state.reset(),this.r_body.show(new this.view_class({collection:t,query_collection:this.query_collection,parent_component:this}))}}}),R=n.DashboardCardComponent.extend({query_collection_class:r.Ze,loading_state_view_class:n.ComponentLoadingStateTableItem,query_key:null,query_structure:{metadata:{}},view_class:C,show_body_view:function(e,t){if(!this.isClosed){if(this.r_loading_state&&this.r_loading_state.reset(),this.trigger("query_collection_loaded"),t&&0===t.length)return this.show_down_state(),void this.r_body.reset();this.r_down_state.reset(),this.r_body.show(new this.view_class({collection:t,query_collection:this.query_collection,parent_component:this}))}},show_down_state:function(e){this.r_down_state.show(new j)}}),M=n.DashboardCardComponent.extend({query_collection_class:r.we,loading_state_view_class:n.ComponentLoadingStateTableItem,query_key:null,query_structure:{metadata:{}},view_class:D,setup_query:function(){M.__super__.setup_query.apply(this,arguments);var e=$f.mobile.dashboard.get_active_account_or_group();this.query_collection.paginator.set({account_id:e.id})}}),A=n.MobileDashboardCard.extend({get_title:function(){return _t("mobile_sensors_sensors")},components:[O]}),N=n.MobileDashboardCard.extend({get_title:function(){return _t("mobile_sensors_gateways")},components:[R]}),I=n.MobileDashboardCard.extend({get_title:function(){return _t("mobile_sensor_cooldown_process")},get_subtitle:function(){return _t("mobile_sensor_last_12_hours")},components:[M]}),j=u.G.extend({className:"no_devices",icon_class:null,image_filename:"gateway_downstate.svg",i18n_key_message:"mobile_sensors_set_up_gateway_message",action_button_title:"mobile_sensors_set_up_gateway",wizard_options:null,events:{"click .click_action":"display_gateway_wizard"},initialize:function(){this.account=$f.mobile.dashboard.get_active_account_or_group(),this.wizard_options=this._get_wizard_options()},_get_wizard_options:function(){var e=$f.mobile.sensors.util.can_select_manufacturer_gateway(),t=$f.mobile.sensors.util.get_manufacturer_gateway(),i={step_number_key:"mobile_sensors_wizard_step_one",type:"gateway"};return e?p({wizard_class:f.q,next_step_view_class:m.x},i):t===$f.mobile.sensors.util.MANUFACTURER.MONNIT?p({wizard_class:m.x,next_step_view_class:d.H},i):p({wizard_class:d.H,next_step_view_class:g.m},i)},display_gateway_wizard:function(){return $f.mobile.nav.show(this.wizard_options.wizard_class,{type:this.wizard_options.type,nextStepViewClass:this.wizard_options.next_step_view_class,stepNumberKey:this.wizard_options.step_number_key,selectedManufacturer:$f.mobile.sensors.util.get_manufacturer_gateway()}),!1}}),z=c.kG.extend({collection:new s.lt,toolbarnav_title:function(){return _t("mobile_sensors_add_device")},format_result:function(e){return e.get("name")}}),P=c.y3.extend({model:null,modal_class:z,i18n_key_placeholder:"mobile_sensors_select_placement",get_default_value:function(){return this.model?this.model.get("name"):""}}),B=Backbone.Marionette.ItemView.extend({template:"#tpl_sensor_settings_nickname",model:null,placeholder:"",nickname:null,placements:null,selectedPlacement:null,onSelect:function(){},onChange:function(){},placementUsesNicknames:function(){return this.selectedPlacement&&this.selectedPlacement.get("sensor_placement_nicknames").length>0},templateHelpers:function(){return{nickname:this.placementUsesNicknames()&&this.selectedPlacement.get("sensor_placement_nicknames").length>1?this.parseNicknameValue():this.nickname,nicknames:this.selectedPlacement&&this.selectedPlacement.get("sensor_placement_nicknames"),usesNicknames:this.placementUsesNicknames()}},events:{"change select":"selectName","keyup .name":"keyInputChange"},initialize:function(e){e=e||{},$.extend(this,e)},selectName:function(e){var t=$(e.target);this.updateSensorName(t.attr("value"))},keyInputChange:function(e){var t=$(e.target);this.updateSensorName(t.val())},updateSensorName:function(e){this.onChange(e)},parseNicknameValue:function(){return this.nickname.split("-")[0].trim()}}),L=Backbone.Marionette.ItemView.extend({template:"#tpl_sensor_status_select",sensor_status:null,model:null,placeholder:"null",on_select:function(){},templateHelpers:function(){return{sensor_status:this.sensor_status,selected_id:this.model.get("id")}},events:{"change select":"bind_value"},initialize:function(e){e=e||{},$.extend(this,e)},bind_value:function(e){var t=$(e.target);this.model.set({id:t.val(),name:t.attr("name")}),this.on_select(this.model.get("id"))}}),q=Backbone.Marionette.Layout.extend({className:"wizard",template:"#tpl_device_success_message_step",regions:{r_success_image:".r_success_image"},onRender:function(){window.customElements?this.r_success_image.show(new F):this.r_success_image.show(new U)}}),F=Backbone.Marionette.ItemView.extend({template:"#tpl_animated_device_success_image"}),U=Backbone.Marionette.ItemView.extend({template:"#tpl_static_device_success_image"}),H=a.IO.extend({template:"#tpl_sensor_detail_page",className:"sensor_detail_page",toolbarnav_center_title:!0,toolbarnav_show_edit_sensor:!0,use_transitions:!0,toolbarnav_title:function(){return _t("mobile_sensors_sensor")},selected_period:o.Z.LOOKBACK_PERIODS.DAY,sparkline:null,model:null,reading:null,last_reading_timeout:null,tooltip_timeout:500,events:{"click .lookback_period_1d":"_show_1d","click .lookback_period_1w":"_show_1w","click .lookback_period_1m":"_show_1m","click .lookback_period_1y":"_show_1y"},templateHelpers:function(){var e=this.sparkline.get("values"),t=$f.mobile.sensors.util.convert_graph_readings_to_company_temperature(e),i=this._get_last_reading_info(),n=i.last_reading_date,s=i.last_reading_value;return{battery_level:this._get_sensor_battery_icon_class(),battery_shown_class:$f.mobile.sensors.util.display_battery(this.model.get("battery"))?"":"battery-not-shown",has_initialized:!this.model.is_initializing(),last_reading_date_formatted:n,last_reading_value_formatted:s,lookback_period_1d_formatted:_t("mobile_sensors_one_day"),lookback_period_1w_formatted:_t("mobile_sensors_one_week"),lookback_period_1m_formatted:_t("mobile_sensors_one_month"),lookback_period_1y_formatted:_t("mobile_sensors_one_year"),name:this.model.get("name"),sensor_status:(0,_.In)(this.model.get("is_enabled"),this.model.get("is_online")),sensor_status_class:(0,_.Nz)(this.model.get("is_enabled"),this.model.get("is_online")),online_display:this._get_online_display(),placement:this.model.get_placement_for_display(),selected_1d_class:this._get_selected_period_class("1d"),selected_1w_class:this._get_selected_period_class("1w"),selected_1m_class:this._get_selected_period_class("1m"),selected_1y_class:this._get_selected_period_class("1y"),sparkline_readings:t,sparkline_timestamps:this.sparkline.get("timestamps")}},initialize:function(e){e=e||{},$.extend(this,e);var t=this;this._fetch_sparkline_data(),this.reading=new r.gi({value:this.model.get_last_reading_value(),timestamp:this.model.get_last_reading_date()}),this.listenTo(this.reading,"change",(function(){t._update_reading_display()}))},on_toolbarnav_init:function(){this.toolbarnav.set_sensor_model(this.model)},onRender:function(){this._render_chart()},_get_last_reading_date_formatted:function(e){return this.model.is_initializing()?"-":"".concat(_t("mobile_sensors_last_reading")," ").concat(e)},_get_last_reading_info:function(){return{last_reading_date:this._get_last_reading_date_formatted(this.model.get_last_reading_date()),last_reading_value:this.model.get_last_reading_value()}},_fetch_sparkline_data:function(){this.sparkline=new s.DQ({id:this.model.get("id")}),this._show_1d()},_get_sensor_battery_icon_class:function(){if(!$f.mobile.sensors.util.display_battery(this.model.get("battery")))return"";var e=this.model.get("battery"),t=$f.mobile.sensors.util.convert_sensor_battery_percent_to_battery_level(e);return"df-battery-".concat(t)},_get_selected_period_class:function(e){return this.selected_period===e?"selected":""},_get_online_display:function(){return this.model.get("is_online")?_t("mobile_sensors_device_online"):_t("mobile_sensors_device_offline")},_render_chart:function(){for(var e=$f.active_company.get("temperature_unit"),t=$($(".sensor_detail div[data-sparkline-readings]")[0]),i=$.map(String(t.data("sparkline-readings")).split(","),parseFloat),n=$.map(String(t.data("sparkline-timestamps")).split(","),Number),s=[],a=this,r=0;r<i.length;++r){var l=i[r];isNaN(l)||s.push([n[r],i[r]])}ZenputHighchartsLegacy.SparkLine=function(t,i,o){var r="string"==typeof t||t.nodeName,l=arguments[r?1:0],_={chart:{renderTo:l.chart&&l.chart.renderTo||this,backgroundColor:null,borderWidth:0,type:"line",height:250,style:{overflow:"visible"},skipClone:!0},title:{text:s.length?"":_t("mobile_dashboard_zenput_code_no_data_in_range")},credits:{enabled:!1},xAxis:{crosshair:{color:"#7c8388"},type:"datetime",visible:!1},yAxis:{gridLineColor:"#F2F7FA",labels:{format:"{value}°"},tickColor:"#FF0000",tickInterval:"C"===e?2:5,title:{enabled:!1}},legend:{enabled:!1},tooltip:{backgroundColor:"#222C3F",borderWidth:0,enabled:!0,useHTML:!0,hideDelay:a.tooltip_timeout,formatter:function(){var e=n[this.point.index],t=a._get_reading_from_graph_point(this.y),i=a._get_formatted_timestamp(e);return"".concat(t,"<br/>").concat(i)},positioner:function(e,t,i){var n=$(".sensor_detail > .chart")[0].getBoundingClientRect().width;return{x:Math.max(0,Math.min(i.plotX+44-e/2,n-e)),y:0}},shadow:!1,style:{color:"#FFFFFF"}},plotOptions:{series:{animation:!1,lineWidth:2,shadow:!1,states:{hover:{lineWidth:2}},marker:{radius:1,states:{hover:{radius:2}}},fillOpacity:.25,point:{events:{mouseOut:function(){a.last_reading_timeout&&clearTimeout(a.last_reading_timeout);var e=a._reset_to_last_reading_value.bind(a);a.last_reading_timeout=setTimeout(e,a.tooltip_timeout)},mouseOver:function(){a._on_graph_mouse_over(this,n)}}},gapSize:1}},trackByArea:!1};return l=ZenputHighchartsLegacy.merge(_,l),r?new ZenputHighchartsLegacy.Chart(t,l,o):new ZenputHighchartsLegacy.Chart(l,i)};var _=Date.now(),c=o.Z.get_minimum_timestamp_for_lookback(this.selected_period,_),u=s.length?s[0][0]:_;t.highcharts("SparkLine",{series:[{data:s}],chart:{},xAxis:{max:_,min:o.Z.get_minimum_timestamp_for_sparkline(c,u)}})},_show_sparkline:function(e){this.selected_period=e,this.sparkline.set_lookback_period(this.selected_period),this.sparkline.fetch({cache:!0,success:this.render})},_show_1d:function(){this._show_sparkline(o.Z.LOOKBACK_PERIODS.DAY)},_show_1w:function(){this._show_sparkline(o.Z.LOOKBACK_PERIODS.WEEK)},_show_1m:function(){this._show_sparkline(o.Z.LOOKBACK_PERIODS.MONTH)},_show_1y:function(){this._show_sparkline(o.Z.LOOKBACK_PERIODS.YEAR)},_update_reading_display:function(){var e=$(".sensor_detail > .last_reading > .date"),t=$(".sensor_detail > .last_reading > .value"),i=this.reading.get("timestamp"),n=i===this.model.get_last_reading_date()?"".concat(_t("mobile_sensors_last_reading")," ").concat(i):i;t.html(this.reading.get("value")),e.text(n)},_on_graph_mouse_over:function(e,t){var i=t[e.index],n=this._get_reading_from_graph_point(e.y),s=this._get_formatted_timestamp(i);n!==this.model.get_last_reading_value()&&this.reading.set({value:n,timestamp:s})},_reset_to_last_reading_value:function(){this.reading.set({value:this.model.get_last_reading_value(),timestamp:this._get_last_reading_date_formatted(this.model.get_last_reading_date())})},_get_reading_from_graph_point:function(e){var t="C"===$f.active_company.get("temperature_unit")?o.Z.CENTIGRADE:o.Z.FAHRENHEIT;return"".concat(e," ").concat(t)},_get_formatted_timestamp:function(e){return o.Z.get_formatted_sensor_timestamp({timestamp:e,format:$f.utils.DATE_AND_TIME_NO_TZ_FMT,account:this.model.get("account")})}}),Y=a.IO.extend({template:"#tpl_sensor_settings_page",className:"sensor_settings_page",toolbarnav_center_title:!0,toolbarnav_show_add_task:!1,use_transitions:!0,toolbarnav_title:function(){return _t("mobile_sensors_sensor_settings")},model:null,placements:null,events:{"click .remove":"_remove_sensor","click .save":"_save_sensor"},regions:{r_placement_typeahead:".r_placement_typeahead",r_status_select:".r_status_select",r_sensor_settings_nickname:".r_sensor_settings_nickname"},templateHelpers:function(){return{can_remove:$f.active_user.is_admin()||$f.active_user.is_manager(),id_number:this.model.get("sensor_id"),id_number_title:_t("mobile_sensors_id_number",{untranslatedID:"ID"}),name:this.model.get("name")}},initialize:function(e){e=e||{},$.extend(this,e),this.model.store(),this.placements=new s.lt},onRender:function(){this._display_placement_typeahead(),this._displaySensorSettingsNickname(),this._display_status_select()},go_back:function(){this.model.restore(),Y.__super__.go_back.apply(this,arguments)},_display_placement_typeahead:function(){var e=this;this.r_placement_typeahead.show(new P({className:"sensor_placement",model:this.model.get("placement"),post_on_select:function(t){e.model.set("placement",t),e.render(),e._show_save()},on_clear:function(){e.model.set("placement",""),e.render(),e._show_save()}}))},_displaySensorSettingsNickname:function(){var e=this;this.placements.fetch({remove:!1,success:function(){e.r_sensor_settings_nickname.show(new B({nickname:e.model.get("name"),selectedPlacement:e.model.get("placement"),placements:e.placements,onChange:function(t){e._updateName(t)}}))},error:function(){$f.mobile.notifications.show_error_msg()}})},_display_status_select:function(){var e=this,t=this.model.get("is_enabled"),i=new s.vI({id:t,name:t?_t("mobile_pso_filter_active"):_t("Disabled")}),n=new s.l9([{id:1,name:_t("mobile_pso_filter_active")},{id:0,name:_t("Disabled")}]);this.r_status_select.show(new L({sensor_status:n,model:i,on_select:function(t){if(!t)return e.model.set("is_enabled",null),e._show_save(!1);e.model.set("is_enabled",t),e._show_save()}}))},_remove_sensor:function(){var e=this;$f.mobile.notifications.confirm(_t("mobile_sensors_remove_confirm_message"),(function(t){if(t){var i=$f.mobile.dashboard.get_active_account_or_group();e.model.save({},{type:"DELETE",use_id_param:!0,success:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.nav.go_back_to_view(n.MobileDashboard,{active_account_or_group:i,active_tab_id:"sensors",do_not_set_leftnav:!0,reset_active_group_or_account_on_close:!1})},error:function(e,t){$f.mobile.notifications.hide_loading_dialog();var i=$f.mobile.sensors.util.get_error_string_from_response(t);$f.mobile.notifications.show_error_msg(i)}})}}),_t("mobile_sensors_remove_device"),_t("mobile_common_button_yes"),_t("mobile_common_button_no"))},_save_sensor:function(){var e=this;$f.mobile.notifications.show_loading_dialog();var t={name:this.model.get("name"),placement:this.model.get("placement"),is_enabled:this.model.get("is_enabled")};this.model.save(t,{patch:!0,use_id_param:!0,type:"PATCH",success:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_success_msg(_t("mobile_message_settings_success_saved")),e._show_save(!1),e.model.clear_history()},error:function(e,t){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg($f.mobile.sensors.util.get_error_string_from_response(t))}})},_show_save:function(e){var t=$(".sensor_settings_page > .save");if(!this.model.isValid()){var i=this.model.validationError;return $f.mobile.notifications.show_error_msg("".concat(i.field,": ").concat(i.message)),t.hide()}e||void 0===e?t.show():t.hide()},_updateName:function(e){this.model.set("name",e),this._show_save()}}),Z=c.kG.extend({collection:null,toolbarnav_title:function(){return _t("mobile_sensors_add_device")},initialize:function(e){e=e||{},$.extend(this,e),this.collection=new s.pf;var t=$f.mobile.dashboard.get_active_account_or_group();this.collection.paginator.set({account_id:t.id}),Z.__super__.initialize.apply(this,arguments)},format_result:function(e){return e.get("name")},transform_collection:function(e){return e.filter((function(e){return!e.get("in_use")}))}}),V=c.y3.extend({model:null,modal_class:Z,i18n_key_placeholder:"mobile_sensor_cooldown_select_sensor",get_default_value:function(){return this.model?this.model.get("name"):""}}),G=a.IO.extend({template:"#tpl_cooldown_creator",toolbarnav_center_title:!0,toolbarnav_show_add_task:!1,use_transitions:!0,toolbarnav_title:function(){return _t("mobile_sensor_cooldown_cool_down")},model:null,events:{"keyup .food .food_input":"food_changed","click .start_cooldown":"start_cooldown"},regions:{r_sensors_typeahead:".sensors_typeahead"},templateHelpers:function(){return{food_name:this.model.get("food"),cooldown_description:_t("mobile_sensor_cooldown_process_description",{stage1_start_temperature:$f.mobile.sensors.util.get_cooldown_stage_one_starting_temperature(),stage1_end_temperature:$f.mobile.sensors.util.get_cooldown_stage_one_ending_temperature(),stage2_end_temperature:$f.mobile.sensors.util.get_cooldown_stage_two_ending_temperature(),interpolation:{escapeValue:!1}})}},initialize:function(e){e=e||{},$.extend(this,e),this.model||(this.model=new r.eM),Backbone.Validation.bind(this,{valid:function(e,t,i){("food"===t?e.$(".food_input"):e.$(".fake_input")).removeClass("error")},invalid:function(e,t,i,n){("food"===t?e.$(".food_input"):e.$(".fake_input")).addClass("error"),$f.mobile.notifications.show_error_msg(i)}})},onRender:function(){this.show_sensors_typeahead()},food_changed:function(e){var t=$(e.target);this.model.set("food",t.val())},show_sensors_typeahead:function(){var e=this;this.r_sensors_typeahead.show(new V({className:"cool_down_sensor_typeahead",model:e.model.get("sensor"),post_on_select:function(t){e.model.set("sensor",t),e.render()},on_clear:function(){e.model.set("sensor","")}}))},start_cooldown:function(){this.model.isValid(!0)&&($f.mobile.notifications.show_loading_dialog(),this.model.save({},{type:"POST",success:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.nav.go_back()},error:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg()}}))}}),W=Backbone.Marionette.ItemView.extend({template:"#tpl_cooldown_stage_item_task",tagName:"tr",model:null,className:"stage_item",initialize:function(e){e=e||{},$.extend(this,e)},templateHelpers:function(){return{name:this.model.get_stage_title()}}}),K=n.ComponentBodyViewTopItems.extend({itemView:W,collection:null,show_default_four_weeks_header:!1,getEmptyView:function(){return u.G.extend({icon_class:null,i18n_key_message:"mobile_sensors_cooldown_starting_temperature_out_of_range"})}}),J=Backbone.Marionette.ItemView.extend({template:"#tpl_cooldown_stage_item",tagName:"tr",className:"stage_item",model:null,cooldown:null,initialize:function(e){e=e||{},$.extend(this,e)},templateHelpers:function(){return{name:this.model.get_stage_title(),date_reading:this.model.get_date_reading(),duration:this.model.get_duration(this.cooldown)}}}),Q=n.ComponentBodyViewTopItems.extend({itemView:J,show_default_four_weeks_header:!1,collection:null,cooldown:null,initialize:function(e){e=e||{},$.extend(this,e)},itemViewOptions:function(e){return{cooldown:this.cooldown}}}),X=Backbone.Marionette.ItemView.extend({template:"#tpl_cooldown_status",model:null,templateHelpers:function(){return{title:this.model.get_status_title(),date_ended:this.model.get_date_ended(),duration:this.model.get_duration(),reading:this.model.get_failing_reading()}}}),ee=a.IO.extend({template:"#tpl_cooldown_detail_page",className:"cooldown_detail_page",toolbarnav_center_title:!0,use_transitions:!0,toolbarnav_title:function(){return _t("mobile_sensor_cooldown_cool_down")},model:null,regions:{r_stages:".stages",r_status:".status"},templateHelpers:function(){return{started_cooldown:_t("mobile_sensors_cooldown_started_cooldown_process"),date_started:this.model.get_date_started(),sensor_name:this.model.get("sensor").get("name")}},onRender:function(){this._show_stages(),this.model.get("date_ended")&&this._show_status()},_show_stages:function(){this.r_stages.show(new Q({collection:this.model.get("stages"),cooldown:this.model}))},_show_status:function(){this.r_status.show(new X({model:this.model}))}}),te=n.BaseDashboardTab.extend({template:"#tpl_dashboard_sensors",account_gateways:null,account:null,regions:{r_body:".dashboard_tab_body",r_empty:".dashboard_tab_empty"},initialize:function(){var e=this;te.__super__.initialize.apply(this,arguments),this.account=$f.mobile.dashboard.get_active_account_or_group(),this.listenTo($f.application.vent,"app:orientation_change",(function(){$f.mobile.update_page_scrollable_height(e.$el)}))},onRender:function(){$f.mobile.sensors.util.can_add_gateways()&&this._has_no_gateways_or_sensors()?this._show_no_gateways_view():this._has_no_gateways_or_sensors()?this._show_no_integrations_view():(this.r_empty.close(),te.__super__.onRender.apply(this,arguments))},_has_no_gateways_or_sensors:function(){return!this.account.get("has_gateways")&&!this.account.get("has_sensors")},_show_no_gateways_view:function(){this.r_body.close(),this.r_empty.show(new j)},_show_no_integrations_view:function(){this.r_body.close(),this.r_empty.show(new u.G({icon_class:null,image_filename:"sensor_downstate.svg",i18n_key_title:"mobile_sensors_missing_integration",i18n_key_message:"mobile_sensors_contact_zenput_admin",zenput_codes:this.zenput_code,allow_retry:this.allow_retry}))},setup_cards:function(){this.dashboard_cards=new l.iG,$f.active_company.has_feature("sensor_cool_down")&&this.dashboard_cards.add({view_class:I}),this.dashboard_cards.add({view_class:A}),$f.mobile.sensors.util.can_add_gateways()&&this.dashboard_cards.add({view_class:N})},on_tab_focused:function(){$f.mobile.notifications.show_loading_dialog(),this._update_cards_display()},_update_cards_display:function(){this.setup_cards(),$f.mobile.notifications.hide_loading_dialog(),this.render()}})},"./src/backbone-unorganized/shared/comments/models.js":function(e,t,i){i.d(t,{jk:function(){return r},ql:function(){return c},zP:function(){return u},sv:function(){return d},HW:function(){return f},bX:function(){return m}});var n=i("./src/backbone-unorganized/shared/forms.js"),s=n.Dn.extend({legacy_classname:"$f.shared.comments.models.Mention",defaults:{id:null,display_name:"",tag_in_message:"",is_subscriber:null,type:"user"}}),o=n.DR.extend({legacy_classname:"$f.shared.comments.collections.Mentions",model:s,convert_to_users_array:function(){return this.map((function(e){return new n.n5({id:e.id,display_name:e.get("display_name")})}))}}),a=n.Dn.extend({legacy_classname:"$f.shared.comments.models.CommentAssociatedUser",defaults:{is_subscriber:!1,has_read:!1}}),r=n.Ds.extend({legacy_classname:"$f.shared.comments.models.CommentsPaginator",defaults:$.extend({},n.Ds.prototype.defaults,{order_by:"-date_created",limit:100})}),l=n.Dn.extend({legacy_classname:"$f.shared.comments.models.Target",defaults:{id:null,type:null,date_created:null,account:null,name:null},submodels:{account:n.mR,instance:null},get_target_subscribers:function(){throw new Error("Programmer Error: get_target_subscribers() not implemented")},get_users_to_notify_for_display:function(){var e=new n.Q,t=this.get_target_subscribers(),i=$f.mobile?$f.active_user:$f.user;return t?(e.add(t.toJSON()),e.get(i.id)&&e.remove(e.get(i.id)),e):e},get_users_to_notify_count_for_display:function(){return this.get_users_to_notify_for_display().length},remove_subscribers:function(e,t){var i=this.get_target_subscribers();t.get(e)&&($f.application.vent.trigger("mobile:target:inactive_mentions:remove",e),t.remove(e),i.remove(e))},add_subscribers:function(e,t){var i=this.get_target_subscribers();i.get(e)||(t.add(e),i.add(e),this._perform_permission_check({mentioned_user_id:e.get("id"),success:function(t){t||(i.remove(e),$f.application.vent.trigger("mobile:target:inactive_mentions:add",e)),e.set("is_subscriber",t)},error:function(){if($f.mobile)return $f.mobile.notifications.show_error_msg();new $f.web.views.Notification({type:"error",heading:"Error",message:"The user's could not be checked"})}}))},_perform_permission_check:function(e){(e=e||{}).success=e.success||function(){},e.error=e.error||function(){},$f.utils.select_ajax()({url:"/api/v2/comments/mention_permission/"+e.mentioned_user_id,dataType:"json",type:"GET",cache:!1,contentType:"application/json",data:{target_type:this.get("type"),target_id:this.get("id")},success:function(t){e.success(t.data.can_be_mentioned)},error:function(t){e.error()}})},toJSON:function(e){return _.omit(this.attributes,"instance")}}),c=l.extend({legacy_classname:"$f.shared.comments.models.CommentTargetForTask",defaults:_.extend({type:"task"},l.defaults),submodels:{instance:n.gb},get_target_subscribers:function(){return this.get("instance").get("subscribers")}}),u=l.extend({legacy_classname:"$f.shared.comments.models.CommentTargetForSubmission",defaults:_.extend({type:"submission"},l.defaults),submodels:{instance:n.zc},get_target_subscribers:function(){return this.get("instance").subscribers}}),d=n.Dn.extend({legacy_classname:"$f.shared.comments.models.Comment",defaults:{id:null,message:null,date_created:null,date_modified:null,created_user:null,is_active:!0,mentions:[],user_info:null,target:null,is_task_submitted:!1},is_open:!1,submodels:{mentions:o,user_info:a,target:l},validation:{message:{fn:"_validate_message"}},url:"/api/v2/comments",initialize:function(e,t){t=t||{},$.extend(this,t)},sync:function(e,t,i){switch(e){case"update":case"create":i.url="".concat(t.url,"/comment/");break;case"delete":i.url="".concat(t.url,"/comment/").concat(t.id)}return Backbone.sync(e,t,i)},_validate_message:function(e,t,i){if(!e||!e.trim())return"Please enter a message."},delete:function(e){var t=this;(e=e||{}).success=e.success||function(){},e.error=e.error||function(){},$f.utils.select_ajax()({url:"/api/v2/comments/comment/".concat(this.id),dataType:"json",type:"DELETE",cache:!1,contentType:"application/json",success:function(i){t.set("is_active",!1),e.success(i)},error:function(t){e.error(t)}})},decrement_global_comment_count:function(){var e=$f.mobile.unread_notifications_count.get("count");e>0&&$f.mobile.unread_notifications_count.set("count",e-1)},set_is_open:function(e){this.is_open=e,this.get("user_info").get("has_read")||(this.decrement_global_comment_count(),this.mark_as_read()),this.trigger("change:is_open",this.is_open)},get_is_open:function(){return this.is_open},mark_as_read:function(e){var t=$f.utils.select_ajax(),i={last_comment_pull_datetime:this.collection.date_last_fetched,target:{id:this.get("target").get("id"),type:this.get("target").get("type")}};this.get("user_info").set("has_read",!0),t({url:"/api/v2/comments/set_read/",dataType:"json",type:"POST",cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(t){e&&"function"==typeof e.success&&e.success(t)},error:function(t){e&&"function"==typeof e.error&&e.error(t)}})},set_mentions_from_html:function(e){var t=_.map($("<p>".concat(e,"</p>")).find("span"),(function(e){return{id:parseInt($(e).attr("data-id")),display_name:$(e).text().substring(1),user_role:{name:$(e).attr("data-user-role")},type:"user"}}));this.get("mentions").set(t)},set_message_from_html:function(e){e=(e=e.replace(/<br\s*[\/]?>/gi,"\n")).replace(/<\/p><p>/gi,"\n");var t=$("<p>".concat(e,"</p>"));t.find("span").replaceWith((function(e){return"[[[user~".concat($(this).attr("data-id"),"]]]")})),this.set("message",t.text())},get_html_formatted_message:function(e){(e=e||{}).disable_clicking=e.disable_clicking||!1;var t=this,i=this.get("message");return i?(i=i.replace(/\n/g,"<br />")).replace(/\[\[\[user~([0-9]+)\]\]\]/g,(function(i,n){var s,o=t.get("mentions").findWhere({id:parseInt(n)});return s=e.disable_clicking?'<span target="_blank" class="'.concat(o.get("is_subscriber")?"":"mention_inactive",'">@').concat(o.get("display_name"),"</span>"):'<a href="/users/#id/'.concat(o.id,'" target="_blank" class="').concat(o.get("is_subscriber")?"":"mention_inactive",'">@').concat(o.get("display_name"),"</a>"),o?e.for_editing?d.get_mention_span({id:o.id,display:o.get("display_name"),is_subscriber:o.get("is_subscriber")}):s:i})):""}},{get_mention_span:function(e){return'<span class="tribute-mention '.concat((e=e||{}).is_subscriber?"":"mention_inactive",'" data-id="').concat(e.id,'" data-user-role="').concat(e.user_role?e.user_role:"",'" data-check-text="@').concat(e.display,'">@').concat(e.display,"</span>")}}),f=n.DR.extend({legacy_classname:"$f.shared.comments.collections.Comments",model:d,paginator:null,target:null,date_last_fetched:null,events_added:!1,inactive_mentions:null,initialize:function(e,t){t=t||{},$.extend(this,t);var i=this;this.paginator||(this.paginator=new r),this.on("sync",(function(){i.date_last_fetched=(new Date).toISOString(),i.inactive_mentions=i._get_inactive_mentions()})),this.listenTo($f.application.vent,"mobile:target:inactive_mentions:add",(function(e){i.inactive_mentions.add(e)})),this.listenTo($f.application.vent,"mobile:target:inactive_mentions:remove",(function(e){i.inactive_mentions&&i.inactive_mentions.remove(e)}))},url:function(){return"/api/v2/comments/?target_type=".concat(this.target.get("type"),"&target_id=").concat(this.target.get("id"),"&").concat(this.paginator.get_query_string({get_count:!0}))},comparator:function(e){return new Date(e.get("date_created")).getTime()},display_length:function(){return this.where({is_task_submitted:!1}).length},add_comment:function(e,t){(t=t||{}).success=t.success||function(){},t.error=t.error||function(){};var i=this;e.set("target",this.target),e.save({},{success:function(){i.add(e),t.success()},error:function(e){t.error()}})},mark_all_as_read:function(e){var t=this;(e=e||{}).success=e.success||function(){},e.error=e.error||function(){};var i=$f.utils.select_ajax(),n={last_comment_pull_datetime:this.date_last_fetched};this.target&&(n.target={id:this.target.get("id"),type:this.target.get("type")}),i({url:"/api/v2/comments/set_read/",dataType:"json",type:"POST",cache:!1,contentType:"application/json",data:JSON.stringify(n),success:function(i){t.each((function(e){e.get("user_info")&&!e.get("user_info").get("has_read")&&e.get("user_info").set("has_read",!0)})),e.success(i)},error:function(t){e.error(t)}})},has_unread_comments:function(){if(0===this.length)return!1;if(!this.target.get_target_subscribers())return!1;var e=$f.mobile?$f.active_user.id:$f.user.id;return!!this.target.get_target_subscribers().get(e)&&!!_.find(this.models,(function(e){return e.get("user_info")&&!e.get("user_info").get("has_read")}))},add_event_models:function(){if(!this.events_added&&this.target&&"task"===this.target.get("type")){var e=this.target.get("instance");if(e.get("fulfillment")&&e.get("fulfillment").get("date_submitted")){var t=new d({date_created:$f.utils.convert_epoch_ts_to_iso_string(e.get("fulfillment").get("date_submitted").$date),is_task_submitted:!0});this.add(t),this.events_added=!0}}},_get_inactive_mentions:function(e){var t=new n.Q;return this.each((function(e){e.get("mentions").each((function(e){e.get("is_subscriber")||t.add(e)}))})),t}}),m=n.Dn.extend({legacy_classname:"$f.shared.comments.models.UnreadCount",defaults:{count:0},url:"/api/v2/comments/user_unread_count/?include_target_types=announcement,submission,task",initialize:function(e,t){t=t||{},$.extend(this,t),this.on("change",(function(){$f.mobile.is.native()&&$f.mobile.is.ios()&&$f.mobile.cordova.pushwoosh.setApplicationIconBadgeNumber(this.get("count"))}))},reset:function(){this.set("count",0,{silent:!0}),this.trigger("change",this)}})},"./src/backbone-unorganized/shared/deployment_flags/index.js":function(e,t,i){i.d(t,{Z:function(){return _}});var n=i("./src/backbone-unorganized/shared/forms.js"),s=function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},s.apply(this,arguments)},o=n.Dn.extend({idAttribute:"key"}),a=n.DR.extend({model:o,url:"/api/v3/flags/deployment/",valueKey:"value",initialize:function(e,t){t.tests&&(this.valueKey="test_value")},fetch:function(e){void 0===e&&(e={});var t=this.pluck("key").join(",");return e.data={keys:t},this.constructor.__super__.fetch.call(this,e)},parse:function(e){var t,i=this;return null===(t=e.data)||void 0===t?void 0:t.map((function(e){var t=e.key,n=e.value;return s(s({},i.get(t).toJSON()),{value:n})}))},get_flag:function(e){var t,i,n=this.findWhere({key:e});if(!n)throw new Error('Flag "'.concat(e,"\" doesn't exist"));return null!==(i=null!==(t=n.get(this.valueKey))&&void 0!==t?t:n.get("default_value"))&&void 0!==i&&i}}),r=a,l=[{key:"example_client_feature",title:"Example feature",description:"This is an example of how a feature flag should be created.",owner:"René d'Herblay",test_value:!0,default_value:!0},{key:"sensor_placement_readings",title:"Sensor Placement Readings in Form",description:"Get sensor readings by placement in form when using the sensor_question field",owner:"Francisco Tejon",test_value:!0,default_value:!0},{key:"limit_brand_wide_submissions",title:"Limit brand wide submissions view",description:"Actities now require `permit_brandwide_submission_access` set before they show submissions on the brand wide submission page",owner:"Anže Pečar",test_value:!0,default_value:!1},{key:"fullstory_mobile",title:"Integrate Fullstory with Mobile app",description:"If enabled Fullstory will record web views in the Mobile App",owner:"Paul Guerrero",test_value:!0,default_value:!1},{key:"embedded_reporting_beta",title:"Sigma Embedded Reporting Beta",description:"Flag for allowing access to the embedded reporting beta",owner:"Team RADD",test_value:!0,default_value:!1},{key:"bento_location_attributes_filter_backbone",title:"Bento Location Attributes Filter Backbone",description:"Use the new Bento Criteria Builder for the Location Attributes Filter in Backbone",owner:"Halah Al-Shaikhly",test_value:!0,default_value:!1},{key:"zendesk",title:"Zendesk",description:"Replaces Intercom with Zendesk",owner:"David Watkins",test_value:!0,default_value:!1},{key:"select_all_checkbox_feature",title:"Select all checkbox feature",description:"Select all checkbox for the form builder.",owner:"Ryan Martin",test_value:!0,default_value:!0},{key:"skip_oauth_check_for_djangosaml",title:"Ignore oauth values for djangosaml2 users",description:"Add this flag to djangosaml2 companies so that when we check for oauth values, we return False since we do not support oauth for djangosaml2",owner:"Allison Mar",test_value:!0,default_value:!1},{key:"hide_sensor_trigger_report_submissions_view",title:"Hide sensor submissions view when creating a sensor trigger",description:"Hide sensor submission view when creating a sensor trigger, we are migrating sensor readings from ES to MongoDB",owner:"Carlos Linares",test_value:!1,default_value:!1},{key:"mobile_embedded_analytics",title:"Embed analytics into mobile app",description:"Flag for enabling embedded analytics in mobile app",owner:"Team RADD",test_value:!1,default_value:!1},{key:"embedded_reporting_beta_for_managers",title:"Sigma Embedded Reporting Beta for Managers",description:"Flag for allowing managers access to the embedded reporting beta",owner:"Team RADD",test_value:!1,default_value:!1},{key:"pendo_mobile_analytics",title:"Enable Pendo Analytics snippet and initialization in the mobile app",description:"Enable Pendo Analytics snippet and initialization in the mobile app",owner:"Chris Jordan",test_value:!0,default_value:!0},{key:"form_builder_configure_card_react_component",title:"Use ConfigureCard React component in Form Builder",description:"Use the ConfigureCard React component from libs/feature-form-builder in the Form Builder (Backbone)",owner:"Jenny Shi",test_value:!1,default_value:!1}],_={collection:null,initialize:function(e){var t=this;void 0===e&&(e={});var i=e.flags,n=void 0===i?l:i,s=e.tests,o=void 0!==s&&s;return this.collection=new r(n,{tests:o}),new Promise((function(e){t.collection.fetch({success:e,error:e})}))},get_flag:function(e){if(!this.collection)throw new Error("Please make sure `initialize` method was called");return this.collection.get_flag(e)}}},"./src/backbone-unorganized/shared/forms.js":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Vl:function(){return global_utils},xY:function(){return global_formula_utils},Dn:function(){return BaseZenputModel},DR:function(){return BaseZenputCollection},b8:function(){return ZenputStorage},Su:function(){return AcceptanceCriteriaCollection},ne:function(){return BaseField},of:function(){return FormSmetadata},_U:function(){return FormTemplate},cG:function(){return FormTemplates},O1:function(){return SearchCriteria},IV:function(){return BaseDashboardCardResultListItem},pD:function(){return BaseDashboardCardResultList},Ot:function(){return TopItemHeaders},a1:function(){return DashboardCardResultListWithHeadersMixin},Ax:function(){return SearchCriterias},pI:function(){return FieldEventSearchCriterias},G$:function(){return Submission},OA:function(){return Submissions},gS:function(){return DistributeGroups},Rv:function(){return DistributeGroup},hy:function(){return UsersDistributeGroupsAndRoles},zc:function(){return FormStructure},Ds:function(){return Paginator},YD:function(){return Company},n5:function(){return User},Q:function(){return Users},bG:function(){return UserDevice},bL:function(){return UserNotificationSettings},SM:function(){return UserRoles},mR:function(){return Account},XJ:function(){return Accounts},MK:function(){return AccountTags},b:function(){return BaseTaskSource},c$:function(){return TaskFulfillment},g3:function(){return Followers},Ee:function(){return Image},rU:function(){return Images},gb:function(){return BaseTask},Dm:function(){return BaseBatchTask},hS:function(){return Tasks},Vc:function(){return SearchOption},YE:function(){return global_recurring_utils},ve:function(){return RecurringProject},IK:function(){return Project},pj:function(){return Projects},o7:function(){return Ingredient},pn:function(){return Ingredients}});var __spreadArray=function(e,t,i){if(i||2===arguments.length)for(var n,s=0,o=t.length;s<o;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))};window.$f||(window.$f={window:{app_router:null,active_view:null,active_modal:null,active_collection:null,active_notification:null,active_title_nav:null},user:{id:null,username:null,is_authenticated:!1,role:null,is_new:null,time_zone:null,is_owner:null,is_admin:null,is_manager:null,is_superuser:null,company:{id:null,name:null,features:null,default_team:{id:null,display_name:null},has_feature:function(e){return _.contains($f.user.company.features||[],e)}},default_team:{id:null,display_name:null}},models:{mixins:{}},collections:{mixins:{}},views:{},version:{id:1},shared:{comments:{collections:{},models:{},utils:{}},sensors:{collections:{},models:{},util:{}}},web:{components:{location_attributes_filter:{collections:{},views:{}},form_builder:{configure_card:{views:{}}}}}});var global_utils={SYSTEM_ADMIN_USER_ID:1,STRING_DELIMITER:"~",STRING_DELIMITER_REPLACEMENT:"*^tilde^*",DEFAULT_DATE_PICKER_MIN_DATE:"2012-01-01",DATE_FMT:"MMM D, YYYY",TIME_FMT:"h:mm a z",UTC_ISO_FORMAT:"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",DATE_AND_TIME_FMT:"MMM D, YYYY, h:mm a (z)",DATE_AND_TIME_NO_TZ_FMT:"MMM D, YYYY, h:mm a",ANNOUNCEMENT_DATE_AND_TIME_FMT:"MMM D, YYYY h:mm A",EARTHS_RADIUS:3960,REPORT_HOUR_OFFSET:4,ACCEPTED_DOCUMENT_FILED_TYPES:"pdf,application/pdf,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/msword,text/csv",ACCEPTED_INSTRUCTION_FIELD_TYPES:"pdf,image/jpg,image/jpeg,image/bmp,image/png,image/gif,application/pdf,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/msword,text/csv",ACCEPTED_INSTRUCTION_FIELD_IMAGE_EXTENSIONS:["jpg","jpeg","bmp","png","gif"],ACCEPTED_IMPORT_FORM_WIZARD_FIELD_TYPES:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],DEPENDENT_FIELD_TOP_LEVEL:0,DECIMALS_IN_TEMPERATURE_VALUE:2,REPORTS_DATE_FORMAT:"MMM D, YYYY",REPORTS_DATE_FORMAT_TZ:"MMM D, YYYY (z)",DATE_OPERATORS:{TODAY:"today",YESTERDAY:"yesterday",DATE_WEEK_THIS:"date_week_this",DATE_WEEK_LAST:"date_week_last",DATE_MONTH_THIS:"date_month_this",DATE_MONTH_LAST:"date_month_last",DATE_OCCUR_AFTER:"date_occur_after",DATE_OCCUR_BEFORE:"date_occur_before",DATE_OCCUR_BETWEEN:"date_occur_between",DATE_SPECIFIC_BEFORE:"date_specific_before",DATE_SPECIFIC_AFTER:"date_specific_after"},is_nil:function(e){return null==e},deepclone:function(e){return window.cloneDeep(e)},get_active_company:function(){return this.is_mobile_app()?$f.active_company:new Company($f.user.company)},pick_date_submitted:function(e){var t=e.get("date_submitted"),i=e.get("date_completed");return t&&i&&Math.abs(moment(t.$date).diff(moment(i.$date),"seconds"))<300?i:t},format_submission_date:function(e,t,i,n,s){var o="date_submitted";if(t=t||$f.utils.DATE_AND_TIME_FMT,i=i||o,n=n||e.get("time_zone")||moment.tz.guess(),!e||!e.get(i))return"";if(s){var a=$f.active_user.get("time_zone");moment.tz(a).utcOffset()===moment.tz(n).utcOffset()&&(t=t.replace("z",""))}var r=o===i?this.pick_date_submitted(e):e.get(i);return moment.utc(r.$date||r).tz(n).format(t)},format_date:function(e,t,i,n){if(void 0===t&&(t=moment.tz.guess()),void 0===i&&(i=$f.utils.DATE_AND_TIME_FMT),void 0===n&&(n=!1),n){var s=$f.active_user.get("time_zone");moment.tz(s).utcOffset()===moment.tz(t).utcOffset()&&(i=i.replace("z",""))}return moment(e).tz(t).format(i)},convert_epoch_ts_to_iso_string:function(e){return moment(e).toISOString()},sanitize:function(e){return window.DOMPurify.sanitize(String(e),{ALLOWED_TAGS:$f.bleached_allowed_tags,ALLOWED_ATTR:$f.bleached_allowed_attributes,ALLOWED_PROTOCOLS:$f.bleached_allowed_protocols})},validate_email:function(e){return(/,/.test(e)?/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))(?:,\s*(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(e)},validate_phone:function(e){return/^(([0-9]{0,2})[-. ]?)?\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(e)},title_case:function(e){return e.toLowerCase().replace(/\b[a-z]/g,(function(e){return e.toUpperCase()}))},has_local_storage:function(){return"undefined"!=typeof Storage},generate_display_name:function(e,t,i,n){return e&&!t?e:e?e+" "+t:i||n},get_error_response:function(e,t){try{return JSON.parse(e.responseText).message}catch(e){return t||null}},get_start_of_week:function(e){return e=e||new Date,(moment.isMoment(e)?e:moment(e)).startOf("isoWeek").toDate()},get_start_of_day:function(e){return e=e||new Date(Date.now()),(moment.isMoment(e)?e:moment(e)).startOf("day").toDate()},get_start_of_day_ts_with_offset_in_tz:function(e,t,i){var n="YYYY-MM-DDT0".concat(t,":00:00");return moment.tz(moment(e).format(n),i).valueOf()},get_end_of_day:function(e){return e=e||new Date,(moment.isMoment(e)?e:moment(e)).endOf("day").toDate()},get_tomorrow:function(e){return e=e||new Date,(moment.isMoment(e)?e:moment(e)).add(1,"day").startOf("day").toDate()},get_end_of_week:function(e){return e=e||new Date,(moment.isMoment(e)?e:moment(e)).endOf("isoWeek").toDate()},get_num_week_of_month:function(e){return moment.isMoment(e)||(e=moment(e)),Math.ceil(e.date()/7)},get_relative_date_from_today:function(e,t){return t=t||!1,this.get_relative_date(moment((new Date).setHours(0,0,0,0)),e,t)},get_formatted_time:function(e){return moment(e).format("h:mm a")},get_full_formatted_time:function(e){return moment(e).format("MMM DD hh:mm a z")},get_formatted_time_from_24_hour_time:function(e){return moment(e,"HH:mm").format("h:mm a")},get_24_hour_time_from_formatted_time:function(e){return moment(e,"h:mm a").format("HH:mm")},get_utc_date_without_offset:function(e){return new Date(e.utc().format("YYYY-MM-DD hh:00:00"))},is_overdue:function(e){return moment()>e},get_date_str_with_color:function(e,t){t=t||"MMM D";var i={color:""};return $f.utils.is_overdue(e)&&(i.color="red"),i.label=moment(e).format(t),i},get_relative_date:function(e,t,i){i=i||!1;var n=(t=moment(t)).diff(e,"days",!0),s="",o="";return n>=0&&n<1?(s="Today",o="green"):s=n<0&&n>-1?"Yesterday":n>=1&&n<2?"Tomorrow":i?t.format("MMM D (z)"):t.format("MMM D"),n<0&&(o="red"),{label:s,color:o}},get_project_time_range:function(e){if(!e)return"";var t=moment(e.date_due_local).format("hh:mm A");return moment(e.date_start_local).format("hh:mm A")+" - "+t},setup_options_callbacks:function(e){e=e||{};var t=(e=$.extend({success:function(){},error:function(){},complete:function(){}},e)).success;e.success=function(){t.apply(this,arguments),e.complete()};var i=e.error;return e.error=function(){i.apply(this,arguments),e.complete()},e},escape_for_regex:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},local_guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},remove_url_hashbangs:function(){window.history&&window.history.replaceState?history.replaceState("",document.title,window.location.pathname):$f.mobile.is_mobile_app()||(window.location=window.location.pathname)},encode_id_and_value_param:function(e,t){var i,n;try{i=e.toString()}catch(e){i="undefined"}try{n=t.toString()}catch(e){n="undefined"}return"".concat(i).concat($f.utils.STRING_DELIMITER).concat(encodeURIComponent(n.replace($f.utils.STRING_DELIMITER,$f.utils.STRING_DELIMITER_REPLACEMENT)))},decode_id_and_val_param:function(e){var t=e.split($f.utils.STRING_DELIMITER);return 2!=t.length?(console.error("Bad param sent to decode_id_and_val_param",e),{value:e,display_value:void 0}):{value:parseInt(t[0]),display_value:t[1].replace($f.utils.STRING_DELIMITER_REPLACEMENT,$f.utils.STRING_DELIMITER)}},ellipsis:function(e,t){return t||(t=50),e.length-3<=t?e:e.substr(0,t)+"..."},replace_line_break:function(e,t){return t=t||"",(e=e||"").replace(/<br>/g,t)},replace_newline:function(e,t){return t=t||"",(e=e||"").replace(/\n/g,t)},capitalize_string:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},expand_textarea:function(e){var t=e.target,i=t.scrollHeight;i>t.clientHeight&&(t.style.height=i+"px")},convert_distance:function(e,t){return t?Math.round(100*e)/100:e},get_string_from_milliseconds:function(e,t){(!e||"number"!=typeof e||isNaN(e)||e<0)&&(e=0);var i=moment.duration(e,"milliseconds"),n=i.days();if(n<1)switch(t){case"centiseconds":return moment.utc(e).format("HH:mm:ss.SS");case"minutes":return moment.utc(e).format("mm:ss");case"hours":return moment.utc(e).format("HH");default:return moment.utc(e).format("HH:mm:ss")}return"".concat(24*n+i.hours()," hours")},get_distance_between_lat_lon_points:function(e,t,i,n){var s=function(e){return e*(Math.PI/180)},o=$f.utils.EARTHS_RADIUS,a=s(i-e),r=s(n-t),l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(s(e))*Math.cos(s(i))*Math.sin(r/2)*Math.sin(r/2);return o*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},get_loading_spinner_html:function(){var e=$("#loading_dialog_wrapper .loading_spinner");if(!e||!e.length)throw new Error("Could not find global loading dialog for get_loading_spinner_html()");return e.prop("outerHTML")},is_ellipsis_active:function(e){return e.length&&e.outerWidth()!==e[0].scrollWidth},can_show_form_template:function(e){return!!$f.user.is_admin&&(!e.get("is_secure")||$f.user.is_owner||e.get("user_id")==$f.user.id)},hash_str:function(e){var t=0;if(0===e.length)return"";for(var i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return t.toString()},is_element_in_viewport:function(e){var t=e.get(0).getBoundingClientRect(),i=$(window),n=document.documentElement,s=i.height()||n.clientHeight,o=i.width()||n.clientWidth,a=t.top<=s&&t.top+t.height>=0,r=t.left<=o&&t.left+t.width>=0;return a&&r},select_ajax:function(){return $f.mobile?$f.mobile.ajax:$.ajax},format_bytes:function(e,t){if(t=t<=0?0:t||2,0===(e=e||0))return"0 Bytes";var i=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,i)).toFixed(t))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i])},convert_to_company_temperature:function(e){var t="C"===$f.utils.get_active_company().get("temperature_unit"),i=t?"°C":"°F";if(isNaN(parseFloat(e)))return"";var n=t?$f.utils.fahrenheit_to_centigrade(e):e;return"".concat($f.utils.round(n,1)," ").concat(i)},fahrenheit_to_centigrade:function(e,t){return t=void 0!==t?t:1,$f.utils.round(5*(e-32)/9,t)},centigrade_to_fahrenheit:function(e,t){return t=void 0!==t?t:1,$f.utils.round(9*e/5+32,t)},round:function(e,t){var i=Math.pow(10,t||0);return Math.round(e*i)/i},get_rounded_temperature_in_fahrenheit_units:function(e,t){var i="number"==typeof t&&-1===t.toString().indexOf(".")?t:$f.utils.DECIMALS_IN_TEMPERATURE_VALUE;return"C"===$f.active_company.get("temperature_unit")&&(e=$f.utils.centigrade_to_fahrenheit(e,i)),parseFloat(e)},get_rounded_temperature_in_configured_units:function(e,t){var i="number"==typeof t&&-1===t.toString().indexOf(".")?t:$f.utils.DECIMALS_IN_TEMPERATURE_VALUE;return"C"===$f.active_company.get("temperature_unit")&&(e=$f.utils.fahrenheit_to_centigrade(e,i)),e},evaluate_operator:function(e,t,i){if(_.contains(["between","outside"],e)&&(!_.isArray(i)||2!==i.length))return console.error("Trying to check search criteria value: ".concat(i,' with operator "').concat(e,'"')),!1;switch(e){case"between":return t>=i[0]&&t<i[1];case"inclusive_between":return t>=i[0]&&t<=i[1];case"outside":return t<i[0]||t>i[1];case"==":return t===i;case"<":return t<i;case"<=":return t<=i;case">":return t>i;case">=":return t>=i;default:return console.error("Bad operator passed into evaluate_operator: ".concat(e)),!1}},get_legacy_range_event_value:function(e,t){var i=e.get("acceptance_criteria"),n=[];return _.each(t,(function(t){i.each((function(i){i.get("metadata").get("acceptance_value")===t&&n.push({field_id:e.get("id"),operator_id:i.get("condition").get("operator_id"),value:i.get("condition").get("condition_value")})}))})),{criterias:new FieldEventSearchCriterias(n,{metadata:{type:"formfield_dependent_event",simple_logic:"or"}}).toJSON()}},get_legacy_yesno_event_value:function(e,t){var i=e.get("acceptance_criteria"),n=i.find_criterion_with_condition_value_of(!0),s=i.find_criterion_with_condition_value_of(!1);return!!_.isEqual([n.get("metadata").get("acceptance_value")],t)||!_.isEqual([s.get("metadata").get("acceptance_value")],t)&&(_.isEqual(t,[-1,1])?-1:null)},parse_zenput_api_response:function(e,t){return _.isEmpty(t)?t:t.meta||t.results?(e.paginator&&(void 0!==t.count?e.paginator.set("results_count",t.count):t.meta&&void 0!==t.meta.count&&e.paginator.set("results_count",t.meta.count)),t.data&&t.meta?t.data:t.results):t},validate_file_type:function(e,t){if(!(e=e||{}).type)return!1;var i=e.type;return _.contains(t,i)},is_mobile_app:function(){return!!$f.mobile},log_error:function(e,t,i){if(void 0===t&&(t={}),void 0===i&&(i=!0),$f.utils.is_mobile_app())$f.mobile.logging.log_error(e,t,i);else{i&&console.error(e,t);var n=window.Sentry;n&&n.withScope((function(i){i.setExtras(t),n.captureMessage(e)}))}},split_datetime_string:function(e){if("string"==typeof e){var t=e.split("-");if(3==t.length)return new Date(t[0],t[1]-1,t[2])}return new Date},template_string:function(e){return _.template("<%- untemplated_string %>")({untemplated_string:e})}};$f.storage=null;var global_formula_utils={allow_na_values:function(e){return-1!==["sbt","sum"].indexOf(e)},calculate:function(e,t){var i=this,n=0,s=0,o=!0,a=e.get("metadata").formula_operation_type,r=e.get("metadata").formula_ignore_unanswered,l=e.get("metadata").formula_advanced||"",c=$f.utils.formula.allow_na_values(a);_.each(e.get("options"),(function(_){var u=t.get(_.id);if(!u)return!1;if("yesno"===u.get("type")&&"na"===u.get("value")&&!c)return!0;if(r&&(""===u.get("value")||null===u.get("value")||void 0===u.get("value")))return!0;var d=i.get_field_weight(_,u,e);if(null==d||null==d)return!1;switch(a){case"pct":s+=i.get_max_weight(d,_,u,e),n+=d;break;case"avg":s++,n+=d;break;case"sum":n+=d;break;case"adv":l=$f.utils.formula._replace_question_id({formula:l,field_id:u.id,weight:d});break;case"sbt":n=o?d:n-d}return o=!1,!0}));var u=null;switch(a){case"pct":0!=s&&(u=n/s*100);break;case"avg":0!=s&&(u=n/s);break;case"sum":case"sbt":u=n;break;case"adv":u=this._extract_equation(l)}e.set("value",null==u?null:parseFloat(u.toFixed(2)))},get_max_weight:function(e,t,i){if(!("range"!==i.get("type")||t.weights&&t.weights.length)){var n=i.get("options");if(n instanceof Array&&2===n.length)return n[1]}return void 0===t.max_weight||null===t.max_weight?e:t.max_weight},get_field_weight:function(e,t,i){var n=void 0,s=function(e){return"string"!=typeof e?e:"true"==e||"false"==e?"true"===e:""===e?null:e},o=function(e,t){if(!("weights"in e)||!e.weights||0===e.weights.length)return parseFloat(t.get("value"));if(void 0===n&&(n=t.get("value")),null===n||""===n)return 0;for(var i in e.weights){var s=e.weights[i],o=s.field_value,a=s.operator_id,r=s.value;if(null==r)return null;if("<"===a&&n<o)return parseFloat(r);if("between"===a&&n>=o[0]&&n<o[1])return parseFloat(r);if(">="===a&&n>=o)return parseFloat(r)}},a=0;switch(t.get("type")){case"number":case"range":if(i.get("metadata").formula_version<3){a=parseFloat(t.get("value"));break}a=o(e,t);break;case"temperature":case"stopwatch":if(i.get("metadata").formula_version<3)break;a=o(e,t);break;case"formula":a=parseFloat(t.get("value"));break;case"checkbox":"checkbox"!=t.get("type")||null!=t.get("value")&&""!=t.get("value")&&null!=t.get("value")||(n=!1);case"yesno":case"select":var r=null;if(n=null==n?t.get("value"):n,i.get("metadata").formula_version<2)r=e.weights[n];else{if(null!==(n=s(n))&&"object"==typeof n){if(1!=n.length)break;n=n[0]}for(var l in e.weights)if(s(e.weights[l].id)===n){r=e.weights[l].value;break}}if(null==r||null==r)return null;a=parseFloat(r)}return isNaN(a)?0:a},calculate_all:function(e){var t=this;_.each(e.where({type:"formula"}),(function(i){t.calculate(i,e)}))},_are_parentheses_balanced:function(e){for(var t=[],i={"(":")"},n={")":!0},s=0;s<e.length;s++){var o=e[s];if(i[o])t.push(o);else if(n[o]&&i[t.pop()]!==o)return!1}return 0===t.length},_replace_question_id:function(e){if(void 0===e||0!==e.field_id&&!e.field_id)throw new Error("Must provide options with a field with an id");var t=new RegExp("Q"+e.field_id+"(?=\\-|\\+|\\*|\\/|\\s|\\(|\\)|$)","gi");return(e.formula||"").replace(t,e.weight||0)},_validate_equation:function(e){var t=(e=e||"").replace(/\s*/g,"");return!/[!$%^&_|~=`{}\[\]:";'<>?,]/g.test(t)&&!/(Q[^\d]+)|[^q()+*\-\/((\d+)|(\d+)\.\d*)]/gi.test(t)&&/((\d+)|(\d+)\.\d*)|(Q[0-9]+)|(Q([0-9]+)[+\-\*\/])|(((\d+)|(\d+)\.\d*)[+\-\*\/]((\d+)|(\d+)\.\d*))/gi.test(t)&&this._are_parentheses_balanced(t)},_extract_equation:function(value){if(value=value||"",!this._validate_equation(value))return null;try{var user_formula=value.replace(/\s*/g,""),a=eval(user_formula);if(isNaN(a)||!isFinite(a))throw new Error("The result is not a number or infinity");return a}catch(e){return null}}},BaseZenputModel=Backbone.Model.extend({legacy_classname:"$f.models.BaseZenputModel",_model_history:null,submodels:{},constructor:function(e,t){e=this._get_submodeled_attributes(e),BaseZenputModel.__super__.constructor.call(this,e,t),this._model_history=[]},store:function(){this._model_history.push(JSON.stringify(this.toJSON()))},restore:function(){0!=this._model_history.length&&this.set(JSON.parse(this._model_history.pop()))},clear_history:function(){this._model_history=[]},set:function(e,t,i){var n=null;return null==e?this:("object"==typeof e?(n=e,i=t):(n={})[e]=t,n=this._get_submodeled_attributes(n),BaseZenputModel.__super__.set.call(this,n,i))},_get_submodels:function(){return this.submodels?_.result(this,"submodels"):{}},_get_submodeled_attributes:function(e){if(!e)return{};var t=this._get_submodels();if(0==Object.keys(t).length)return e;var i=this;return $.each(t,(function(t,i){var n=e[t];return!n||n instanceof Backbone.Model||n instanceof Backbone.Collection||void(e[t]=new i(e[t]))})),$.each(e,(function(e,n){return!(n instanceof Backbone.Model||n instanceof Backbone.Collection)||!t[e]||(i.stopListening(n,"change"),void i.listenTo(n,"change",(function(t){i.trigger("change",n),i.trigger("change:"+e,n)})))})),e},parse:function(e){return $f.utils.parse_zenput_api_response(this,e)}}),BaseZenputCollection=Backbone.Collection.extend({legacy_classname:"$f.collections.BaseZenputCollection",typeahead_search_attrs:["name"],cache_options:null,is_fetching:!1,is_fetched:!1,search_param:"search_query",fetch:function(e){var t=this,i=(e=e||{}).success||function(){},n=e.error||function(){};return this.cache_options=this.cache_options||{},this.cache_options.cache_buster&&Backbone.fetchCache.clearItem(this),this.cache_options.cache&&(e.cache=!0,e.expires=this.cache_options.cache_ttl||60),this.is_fetching=!0,e.success=function(e){i.apply(t,arguments),t.set_fetch_states(!0)},e.error=function(e){n.apply(t,arguments),t.set_fetch_states(!1)},BaseZenputCollection.__super__.fetch.call(this,e)},set_fetch_states:function(e){this.is_fetching=!1,this.is_fetched=e},parse:function(e){return $f.utils.parse_zenput_api_response(this,e)},_collection_typeahead_search:function(e){if(!e)return this;var t=this;return this.cache_enabled&&console.warn("WARNING: using _collection_typeahead_search() with Cache 2.0. This degrades performance and may lead to incorrect results."),e=$f.utils.escape_for_regex(e.toLowerCase()),t.filter((function(i){var n=new RegExp(e,"gi"),s="";return $.each(t.typeahead_search_attrs,(function(e,t){s+=i.get(t)?" "+i.get(t):""})),s=s.trim().toLowerCase(),n.test(s)}))},typeahead_search:function(e,t,i){e||(e=""),t||(t=function(){});var n=this;if(!this.cache_enabled&&!1===i)return t(this._collection_typeahead_search(e));var s=function(){n.cache_enabled?t(n):t(n._collection_typeahead_search(e))},o={start:0};o[this.search_param]=e,this.paginator.set(o),this.fetch({reset:!0,timeout:2e4,success:function(){s()},error:function(){s()}})},comparator:function(e){var t=null;try{t=e.get(this.paginator.get("order_by"))}catch(e){}return"string"==typeof t&&(t=t.toLowerCase()),t},in_memory_search:function(e,t){try{t=t||this.typeahead_search_attrs[0]}catch(e){throw new Error("Unknown search_key for in_memory_search()")}return""===e||void 0===e?new this.constructor(this.models):new this.constructor(this.filter((function(i){return new RegExp(e,"gi").test(i.get(t))})))}}),ZenputStorage=BaseZenputModel.extend({legacy_classname:"$f.models.ZenputStorage",defaults:{expiration:0,storage_base_url:"",read_auth:null,write_auth:null},_is_fetching:!1,_refresh_callback_queue:null,url:"/api/v2/users/current/storage_auth/",initialize:function(e){e=e||{},$.extend(this,e),this._refresh_callback_queue=[],this._load_bootstrapped_data()},refresh:function(e){e=$f.utils.setup_options_callbacks(e);var t=this;this._is_expiring()?(this._refresh_callback_queue.push(e),this._is_fetching||(this._is_fetching=!0,this.fetch({success:function(){t._is_fetching=!1,t._fire_all_refresh_callbacks_of_type("success")},error:function(){t._is_fetching=!1,t._fire_all_refresh_callbacks_of_type("error")}}))):e.success()},_fire_all_refresh_callbacks_of_type:function(e){for(;this._refresh_callback_queue.length;){var t=this._refresh_callback_queue.pop()[e];t&&t()}},sanitize_s3_filename:function(e){return e.replace(/[^a-zA-Z 0-9_-]/g,"").replace(/ /g,"_")},create_s3_filepath:function(e,t,i,n){if(!n)throw new Error("Programmer Error: Unknown filename in $f.storage.create_s3_filepath");if(!t)throw new Error("Programmer Error: Unknown category in $f.storage.create_s3_filepath");if(!e)throw new Error("Programmer Error: Unknown company_id in $f.storage.create_s3_filepath");if(i&&"number"!=typeof i||i%1!=0)throw new Error("Programmer Error: instance_id must be an integer");if("number"!=typeof e||e%1!=0)throw new Error("Programmer Error: company_id must be an integer");var s=n.split("."),o=s.length>1?"."+s.pop():"";n=s.join("."),n=this.sanitize_s3_filename(n),n="".concat(n,"-").concat((new Date).getTime()+_.random(0,99999)).concat(o);var a="company/".concat(e,"/").concat(t,"/");return i&&(a+="id/".concat(i,"/")),(a+="".concat(moment.utc().format("YYYY/MM/DD"),"/").concat(n)).toLowerCase()},create_form_submission_media_filename:function(e,t,i){return this.create_s3_filepath(i,"forms/submissions",t,e)},get_thumbnail:function(e,t){return t=t||"234",e.replace(/\.([^.]+)$/,"-".concat(t,"x").concat(t,".$1"))},is_data_uri:function(e){return String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),e.startsWith("data:")||e.startsWith("cdvfile:")||e.startsWith("ms-appdata:")||e.startsWith("file:")},get_high_res_url_from_thumbnail:function(e,t){return t=t||"234",e.replace("-"+t+"x"+t+".",".")},get_file_extension:function(e){return e.substr(e.lastIndexOf(".")+1).toLowerCase()},get_upload_form_data:function(e){e.success=e.success||function(){},e.error=e.error||function(){};var t=this;this.refresh({success:function(){e.success(t._get_upload_form_data_from_auth({write_auth:t.get("write_auth"),file:e.file,filename:e.filename,file_type:e.file_type}))},error:function(){e.error()}})},perform_file_upload:function(e){(e=$f.utils.setup_options_callbacks(e)).on_progress=e.on_progress||function(){},e.timeout=e.timeout||3e4;var t=this;if(!e.filename)throw new Error("Programmer error: no filename specified for S3 upload.");if(!e.file)throw new Error("Programmer error: no file specified for S3 upload.");if(window.FormData){var i=new XMLHttpRequest;i.upload&&(i.upload.onprogress=function(t){t.lengthComputable&&e.on_progress(t.loaded/t.total*100)});var n=e.mime_type||e.file.type;return this.get_upload_form_data({file:e.file,filename:e.filename,file_type:n,success:function(s){$.ajax({type:"POST",url:t._get_upload_url(),processData:!1,contentType:!1,data:s,timeout:e.timeout,xhr:function(){return i},error:function(){e.error("Unable to upload photo.")},success:function(){if(window.FileReader&&-1!==n.indexOf("image")){var t=new FileReader;t.onloadend=function(){e.success(e.filename,t.result)},t.onerror=function(){e.success(e.filename)},t.readAsDataURL(e.file)}else e.success(e.filename)}})},error:function(t){e.error(t.message||"Unable to upload photo.")}}),i}e.error("Your browser does not support this feature.")},get_storage_base_url:function(){return this.get("storage_base_url")},get_storage_full_url:function(e){var t="".concat(this.get_storage_base_url(),"/").concat(e),i=this.get("read_auth"),n=$f.utils.get_active_company().id;return-1!==t.indexOf("Policy=")?t:"string"==typeof e&&0!==e.indexOf("company/".concat(n,"/"))?"".concat($f.base_url,"/api/v2/users/current/storage?path=").concat(e,"&redirect=true"):$f.utils.get_active_company().has_feature("unrestricted_s3")?t:i?"".concat(t,"?").concat(i.query_string):t},_load_bootstrapped_data:function(){$f.storage_auth_data&&this.set($f.storage_auth_data)},_is_expiring:function(){return moment(this.get("expiration")).subtract(1,"hour").isBefore(moment())},_get_upload_url:function(){var e=this.get("write_auth"),t=this.get("storage_base_url");return $f.utils.get_active_company().has_feature("unrestricted_s3")?t:e?"".concat(t,"/?").concat(e.query_string):t},_get_upload_form_data_from_auth:function(e){var t=new FormData;return t.append("key",e.filename),t.append("Content-Type",e.file_type),t.append("acl",e.write_auth.acl),t.append("policy",e.write_auth.policy_base64),t.append("signature",e.write_auth.signature),t.append("AWSAccessKeyId",e.write_auth.key_id),t.append("x-amz-server-side-encryption",e.write_auth.encryption),t.append("file",e.file),t}}),AcceptanceCriterionMetadata=BaseZenputModel.extend({legacy_classname:"$f.models.AcceptanceCriterionMetadata",defaults:{acceptance_value:0}}),AcceptanceCriterionCondition=BaseZenputModel.extend({legacy_classname:"$f.models.AcceptanceCriterionCondition",defaults:{condition_value:null,operator_id:null},get_display_for_operator_id:function(){switch(this.get("operator_id")){case">=":return"≥";case"<=":return"≤";default:return this.get("operator_id")}},evaluate_value:function(e){return $f.utils.evaluate_operator(this.get("operator_id"),e,this.get("condition_value"))},is_range_operator:function(){return _.contains(["outside","between"],this.get("operator_id"))}}),AcceptanceCriterion=BaseZenputModel.extend({legacy_classname:"$f.models.AcceptanceCriterion",submodels:{metadata:AcceptanceCriterionMetadata,condition:AcceptanceCriterionCondition},initialize:function(){this.get("metadata")||this.set("metadata",new this.submodels.metadata),this.get("condition")||this.set("condition",new this.submodels.condition)}}),AcceptanceCriteriaCollection=BaseZenputCollection.extend({legacy_classname:"$f.collections.AcceptanceCriteria",model:AcceptanceCriterion,initialize:function(e){e=e||{},$.extend(this,e)},_evaluate_acceptance_values:function(e,t){return this.filter((function(t){return t.get("metadata").get("acceptance_value")==e})).reduce((function(e,i){return e+(i.get("condition").evaluate_value(t)?1:0)}),0)>0},get_matched_criteria:function(e){return this.find((function(t){if(t.get("condition").evaluate_value(e))return!0}))},evaluate_acceptance_value:function(e){return!0===this._evaluate_acceptance_values(-1,e)?-1:!0===this._evaluate_acceptance_values(1,e)?1:0},find_criterion_with_condition_value_of:function(e){var t=null;return this.each((function(i){i.get("condition").get("condition_value")===e&&(t=i)})),t},toJSON:function(){return JSON.parse(JSON.stringify(this.models))}}),BaseField=BaseZenputModel.extend({legacy_classname:"$f.models.BaseField",acceptance_criteria_klass:AcceptanceCriteriaCollection,defaults:{id:null,key:"",type:null,title:null,instructions:"",value:"",file:null,default_value:null,hidden:!1,visible:!0,metadata:null,options:null,events:null,title_image:null,acceptance_value:null},submodels:function(){return{acceptance_criteria:this.acceptance_criteria_klass}},initialize:function(){if(this.get("title_image")||this.set("title_image",[],{silent:!0}),this.get("options")||this.set("options",[],{silent:!0}),this.get("events")||this.set("events",[],{silent:!0}),this.get("metadata")||this.set("metadata",{},{silent:!0}),$f.mobile&&(void 0===this.id||null===this.id)&&$f.mobile.get_window_collection()){var e=$f.mobile.get_window_collection().metadata;e&&e.get("auto_increment_next_id")&&(this.id=e.get("auto_increment_next_id"))}"formula"!==this.get("type")&&this.get("metadata")&&!_.contains([null,void 0],this.get("metadata").dependent_parent_id)&&this.set("hidden",!0),!0!==this.get("required")||"section"!==this.get("type")&&"instructions"!==this.get("type")||this.unset("required")},remove:function(){this.trigger("destroy",this,this.collection)},get_submission_value:function(){return this.get("value")},get_metadata_attribute:function(e){var t=this.get("metadata");return t instanceof Backbone.Model?t.get(e):t[e]},set_metadata_attribute:function(e,t){var i=this.get("metadata");return i instanceof Backbone.Model?i.set(e,t):i[e]=t},is_dependent_parent:function(){return this.get("events")&&this.get("events").length>0},is_dependent_field:function(){if(!this.get("metadata"))return!1;var e=this.get_metadata_attribute("dependent_parent_id");return 0===e||!!e},get_dependent_field_parent:function(){if(this.is_dependent_field()){var e=this.get_metadata_attribute("dependent_parent_id");return this.collection.get(e)}return null},get_dependent_group_parent:function(){var e=this.get_dependent_field_parent();return!e&&this.is_dependent_parent()?this:e?e.get_dependent_group_parent():null},get_dependent_field_level:function(){var e=$f.utils.DEPENDENT_FIELD_TOP_LEVEL;if(!this.is_dependent_field())return e;e++;for(var t=[this.get_dependent_field_parent()];t.length>0;){var i=t[0],n=i.get_dependent_field_parent();n&&n.id!==i.id&&(e++,t.unshift(n)),t.pop()}return e},get_sorted_dependent_field_ids:function(){var e=this;return this.is_dependent_parent()?_.sortBy(this.get("events"),(function(t){return t.target?e.collection.metadata.get("order").indexOf(t.target.toString()):-1})).map((function(e){return e.target})).filter((function(e){return null!==e})):[]},get_dependent_parent_groups:function(){var e=this,t=[];if(!this.is_dependent_parent())return t;if(null===this.get("events")[0].target)return[[this.id,null]];var i=this.get_sorted_dependent_field_ids(),n=_.last(i),s=this.collection.get(n);for(s||$f.utils.log_error("Invalid dependant field detected, please fix customer data",{form_template_id:e.collection.metadata.get("rdbms_id"),field_id:n}),s&&!s.is_dependent_parent()&&t.push(n);i.length>0;){var o=_.last(i),a=this.collection.get(o);if(i.pop(),a&&a.is_dependent_parent())if(null!==a.get("events")[0].target){_.each(a.get_sorted_dependent_field_ids(),(function(e){return i.push(e)}));var r=_.last(i);e.collection.get(r)&&t.push(r)}else t.push(o)}return _.map(t,(function(t){return[e.id,t]}))},get_dependent_parent_descendents:function(){var e=this;if(!this.is_dependent_parent())return null;for(var t=[this],i=[];t.length;){var n=t[0].get_sorted_dependent_field_ids();_.each(n,(function(n){i.push(n);var s=e.collection.get(n);s.is_dependent_parent()&&t.push(s)})),t.shift()}return this.collection.get_fields_sorted_by_order(i)},is_section_parent:function(){return"section"===this.get("type")},is_section_child:function(){return!!this.get_section_parent()},has_parent_with_dynamic_visibility:function(){return this.is_section_child()&&this.get_section_parent().has_dynamic_visibility()},has_dynamic_visibility:function(){var e=this.get_metadata_attribute("dynamic_visibility")||{},t=!_.isUndefined(e.visibility_choice),i=e.attribute_criteria_filters||{filters:[]},n=!_.isEmpty(i.filters);return t&&n},is_dynamic_visibility_allowed:function(){var e=0!==this.collection.filter((function(e){return e.is_primary_location()})).length;return!this.is_primary_location()&&!this.is_dependent_field()&&!1!==e&&!this.has_parent_with_dynamic_visibility()},is_primary_location:function(){var e=this;if("account"!==this.get("type"))return!1;var t=this.collection.metadata.get("order").map((function(t){return{id:parseInt(t,10),type:e.collection.get(t).get("type")}})).filter((function(e){return"account"===e.type}));return!_.isEmpty(t)&&t[0].id===this.get("id")&&!1===this.is_dependent_field()&&!1===this.is_section_child()},get_section_parent:function(){var e=this;return this.collection.where({type:"section"}).filter((function(t){return t.get_metadata_attribute("section_field_ids").includes(e.id)}))[0]||null},get_next_visible:function(){if(!this.collection)return null;var e=this.collection.get_order(),t=e.indexOf(this.id);if(t>=e.length||-1==t)return null;for(var i=t+1;i<e.length;i++){var n=this.collection.get(e[i]);if(!n.is_currently_hidden)return n}return null},update_metadata:function(e){e=e||{};var t=this.get("metadata");this.set({metadata:$.extend({},t,e)})},set_acceptance_value:function(e){e=void 0!==e&&e;var t=this.get("acceptance_criteria");t&&this.set("acceptance_value",t.evaluate_acceptance_value(this.get("value")),{silent:e})}}),FormMetadata=Backbone.Model.extend({legacy_classname:"$f.models.Metadata",defaults:function(){return{rdbms_id:null,title:"New Form",auto_increment_next_id:0,activity_template:null,date_created:null,order:[],company:{id:null},created_by:{display_name:"",id:null},is_creator_lock:!0,is_secure:!1,is_copy_enabled:!1,is_unanswered_hidden:!1,permit_brandwide_submission_access:!1,is_force_camera:!1,is_show_yesno_history:!1,is_shared_form:!1,is_force_probe_input:!1,allow_auditors_access_locations:!1,order_fields_by_location:!1,template_category:{}}}}),FormSmetadata=Backbone.Model.extend({legacy_classname:"$f.models.FormSmetadata",defaults:{guid:null,time_zone:null,date_created:null,date_submitted:null,date_modified:null,date_completed:null,time_to_complete:null,created_by:null,user_role:null,lat:null,lon:null,distance_to_account:null,environment:null,platform:null,user_agent:null,task:null,project:null,location_custom_field_order:null}}),FormTemplate=Backbone.Model.extend({legacy_classname:"$f.models.FormTemplate",defaults:{id:null,title:null}}),FormTemplates=BaseZenputCollection.extend({legacy_classname:"$f.collections.FormTemplates",model:FormTemplate,user_id:null,group_id:null,role_id:null,is_public:null,category_id:null,shared_only:null,typeahead_search_attrs:["title"],initialize:function(e,t){"object"!=typeof e||t||(t=e),t=t||{},this.user_id=t.user_id||null,this.group_id=t.group_id||null,this.role_id=t.role_id||null,this.is_public=t.is_public||null,this.category_id=t.category_id||null,this.shared_only=t.shared_only||null,this.paginator=new Paginator({order_by:"title"})},url:function(){var e=this.paginator.default_query_string_attrs;if(_.contains(e,"category_id")||e.push("category_id"),_.contains(e,"filter")||e.push("filter"),this.group_id)return"/api/v1/users/group/get_forms_access/"+this.group_id;if(this.user_id)return"/api/v1/users/get_forms_access/"+this.user_id;if(this.role_id)return"/api/v1/users/role/get_forms_access/"+this.role_id;if(this.is_public)return"/api/v1/forms/list_brand_templates/?"+this.paginator.get_query_string({get_count:!0});var t=this.paginator.get_query_string({get_count:!0});return this.shared_only&&(t="shared_only=true&".concat(t)),"/api/v1/forms/list_templates/?".concat(t)},parse:function(e){return FormTemplates.__super__.parse.call(this,e),e.results}}),FormTemplateCategory=Backbone.Model.extend({legacy_classname:"$f.models.FormTemplateCategory",defaults:{id:null,name:null}}),FormTemplateCategories=BaseZenputCollection.extend({legacy_classname:"$f.collections.FormTemplateCategories",model:FormTemplateCategory,paginator:null,categories_with_forms:!0,initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator=new Paginator({start:null,limit:null,order_by:"name"})},url:function(){return this.categories_with_forms?"/api/v1/forms/list_template_categories/?"+this.paginator.get_query_string({get_count:!0}):"/api/v1/forms/get_all_template_categories/?"+this.paginator.get_query_string({get_count:!0})},comparator:function(e){return e.get(this.paginator.get("order_by"))}}),SearchCriteria=BaseZenputModel.extend({legacy_classname:"$f.models.SearchCriteria",defaults:{field_id:"all",operator_id:"contains",value:"",display:""},save:function(){return!0},reset:function(){this.set(this.defaults)},is_team_filter:function(){return-1!=["smetadata.distribute_groups.id","user_group","distribute_group"].indexOf(this.get("field_id"))&&1===this.id},is_no_existing_field:function(e){var t=this.get("field_id");return!isNaN(t)&&null==e.get(t)},is_valid:function(){var e=null!=this.get("value");switch(this.get("operator_id")){case"=":case"!=":case">":case">=":case"<":case"<=":case"between":case"not_between":case"date_specific_after":case"date_specific_before":case"date_occur_between":return e;default:return!0}}}),SearchCriteriaMetadata=Backbone.Model.extend({legacy_classname:"$f.models.SearchCriteriaMetadata",defaults:{name:"",next_criteria_id:1,simple_logic:"and",display_result_type:"list",id:null,version:2,created_by:{id:null,display_name:""},type:null},validation:{name:{required:!0,minLength:1,msg:"Please enter a valid title."}},get:function(e,t){var i=SearchCriteriaMetadata.__super__.get.call(this,e,t);return"next_criteria_id"==e&&(this.attributes.next_criteria_id+=1),i}}),SaveableSearchCriteriaMetadata=SearchCriteriaMetadata.extend({legacy_classname:"$f.models.SaveableSearchCriteriaMetadata",report_type:null,defaults:{name:"",next_criteria_id:1,simple_logic:"and",display_result_type:"xlsx",id:null,version:2,created_by:{id:null,display_name:""},company:{id:null},type:null},initialize:function(e,t){SaveableSearchCriteriaMetadata.__super__.initialize.apply(this,arguments),(t=t||{}).report_type&&(this.report_type=t.report_type),this.get("company")||this.set("company",{},{silent:!0}),this.get("company").id||(this.get("company").id=$f.user.company.id)},get_type_for_display:function(){return this.report_type?this.report_type.get("name"):(console.error("SearchCriteriaList does not have a report_type object. Cannot determine type for display."),"")}}),FormTemplateSubmissionsSearchCriteriaMetadata=SaveableSearchCriteriaMetadata.extend({legacy_classname:"$f.models.FormTemplateSubmissionsSearchCriteriaMetadata",defaults:{name:"",next_criteria_id:1,simple_logic:"and",display_result_type:"list",id:null,version:2,created_by:{id:null,display_name:""},form_template:{id:null,title:null},type:"form_template_submissions"},get_form_template_id:function(){return this.get("form_template").id}}),TaskProjectUtilsMixin={legacy_classname:"$f.models.mixins.TaskProjectUtils",_get_zoned_time:function(e){if(!this.get(e)||!this.get(e).$date)return null;var t=moment(this.get(e).$date);return this.get("time_zone")?t.tz(this.get("time_zone")):t.tz(moment.tz.guess())},get_time_due_str:function(){if(!this.get("date_due")||!this.get("date_start"))return"";var e=this._get_zoned_time("date_due");return e&&this.get("project")&&this.get("project").id?moment(this.get("date_due").$date).diff(moment(this.get("date_start").$date))>855e5?"":"".concat($f.utils.get_formatted_time(e)," ").concat(e.format("z")):""},get_time_start_and_due_str:function(){if(!this.get("project")||!this.get("project").id)return"";var e=this.get_time_due_str();if(!e)return"";var t=this._get_zoned_time("date_start");return t?"".concat($f.utils.get_formatted_time(t)," - ").concat(e):e}},BaseDashboardCardResultListItem=BaseZenputModel.extend(_.extend({defaults:{}},TaskProjectUtilsMixin,{legacy_classname:"$f.models.BaseDashboardCardResultListItem"})),BaseDashboardCardResultList=BaseZenputCollection.extend({legacy_classname:"$f.collections.BaseDashboardCardResultList",model:BaseDashboardCardResultListItem,search_criterias:null,dashboard_filters:null,global_search_options:null,paginator:null,url:"/api/v1/dashboards/dashboard",zenput_code:null,initialize:function(e,t){if(t=t||{},$.extend(this,t),!this.search_criterias)throw new Error("Programmer Error: BaseDashboardCardResultList requires search_criterias");if(!this.dashboard_filters)throw new Error("Programmer Error: BaseDashboardCardResultList requires dashboard_filters");this.paginator=new Paginator({start:0,limit:5,order_by:null})},sync:function(e,t,i){switch(e){case"read":i.url="".concat(t.url,"/search/");break;case"create":case"update":case"delete":throw new Error("Programmer Error: method not supported for $f.dashboards.collections.BaseDashboardCardResultList")}return Backbone.sync(e,t,i)},fetch:function(e){return(e=e?_.clone(e):{}).data=e.data||{},this.global_search_options&&this.global_search_options.update_paginator(this.paginator),$.extend(e.data,this.paginator.toJSON(),{search_criteria:JSON.stringify(this.search_criterias),dashboard_filters:JSON.stringify(this.dashboard_filters)}),e.type="POST",BaseDashboardCardResultList.__super__.fetch.call(this,e)},parse:function(e){return e.results?(this.zenput_code=e.zenput_code,this.paginator&&null!=e.count&&this.paginator.set("results_count",e.count),e.results):e}}),TopItemHeader=Backbone.Model.extend({legacy_classname:"$f.models.TopItemHeader",defaults:{info:{},label:"",sort_key:""}}),TopItemHeaders=Backbone.Collection.extend({legacy_classname:"$f.collections.TopItemsHeadersList",model:TopItemHeader}),DashboardCardResultListWithHeadersMixin={legacy_classname:"$f.collections.mixins.DashboardCardResultListWithHeaders",reset_headers:!1,headers:null,column_filter_index:null,set_headers:function(e){e=e instanceof Backbone.Collection?e.toJSON():e,this.reset_headers?this.headers=new TopItemHeaders:this.headers=this.headers||new TopItemHeaders,e&&this.headers.add(e)},parse:function(e){return e&&e.headers&&this.set_headers(e.headers),this.mixin_super().parse.apply(this,arguments)},get_today_header_id:function(){var e=null;return this.headers.each((function(t){if(!moment(new Date(t.get("label"))).isSame(new Date,"day"))return!0;e=t.id})),e}},SearchCriterias=Backbone.Collection.extend({legacy_classname:"$f.collections.SearchCriteriaList",model:SearchCriteria,metadata:SearchCriteriaMetadata,result_type:{},default_sort:[],constructor:function(e,t){if(t=t||{},$.isArray(e))return SearchCriterias.__super__.constructor.call(this,e,t);var i=e;return null!=e&&(null!=e.search&&(i=e.search),null!=e.metadata&&(t.metadata=e.metadata),null!=e.result_type&&(t.result_type=e.result_type),null!=e.distribute_group_filter&&(t.distribute_group_filter=e.distribute_group_filter)),SearchCriterias.__super__.constructor.call(this,i,t)},initialize:function(e,t){(t=t||{}).metadata?this.metadata=new this.metadata(t.metadata):this.metadata=new this.metadata,t.result_type?this.result_type=$.extend(!0,{},t.result_type):this.result_type={}},isNew:function(){return null===this.metadata.id},get_next_criteria_id:function(){return this.metadata.get("next_criteria_id")},set_display_result_type:function(e,t){this.metadata.set("display_result_type",e),this.result_type[e]=t,this.result_type[e].type=e},fetch:function(e){console.error("Programmer Error: Fetch is not implemented in SearchCriterias")},save:function(e,t){console.error("Programmer Error: Save is not implemented in SearchCriterias")},destroy:function(e,t){console.error("Programmer Error: Destroy is not implemented in SearchCriterias")},save_local:function(e){this.isNew()&&localStorage.setItem(e,JSON.stringify(this))},_prepareModel:function(e,t){return t=t||{},e instanceof Backbone.Model?null!=e.get("id")&&null!=e.get("id")||e.set("id",this.get_next_criteria_id()):null!=e&&null==e.id&&(e.id=this.get_next_criteria_id()),SearchCriterias.__super__._prepareModel.call(this,e,t)},toJSON:function(e){var t={};return t.search=SearchCriterias.__super__.toJSON.call(this,e),t.metadata=this.metadata.toJSON(e),t.result_type=$.extend(!0,{},this.result_type),t},reset_from_another:function(e,t){var i;i=e instanceof Backbone.Collection?e.toJSON():e,this.reset(i.search,t),this.metadata.clear({silent:!0}),this.metadata.set(i.metadata),this.result_type=i.result_type||{}}}),FieldEventSearchCriteria=SearchCriteria.extend({legacy_classname:"$f.models.FieldEventSearchCriteria",validate_value:function(e){return $f.utils.evaluate_operator(this.get("operator_id"),e,this.get("value"))}}),FieldEventSearchCriterias=SearchCriterias.extend({legacy_classname:"$f.collections.FieldEventSearchCriterias",model:FieldEventSearchCriteria,metadata:SearchCriteriaMetadata.extend({toJSON:function(){var e=SearchCriteriaMetadata.prototype.toJSON.apply(this,arguments);return delete e.display_result_type,delete e.created_by,delete e.name,e}}),validate_value:function(e){var t=0;return this.each((function(i,n){if(!i.validate_value(e))return!0;t++})),"and"==this.metadata.get("simple_logic")&&t==this.length||"or"==this.metadata.get("simple_logic")&&t>0}}),Submission=Backbone.Model.extend({legacy_classname:"$f.models.Submission",defaults:{form_structure:null}}),Submissions=Backbone.Collection.extend({legacy_classname:"$f.collections.Submissions",search_criterias:null,rdbms_id:null,paginator:null,paginator_options:{output:"list",data_source:"elastic_search",view_type:"full"},model:Submission,url:function(){return this.rdbms_id?"/api/v1/forms/list/"+this.rdbms_id:"/api/v1/forms/list/"},triggers:{sort_change_noop:"reports:collections:submissions:change_sort",columns_change_noop:"reports:collections:submissions:change_columns"},initialize:function(e,t){(t=t||{}).paginator_options&&$.extend(this.paginator_options,t.paginator_options),$.extend(this,t);var i=this;if(!this.search_criterias)throw new Error("Programmer error: search_criterias not set");this.paginator||(this.paginator=new SubmissionsPaginator(this.paginator_options)),this.on("add remove reset",(function(){i.paginator.set("results_count",i.length)}))},comparator:function(e){return-e.get("form_structure").smetadata.get("date_submitted").$date},fetch:function(e){return(e=e?_.clone(e):{}).data=e.data||{},$.extend(e.data,this.paginator.toJSON(),{search_criteria:JSON.stringify(this.search_criterias)}),$.extend(e,{dataType:"json",type:"POST",cache:!1}),Submissions.__super__.fetch.call(this,e)},parse:function(e,t){var i=e,n=[];return e.form_submissions&&(i=e.form_submissions),$.each(i,(function(e,t){var i=new FormStructure(t);n.push({form_structure:i,id:i._id.$oid})})),n},fetch_next:function(e){this.paginator.set("start",this.paginator.get("start")+this.paginator.get("limit")),this.fetch(e)},fetch_previous:function(e){return this.paginator.get("start")<0?(e.error&&e.error(this,null,e),!1):(this.paginator.set("start",this.paginator.get("start")-this.paginator.get("limit")),this.fetch(e))},get_list_of_submissions:function(){var e=[];return $.each(this.models,(function(t,i){e.push(i.get("form_structure"))})),e},set_columns:function(e){this.search_criterias.result_type.list?(this.search_criterias.result_type.list.columns=e,this.trigger("reports:collections:submissions:change_columns")):this.set_display_result_type([{field_id:"smetadata.date_submitted",order:-1}],e)},get_columns:function(){return this.search_criterias.get_list_columns()},set_columns_from_headers:function(e){var t=[];$.each(e.get_sorted_fields(),(function(e,i){t.push({field_id:i.get("id"),order:i.get("order")})})),this.set_sort(t)},set_sort:function(e){this.search_criterias.result_type.list?(this.search_criterias.result_type.list.sort=e,this.trigger("reports:collections:submissions:change_sort")):this.set_display_result_type(e,[])},set_display_result_type:function(e,t){this.search_criterias.set_display_result_type("list",{sort:e,columns:t}),this.trigger("reports:collections:submissions:change_sort"),this.trigger("reports:collections:submissions:change_columns")}}),SensorSubmissions=Submissions.extend({legacy_classname:"$f.collections.SensorSubmissions",url:function(){return"/api/v1/sensors/list/"+this.rdbms_id},parse:function(e,t){var i=[];return $.each(e.form_submissions,(function(e,t){var n=new FormStructure(t);i.push({form_structure:n,id:n._id})})),i},fetch:function(e){return this.search_criterias.metadata.set("type","sensor_form_submissions"),SensorSubmissions.__super__.fetch.call(this,e)}}),DistributeGroups=BaseZenputCollection.extend({legacy_classname:"$f.collections.DistributeGroups",paginator:null,user_id:null,hierarchy_connect_true_root:!1,_hierarchy:null,model:function(e,t){return new DistributeGroup(e,t)},initialize:function(e){e=e||{},this.paginator=new Paginator({order_by:"name"}),this.paginator.set("limit",9999),this.user_id=e.user_id?e.user_id:null},url:function(){if(this.user_id)return"/api/v1/users/groups/user/"+this.user_id;var e=this.paginator.default_query_string_attrs;return _.contains(e,"group_id")||e.push("group_id"),"/api/v1/users/groups/?"+this.paginator.get_query_string({get_count:!0})},parse:function(e){return this.paginator.set("results_count",e.count),e.results},comparator:function(e){return[e.get("is_editable"),e.get(this.paginator.get("order_by"))]},_set_hierarchy:function(e,t){var i=this;if((null==this._hierarchy||t)&&(this._hierarchy=new DistributeGroups,this.length)){var n=this.findWhere({is_editable:!1,is_root:!0});n||(n=this.findWhere({is_root:!0}),this.hierarchy_connect_true_root=!1);var s=function(e,t){var n=e.get("id");if(null!=n){var o=i.where({parent_distribute_group_id:n});0!=o.length&&(e.get("child_distribute_groups")||e.set({child_distribute_groups:new DistributeGroups,depth:t},{silent:!0}),$.each(o,(function(i,n){n.set("depth",t+1,{silent:!0}),s(n,t+1);var o=e.get("child_distribute_groups");o.add(n,{silent:!0}),this.collection.get(e.id)&&(this.collection.get(e.id).set("child_distribute_groups",o,{silent:!0}),e.set("child_distribute_groups",o,{silent:!0}))})))}};this.hierarchy_connect_true_root&&$.each(this.where({is_root:!0,is_editable:!0}),(function(e,t){t.set({parent_distribute_group:n,parent_distribute_group_id:n.id},{silent:!0})}));var o={is_root:!0};if(this.hierarchy_connect_true_root&&(o.is_editable=!1),$.each(this.where(o),(function(e,t){s(t,0),i._hierarchy.add(t)})),!e)for(var a=-1,r=function(e){e&&e.get("child_distribute_groups")&&e.get("child_distribute_groups").length>0&&e.get("child_distribute_groups").each((function(e,t){r(e)})),!e||e.get("child_distribute_groups")&&0!=e.get("child_distribute_groups").length||e.get("is_associated")||(e.trigger("destroy",e,e.collection),a++)};0!=a;)a=0,this.each((function(e,t){r(e)}))}},get_hierarchy:function(e,t){return this._set_hierarchy(e,t),this._hierarchy}}),DistributeGroup=BaseZenputModel.extend({legacy_classname:"$f.models.DistributeGroup",defaults:{id:null,name:null,is_associated:!1,is_editable:!0,parent_distribute_group:null,parent_distribute_group_id:null,child_distribute_groups:null},submodels:{child_distribute_groups:DistributeGroups},url:function(){return"/api/v1/users/group/get/"+this.id},validation:{name:{required:!0,minLength:2}}}),UserDistributeGroupAndRole=Backbone.Model.extend({legacy_classname:"$f.models.UserDistributeGroupAndRole",defaults:{id:null,raw_id:null,name:null,type:null,is_registered:null,user_role:null}}),UsersDistributeGroupsAndRoles=BaseZenputCollection.extend({legacy_classname:"$f.collections.UsersDistributeGroupsAndRoles",model:UserDistributeGroupAndRole,paginator:null,typeahead_search_attrs:["name","address"],initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator=new Paginator,t.exclude_groups_with_parents&&this.paginator.set("exclude_groups_with_parents",!0),t.allow_all_company_group&&this.paginator.set("allow_all_company_group",!0),t.include_roles&&this.paginator.set("include_roles",!0),t.show_null_user&&(this.paginator.set("show_null_user",!0),this.paginator.set("null_user_name",t.null_user_name))},url:function(){var e="/api/v1/users/list_users_groups/?"+this.paginator.get_query_string();if(this.paginator.get("exclude_users_roles")){var t=_.map(this.paginator.get("exclude_users_roles").models,(function(e,t){return e.get("user_role_id")}));e+="&exclude_user_role_ids="+(t=_.filter(t,(function(e,t){return e}))).join($f.utils.STRING_DELIMITER)}return this.paginator.get("exclude_groups_with_parents")&&(e+="&exclude_groups_with_parents=True"),this.paginator.get("allow_all_company_group")&&(e+="&allow_all_company_group=True"),this.paginator.get("include_roles")&&(e+="&include_roles=True"),this.paginator.get("show_null_user")&&(e+="&show_null_user=True&null_user_name="+this.paginator.get("null_user_name")),e}}),UsersDistributeGroupsAndRolesForFormDistribution=UsersDistributeGroupsAndRoles.extend({legacy_classname:"$f.collections.UsersDistributeGroupsAndRolesForFormDistribution",parse:function(e){$.each(e.results.users.results,(function(e,t){if(t.type="user","string"==typeof t.id&&_.contains(t.id,"~"))return!0;t.raw_id=t.id,t.id="user~"+t.id})),$.each(e.results.groups.results,(function(e,t){if(t.type="group","string"==typeof t.id&&_.contains(t.id,"~"))return!0;t.raw_id=t.id,t.id="group~"+t.id}));var t=e.results.users.results.concat(e.results.groups.results);return this.include_roles&&($.each(e.results.roles.results,(function(e,t){if(t.type="role","string"==typeof t.id&&_.contains(t.id,"~"))return!0;t.raw_id=t.id,t.id="role~"+t.id})),t=t.concat(e.results.roles.results)),t}}),FormStructure=Backbone.Collection.extend({legacy_classname:"$f.models.FormStructure",model:BaseField,metadata:FormMetadata,smetadata:FormSmetadata,subscribers:null,comparator:function(e){return e.get("id")},constructor:function(e,t){if(!e||null==e)return FormStructure.__super__.constructor.call(this),this.metadata=new this.metadata,void(this.smetadata=new FormSmetadata);e.zp_fields?(this._id=e.id,FormStructure.__super__.constructor.call(this,e.zp_fields),this.metadata=new this.metadata(e.zp_metadata),this.smetadata=new this.smetadata(e.zp_smetadata)):(this._id=e._id,FormStructure.__super__.constructor.call(this,e.fields),this.metadata=new this.metadata(e.metadata),this.smetadata=new this.smetadata(e.smetadata)),e.subscribers&&(this.subscribers=new Users(e.subscribers))},toJSON:function(){var e={fields:this.map((function(e){return e.toJSON()}))};return _.extend(e,{_id:this._id}),_.extend(e,{metadata:this.metadata.toJSON()}),_.extend(e,{smetadata:this.smetadata.toJSON()}),e},remove:function(e){var t=this.get_order(),i=t.indexOf(e.id.toString());i>-1&&(t.splice(i,1),this.metadata.set("order",t)),FormStructure.__super__.remove.call(this,e),e.remove()},each:function(e,t,i){var n=this,s=this.get_order(),o=null!=i&&null!=i.exclude?i.exclude:[];_.each(s,(function(t){var i=n.get(t);if(-1==$.inArray(i.get("type"),o))return e.call(this,i,t)}),t)},reset_from_another:function(e,t){var i=this,n=e instanceof Backbone.Collection?e.toJSON():e;this.metadata.clear({silent:!0}),this.smetadata.clear({silent:!0}),this.models=[],this.metadata.set(n.metadata),this.smetadata.set(n.smetadata),_.each(n.fields,(function(e){i.models.push(new BaseField(e))})),this.length=this.models.length},get_order:function(){return this.metadata.get("order")},get_next_field_id_by_id:function(e){var t=this.get_order();return t[t.indexOf(e.toString())+1]},get_previous_field_id_by_id:function(e){var t=this.get_order();return t[t.indexOf(e.toString())-1]},get_last_field_id:function(){return _.last(this.get_order())},is_submitted:function(){return!!this.smetadata.get("date_submitted")},get_fields_sorted_by_order:function(e){var t=this;return _.sortBy(e,(function(e){return t.get_order().indexOf(e.toString())}))},get_dependent_parents:function(){return this.filter((function(e){return e.is_dependent_parent()}))},get_dependent_field_groups:function(){var e=this.get_dependent_parents();return _.reduce(e,(function(e,t){return _.each(t.get_dependent_parent_groups(),(function(t){e.push(t)})),e}),[])},_remove_nested_parents:function(e,t){return _.filter(e,(function(e){return"section"===t.get("type")?e.get_dependent_field_level()<t.get_dependent_field_level():e.get_dependent_field_level()<=t.get_dependent_field_level()}))},get_section_references:function(){var e=this,t=[];if(0==this.models.length)return{};var i=this.get_order();return _.reduce(i,(function(i,n){var s=e.get(n),o=_.last(t);return t.length&&("section"===s.get("type")&&s.get_dependent_field_level()<=o.get_dependent_field_level()&&(t=e._remove_nested_parents(t,s)),s.get_dependent_field_level()<o.get_dependent_field_level()&&(t=e._remove_nested_parents(t,s)),_.each(t,(function(e){i[e.id].section_field_ids.push(s.id)}))),"section"===s.get("type")&&(i[s.id]={section_field_ids:[],section_parent_id:t.length?o.id:null},t.push(s)),i}),{})},get_pdf_url:function(e){if(!this.is_submitted())return e(null);$f.utils.select_ajax()({url:"/api/v1/forms/get/"+this._id.$oid+"?output=pdf_url",dataType:"json",type:"GET",success:function(t){e(t.pdf_url)}})}},{get_share_link:function(e,t,i){$f.utils.select_ajax()({url:"/api/v1/forms/share/".concat(e,"/"),dataType:"json",type:"GET",success:function(e){t(e.results.url)},error:function(e){i(e)}})}}),Paginator=Backbone.Model.extend({legacy_classname:"$f.models.Paginator",defaults:{results_count:0,start:0,limit:20,order_by:"name",search_by:"accounts",search_query:"",num_selected:0,select_all:!1},default_query_string_attrs:null,initialize:function(){this.default_query_string_attrs=["start","limit","order_by","search_by","search_query","form_template_id"],this.listenTo(this,"change:select_all",this.change_select_all),this.set("tz",jstz.determine().name())},change_select_all:function(e){var t=e.get("select_all")?e.get("results_count"):0;e.set("num_selected",t)},reset_pagination:function(){this.set("start",0),this.set("num_selected",0)},get_query_string:function(e){(e=e||{}).attrs||(e.attrs=this.default_query_string_attrs);var t="",i=this;return $.each(e.attrs,(function(e,n){var s=i.get(n);if(null===s||""===s||void 0===s)return!0;var o=s instanceof Object?JSON.stringify(s):s;t+="".concat(n,"=").concat(encodeURIComponent(o),"&")})),t=t.substring(0,t.length-1),e.get_count&&(t+="&count=true"),t},increase_results_count:function(e){e=$f.utils.is_nil(e)?1:e,this.set("results_count",this.get("results_count")+e)},decrease_results_count:function(e){e=$f.utils.is_nil(e)?1:e,this.set("results_count",this.get("results_count")-e)},next_page:function(){this.set("start",this.get("start")+this.get("limit"))},previous_page:function(){this.set("start",this.get("start")-this.get("limit"))}}),SubmissionsPaginator=Paginator.extend({legacy_classname:"$f.models.SubmissionsPaginator",defaults:$.extend({},Paginator.prototype.defaults,{limit:50,order_by:"smetadata.date_submitted"}),initialize:function(){SubmissionsPaginator.__super__.initialize.apply(this,arguments),delete this.defaults.search_by,delete this.defaults.search_query,delete this.defaults.select_all,delete this.defaults.num_selected,this.unset("search_by").unset("search_query").unset("select_all").unset("num_selected")},reset_pagination:function(){this.unset("num_selected")}}),Company=Backbone.Model.extend({legacy_classname:"$f.models.Company",defaults:{id:null,name:null,features:[],sensor_integration_types:[]},url:function(){return"/api/v1/companies/get/"+(this.id?this.id:"")},parse:function(e,t){return t.collection?e:e.results},has_feature:function(e){return _.contains(this.get("features")||[],e)},has_sensor_integration_type:function(e){return _.contains(this.get("sensor_integration_types")||[],e)}}),User=BaseZenputModel.extend({legacy_classname:"$f.models.User",defaults:{id:null,first_name:null,last_name:null,display_name:"",email:null,sms_number:null,api_token:null,is_admin:null,is_manager:null,is_owner:null,userprofile__sms_number:null,userprofile__locale:null,userprofile__oauth_external_id:null},get_locale:function(){return this.get("userprofile__locale")},get_display_name:function(){return this.get("display_name")?this.get("display_name"):$f.utils.generate_display_name(this.get("first_name"),this.get("last_name"),this.get("email"),this.get("userprofile__sms_number"))},validation:{first_name:{required:!0,minLength:2,maxLength:30},last_name:{required:!0,minLength:2,maxLength:30},userprofile__sms_number:{required:!1,msg:"Please enter a cell phone number"}},url:"/api/v1/users/",sync:function(e,t,i){return"create"==e||"update"==e?(i.type="POST",i.url=t.url+"save/"+(t.id?t.id:"")):i.url=t.url+"get/"+(t.id?t.id:""),Backbone.sync(e,t,i)},parse:function(e,t){return t.collection?e:e.results},is_owner:function(){return!!this.get("is_owner")},is_admin:function(){return!(!this.get("is_admin")&&!this.is_owner())},is_manager:function(){return!(!this.get("is_manager")&&!this.is_owner())},is_submitter:function(){return!(this.is_manager()||this.is_admin()||this.is_owner())},is_oauth_account:function(){return!!this.attributes.userprofile__oauth_external_id}}),Users=BaseZenputCollection.extend({legacy_classname:"$f.collections.Users",model:User,tag_id:null,rdbms_id:null,paginator:null,typeahead_search_attrs:["first_name","last_name"],initialize:function(e){e=e||{},this.paginator=new Paginator({order_by:"-date_joined"}),this.rdbms_id=e.rdbms_id?e.rdbms_id:null},url:function(){var e=this.paginator.default_query_string_attrs;return _.contains(e,"group_id")||e.push("group_id"),_.contains(e,"override_hierarchy_restriction")||e.push("override_hierarchy_restriction"),"/api/v1/users/list_users/?"+this.paginator.get_query_string({get_count:!0})},add_new:function(e,t,i){e.isNew()&&this.paginator.set("results_count",this.paginator.get("results_count")+1),e.save().success(t).error(i),Users.__super__.add.call(this,e)},to_tribute_autocomplete:function(){return this.map((function(e){var t=e.get_display_name();return{id:e.id,user_role:e.get("userprofile__user_role__name"),key:t,value:t}}))}}),UserDevice=Backbone.Model.extend({legacy_classname:"$f.models.UserDevice",defaults:{id:null,name:null},url:"/api/v1/users/devices/",sync:function(e,t,i){return i.type="POST","create"==e||"update"==e?i.url=t.url+"save/":"delete"==e&&(i.url=t.url+"delete/"+t.id),Backbone.sync(e,t,i)}}),UserNotificationSetting=Backbone.Model.extend({legacy_classname:"$f.models.UserNotificationSetting ",defaults:{name:null,order:null,triggers:null,delivery_type:null,options:[],category:null,translation_id:null},idAttribute:"order"}),UserNotificationSettings=Backbone.Collection.extend({legacy_classname:"$f.collections.UserNotificationSettings",push_notifications_enabled:!1,sms_notifications_enabled:!1,model:UserNotificationSetting,comparator:"order",url:"/api/v2/users/settings/notifications/",sync:function(e,t,i){switch(i=i||{},e){case"create":case"update":i.type="PATCH";break;default:i.type="GET"}return Backbone.sync(e,t,i)},parse:function(e){return this.push_notifications_enabled=e.data.push_notifications_enabled,this.sms_notifications_enabled=e.data.sms_notifications_enabled,e.data.results},save:function(e){this.sync("create",this,e)},filter_by_category:function(e){return new UserNotificationSettings(this.where({category:e}))}}),UserDevices=Backbone.Collection.extend({legacy_classname:"$f.collections.UserDevices",model:UserDevice,paginator:null,initialize:function(e){e=e||{},this.paginator=new Paginator({order_by:"name"})},url:function(){return"/api/v1/users/devices/list/?"+this.paginator.get_query_string({get_count:!0})},parse:function(e){return this.paginator.set("results_count",e.count),e.results},comparator:function(e){return e.get(this.paginator.get("order_by"))}}),UserRole=Backbone.Model.extend({legacy_classname:"$f.models.UserRole",defaults:{id:null,name:null},validation:{name:{required:!0,minLength:2}},url:"/api/v1/users/roles/",sync:function(e,t,i){return"update"==e||"create"==e?i.url=t.url+"save/":"delete"==e&&(i.url=t.url+"delete/"+t.id),Backbone.sync(e,t,i)}}),UserRolesPaginator=Paginator.extend({defaults:$.extend({},Paginator.prototype.defaults,{order_by:"name",limit:500}),override_default_query_string_attrs:["start","limit","order_by","search_by","search_query","form_template_id","group_id"],initialize:function(){UserRolesPaginator.__super__.initialize.apply(this,arguments),this.default_query_string_attrs=this.override_default_query_string_attrs}}),UserRoles=BaseZenputCollection.extend({legacy_classname:"$f.collections.UserRoles",model:UserRole,paginator:null,initialize:function(e){e=e||{},$.extend(this,e),this.paginator||(this.paginator=new UserRolesPaginator)},url:function(){return"/api/v1/users/roles/?"+this.paginator.get_query_string({get_count:!0})},parse:function(e){return this.paginator.set("results_count",e.count),e.results},comparator:function(e){return e.get(this.paginator.get("order_by"))}}),Account=Backbone.Model.extend({legacy_classname:"$f.models.Account",defaults:{id:null,is_selected:!1,name:null,country:null,address:null,city:null,state:null,region:null,zipcode:null,email:null,phone:null,external_key:null,owners:null,tags:null,has_sensors:!1,has_gateways:!1},has_gathered_tags:!1,has_sensor_integration_type:function(e){return _.contains(this.get("sensor_integration_types")||[],e)},initialize:function(e){var t=this;Account.__super__.initialize.apply(this,arguments),this._convert_json_to_models(),this.on("change",(function(){t._convert_json_to_models()}))},validation:{name:{msg:"(Required)",required:!0,minLength:2},address:{msg:"(Required)",required:!0},city:{msg:"(Required)",required:!0},state:{msg:"(Required)",required:!0},zipcode:{fn:function(e,t,i){if("US"!==i.country)return!1},msg:"(Invalid)",pattern:/^\d{5}(?:[-\s]\d{4})?$/g,required:!1},country:{msg:"(Required)",pattern:/[A-Z][A-Z]/g,required:!0},email:{fn:function(e,t,i){return!$f.utils.validate_email(e)},msg:"(Invalid)",required:!1}},constructor:function(e,t){!e||!e.tags||e.tags instanceof AccountTags||(e.tags=new AccountTags(e.tags.length>0?e.tags:null)),!e||!e.owners||e.owners instanceof AccountOwnerUsers||(e.owners=new AccountOwnerUsers(e.owners.length>0?e.owners:null)),Account.__super__.constructor.call(this,e,t),null!=this.get("tags")?this.has_gathered_tags=!0:this.set("tags",new AccountTags)},url:"/api/v1/accounts/account/",sync:function(e,t,i){return"read"==e?i.url=t.url+"get/"+this.id:"create"==e?i.url=t.url+"save/":"update"==e?i.url=t.url+"save/"+this.id:"delete"==e&&(i.url=t.url+"remove/"+this.id),Backbone.sync(e,t,i)},parse:function(e,t){return e.tags&&e.tags instanceof Array&&(this.set("tags",new AccountTags(e.tags)),delete e.tags),e.owners&&e.owners instanceof Array&&(this.set("owners",new AccountOwnerUsers(e.owners)),delete e.owners),e},get_latlon_link:function(){return this.get("lat")&&this.get("lon")?$f.mobile.is.android()?"geo:0,0?q=".concat(this.get("lat"),",").concat(this.get("lon"),"(").concat(this.get("name"),")"):$f.mobile.is.ios()?"http://maps.apple.com/?ll=".concat(this.get("lat"),",").concat(this.get("lon"),"&q=").concat(this.get("name")):$f.mobile.is.windows()?"bingmaps:?collection=point.".concat(this.get("lat"),"_").concat(this.get("lon"),"_").concat(this.get("name")):"https://www.google.com/maps?q=".concat(this.get("lat"),",").concat(this.get("lon")):""},_convert_json_to_models:function(){(!this.get("owners")||this.get("owners")instanceof Backbone.Collection)&&this.get("owners")||this.set("owners",new AccountOwnerUsers)}}),Accounts=BaseZenputCollection.extend({legacy_classname:"$f.collections.Accounts",model:Account,paginator:null,tag_id:null,rdbms_id:null,include_user_roles:!1,loc:null,typeahead_search_attrs:["name","address","city"],initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator||(this.paginator=new Paginator({order_by:"name"}));var i=this.paginator.default_query_string_attrs;_.contains(i,"group_id")||i.push("group_id"),_.contains(i,"tag_id")||i.push("tag_id");var n=this;this.listenTo(this,"add",(function(e){var t=n.paginator.get("select_all");t&&e.set("is_selected",t)}))},url:function(){var e=this.tag_id?"&tag_id="+this.tag_id:"";e+=this.rdbms_id?"&rdbms_id="+this.rdbms_id:"",e+=this.loc?"&loc="+this.loc:"",e+=this.include_user_roles?"&include_user_roles=true":"",e+=this.paginator.get("group_id")?"&group_id="+encodeURIComponent(this.paginator.get("group_id")):"",e+=this.paginator.get("fields")?"&fields="+encodeURIComponent(this.paginator.get("fields")):"",e+=this.allow_cross_company_access?"&allow_cross_company_access=true":"","distance"==this.paginator.get("order_by")&&this.paginator.set("count",!1);var t=this.paginator.get("include_group_children");return void 0!==t&&(e+="&include_group_children="+t.toString()),"/api/v1/accounts/list_accounts/?"+this.paginator.get_query_string({get_count:"distance"!=this.paginator.get("order_by")})+e},add_new:function(e,t,i){e.isNew()&&this.paginator.set("results_count",this.paginator.get("results_count")+1),e.save().success(t).error(i),Accounts.__super__.add.call(this,e)}}),AccountTag=BaseZenputModel.extend({legacy_classname:"$f.models.AccountTag",defaults:{id:null,name:null,is_editable:1,is_active:1},url:"/api/v1/accounts/tag/save/"},{default_multi_edit_fields:{tags:null}}),AccountOwnerUser=Backbone.Model.extend({legacy_classname:"$f.models.AccountOwnerUser",defaults:{id:null,first_name:null,last_name:null,user_role:null,user_role_id:null,email:null},sync:function(e,t,i){return i.type="POST","create"!=e&&"update"!=e||(i.url=t.url+"save/"),Backbone.sync(e,t,i)}}),AccountOwnerUsers=Backbone.Collection.extend({legacy_classname:"$f.collections.AccountOwnerUsers",model:AccountOwnerUser,account_id:null,paginator:null,initialize:function(e){this.paginator=new Paginator({start:null,limit:null,order_by:"first_name"})},url:function(){var e=this.account_id?"&account_id="+this.account_id:"";return"/api/v1/accounts/list_owners/?"+this.paginator.get_query_string({get_count:!0})+e},parse:function(e){return this.paginator.set("results_count",e.count),e.results},comparator:function(e){return e.get(this.paginator.get("order_by"))}}),AccountTags=BaseZenputCollection.extend({legacy_classname:"$f.collections.AccountTags",model:AccountTag,account_id:null,initialize:function(e){this.paginator=new Paginator({start:null,limit:null,order_by:"name"})},paginator:null,url:function(){var e=this.account_id?"&account_id="+this.account_id:"";return e+=this.paginator.get("group_id")?"&group_id="+encodeURIComponent(this.paginator.get("group_id")):"","/api/v1/accounts/list_tags/?"+this.paginator.get_query_string({get_count:!0})+e},parse:function(e){return this.paginator.set("results_count",e.count),e.results},comparator:function(e){return e.get(this.paginator.get("order_by"))}}),AccountAndTag=Backbone.Model.extend({legacy_classname:"$f.models.AccountAndTag",defaults:{id:null,raw_id:null,name:null,type:null}}),AccountsAndTags=BaseZenputCollection.extend({legacy_classname:"$f.collections.AccountsAndTags",model:AccountAndTag,paginator:null,typeahead_search_attrs:["name","address"],is_active:null,initialize:function(e){e=e||{},$.extend(this,e),this.paginator=new Paginator},url:function(){var e=this.is_active?"&is_active="+this.is_active:"";return"/api/v1/accounts/list_accounts_tags/?"+this.paginator.get_query_string()+e}}),TaskStatus=Backbone.Model.extend({legacy_classname:"$f.models.TaskStatus",defaults:{type:"open",name:"Incomplete"}}),TaskReply=Backbone.Model.extend({legacy_classname:"$f.models.TaskReply",defaults:{type:null,form_template:null},initialize:function(e,t){this._convert_json_to_models();var i=this;this.on("change",(function(){i._convert_json_to_models()}))},_convert_json_to_models:function(){!this.get("form_template")||this.get("form_template")instanceof Backbone.Model||this.set("form_template",new FormTemplate(this.get("form_template")),{silent:!0})}}),BaseTaskSource=BaseZenputModel.extend({legacy_classname:"$f.models.TaskSource",defaults:{type:null,rule:null,event:null,form_submission:null},submodels:{form_submission:FormStructure}}),TaskFulfillment=Backbone.Model.extend({legacy_classname:"$f.models.TaskFulfillment",parent_task:null,defaults:{type:null,date_created:null,date_completed:null,date_submitted:null,user:null,form_template:null,form_submission:null,fields:null,lat:null,lon:null},initialize:function(e,t){t=t||{},$.extend(this,t);var i=this;$.isArray(this.get("fields"))||this.set("fields",[]),this._convert_json_to_models(),this.on("change",(function(){i._convert_json_to_models()}))},_convert_json_to_models:function(){var e=this;$.each(this.get("fields"),(function(t,i){i instanceof Backbone.Model||(e.get("fields")[t]=new BaseField(i))}))}}),Followers=Backbone.Collection.extend({legacy_classname:"$f.collections.Followers",model:User}),Image=Backbone.Model.extend({legacy_classname:"$f.models.Image",defaults:{url:null,native_url:null,base_64:null},is_image_data_uri:function(){return 0===this.get("url").indexOf("data:image")},get_full_url:function(e){return this.get("url")?$f.storage.is_data_uri(this.get("url"))?$f.mobile.is.windows()?this.get("url").replace("cdvfile://localhost/persistent/","ms-appdata:///local/"):e?this.get("native_url")?this.get("native_url"):null:this.get("url"):$f.storage.get_storage_full_url(this.get("url")):null}}),Images=Backbone.Collection.extend({legacy_classname:"$f.collections.Images",model:function(e,t){t=t||{};var i=new Image({url:e});return i.collection=t.collection,i},toJSON:function(){return this.pluck("url")}}),BaseTaskProject=BaseZenputModel.extend(_.extend({},TaskProjectUtilsMixin,{legacy_classname:"$f.models.BaseTaskProject"})),BaseTask=BaseTaskProject.extend({legacy_classname:"$f.models.Task",task_source_klass:BaseTaskSource,merge_with_project:!1,submodels:{subscribers:Users},defaults:{id:null,title:null,description:null,title_image:null,version:{id:1},company:null,status:null,reply:null,fulfillment:null,project:null,account:null,source:null,reporter:null,assignee:null,followers:null,date_created:null,date_modified:null,date_due:null,date_start_local:null,date_due_local:null,date_due_naive:null,date_start:null,is_active:!0,is_closed:!1,time_zone:null,lat:null,lon:null,is_edit_mode:!1,deleted:!1,has_comments:!1,subscribers:null},_compute_mobile_properties:function(){var e;if($f.utils.is_mobile_app()){var t=$f.mobile.pending_tasks_in_processing.get(this.get("id"));if(t)if(["complete","complete_with_exception"].includes(this.get("current_state")))$f.mobile.pending_tasks_in_processing.remove_records(this.get("id"));else if(this.set("current_state","processing"),this.collection){var i=null===(e=$f.mobile.cache.metadata_for(this.collection.cache_key))||void 0===e?void 0:e.last_cache_refill;i&&t.log_age(60,i,"Showing processing task older than 60 minutes v2")}$f.mobile.is.connected()||this._compute_mobile_offline_properties()}},_compute_mobile_offline_properties:function(){var e=this.get("date_start");"unavailable"===this.get("current_state")&&e&&e.$date<moment().valueOf()&&this.set("current_state","open");var t=this.get("date_due");"open"===this.get("current_state")&&t&&t.$date<moment().valueOf()&&this.set("current_state","overdue")},initialize:function(e,t){this.set("status",new TaskStatus,{silent:!0}),this.get("followers")||this.set("followers",[],{silent:!0}),this.set(e);var i=this;this.get("title_image")||this.set("title_image",[],{silent:!0}),this._convert_json_to_models(),this.on("change",(function(){i._convert_json_to_models()})),this._compute_mobile_properties(),this.get("project")&&this.get("project").id?this.merge_with_project=!0:this.set("project",null)},validation:{title:{fn:"_validate_title"},project:{fn:"_validate_project_title"},reply:{fn:"_validate_reply"}},_validate_reply:function(e,t,i){var n=e.get("form_template")?e.get("form_template"):null;return"form_submission"!=e.get("type")||n?"form_submission"!=e.get("type")&&n?"Form is not allowed unless Task Type is Submit Form":void 0:"Form is required when Task Type is Submit Form"},_validate_title:function(e,t,i){if(!e||!e.trim()||e.length<2)return"Please enter a title."},_validate_project_title:function(e,t,i){if(null!=e&&null!=e.get("title")&&null==e.get("id"))return"You must select an existing project"},url:"/api/v1/tasks/task",sync:function(e,t,i){switch(e){case"read":i.url="".concat(t.url,"/get/").concat(t.id);break;case"create":case"update":i.url="".concat(t.url,"/save/");break;case"delete":i.url="".concat(t.url,"/archive/").concat(t.id)}return Backbone.sync(e,t,i)},parse:function(e,t){return e.results},_convert_json_to_models:function(){!this.get("status")||this.get("status")instanceof Backbone.Model||this.set("status",new TaskStatus(this.get("status")),{silent:!0}),!this.get("company")||this.get("company")instanceof Backbone.Model||this.set("company",new Company(this.get("company")),{silent:!0}),!this.get("reply")||this.get("reply")instanceof Backbone.Model||this.set("reply",new TaskReply(this.get("reply")),{silent:!0}),!this.get("source")||this.get("source")instanceof Backbone.Model||this.set("source",new this.task_source_klass(this.get("source")),{silent:!0}),!this.get("reporter")||this.get("reporter")instanceof Backbone.Model||this.set("reporter",new User(this.get("reporter")),{silent:!0}),!this.get("project")||this.get("project")instanceof Backbone.Model||this.set("project",new Project(this.get("project")),{silent:!0}),!this.get("assignee")||this.get("assignee")instanceof Backbone.Model||this.set("assignee",new User(this.get("assignee")),{silent:!0}),!this.get("account")||this.get("account")instanceof Backbone.Model||this.set("account",new Account(this.get("account")),{silent:!0}),!this.get("fulfillment")||this.get("fulfillment")instanceof Backbone.Model||this.set("fulfillment",new TaskFulfillment(this.get("fulfillment"),{parent_task:this}),{silent:!0}),!this.get("followers")||this.get("followers")instanceof Backbone.Collection||this.set("followers",new Followers(this.get("followers")),{silent:!0}),null!=this.get("title_image")&&""!=this.get("title_image")||this.set("title_image",[],{silent:!0}),!this.get("title_image")||this.get("title_image")instanceof Backbone.Collection||this.set("title_image",new Images(this.get("title_image")),{silent:!0})},is_fulfilled:function(){return"closed"==this.get("status").get("type")},company_has_task_edit_unrestrict_feature:function(){return $f.mobile?$f.active_company.has_feature("task_edit_unrestrict"):$f.user.company.has_feature("task_edit_unrestrict")},user_can_edit:function(e){var t=this.get("reporter"),i=this.get("assignee");if(e.is_admin()||this.company_has_task_edit_unrestrict_feature()&&e.is_manager())return!0;if(e.is_manager()){var n=this.get("source");return!(Boolean(n&&n.get("event")&&n.get("event").id)&&e.id===i.id||i.is_admin()||t.is_admin()&&i.is_manager())}var s=t.id===e.id,o=this.get("source"),a=o?o.get("type"):"";return(!s||"rule_event"!==a)&&s},get_formatted_relative_date_and_time:function(){var e=this._get_zoned_time("date_due");if(null===e)return null;var t=$f.utils.get_date_str_with_color(e),i=this.get_time_start_and_due_str();return i&&(t.label+=", "+i),t},delete:function(e){(e=e||{}).success=e.success||function(){},e.error=e.error||function(){},$f.utils.select_ajax()({url:"".concat(this.url,"/destroy/").concat(this.id),dataType:"json",type:"POST",cache:!1,success:function(t){e.success()},error:function(t){e.error()}})},get_filter_status:function(){var e=this.get("is_active"),t=this.get("is_closed");return!0===e&&!1===t?"active_incomplete":!1===e&&!1===t?"archived_incomplete":!0===t?"complete":"all_tasks"}},{default_multi_edit_fields:{date_due:null,project_id:null,assignee_user_id:null}}),MultiEditUpdateData=Backbone.Model.extend({legacy_classname:"$f.models.MultiEditUpdateData"}),BaseMultiEdit=Backbone.Model.extend({legacy_classname:"$f.models.BaseMultiEdit",defaults:{url:null,update_data:null,collection:null,id:null},get_query_string:function(e){var t,i;if(this.get("id"))t="include="+JSON.stringify([this.get("id")]),i="";else{var n=this.get("collection"),s=new Backbone.Collection(n.where({is_selected:!n.paginator.get("select_all")})).pluck("id");t=n.paginator.get("select_all")?"&exclude="+JSON.stringify(s):"&include="+JSON.stringify(s),i=n.paginator.get_query_string({get_count:!1})}var o=JSON.stringify(this.get("update_data"));return"".concat(e,"?").concat(i).concat(t,"&update_data=").concat(o)},sync:function(e,t,i){switch(e){case"create":case"update":i.url=t.get_query_string(this.get("url"))}return Backbone.sync(e,t,i)}}),BaseBatchTask=BaseTask.extend({legacy_classname:"$f.models.BatchTask",defaults:{id:null,title:null,description:null,title_image:null,version:{id:1},reply:null,project:null,user_role:null,distribute_group:null,account_tag:null,date_due:null,date_start:null,estimate_task_count:0,estimate_user_count:0,time_frame:null,date_due_type:null,days_after:null},initialize:function(e){this.set({project:new Project,user_role:new UserRole,distribute_group:new DistributeGroup,account_tag:new AccountTag},{silent:!0}),BaseBatchTask.__super__.initialize.apply(this,arguments)},_convert_json_to_models:function(){!this.get("project")||this.get("project")instanceof Backbone.Model||this.set("project",new Project(this.get("project")),{silent:!0}),!this.get("user_role")||this.get("user_role")instanceof Backbone.Model?null===this.get("user_role")&&this.set("user_role",new UserRole,{silent:!0}):this.set("user_role",new UserRole(this.get("user_role")),{silent:!0}),!this.get("distribute_group")||this.get("distribute_group")instanceof Backbone.Model?null===this.get("distribute_group")&&this.set("distribute_group",new DistributeGroup,{silent:!0}):this.set("distribute_group",new DistributeGroup(this.get("distribute_group")),{silent:!0}),!this.get("account_tag")||this.get("account_tag")instanceof Backbone.Model||this.set("account_tag",new AccountTag(this.get("account_tag")),{silent:!0}),BaseBatchTask.__super__._convert_json_to_models.apply(this,arguments)},sync:function(e,t,i){switch(e){case"read":i.url="".concat(t.url,"/estimate_batch_generate/?").concat(t.get_estimate_query_string());break;case"create":i.url="".concat(t.url,"/generate/")}return Backbone.sync(e,t,i)},validation:$.extend({user_role:{fn:"_validate_user_role"}},BaseTask.prototype.validation),_validate_user_role:function(e,t,i){if(!e.get("id"))return"Please select a user role."},_validate_reply:function(e,t,i){if("form_submission"!=this.get("reply").get("type"))return!1;var n,s;try{n=this.get("reply").get("form_template").get("id"),s=this.get("reply").get("form_template").get("title")}catch(e){}return n&&s?void 0:"Please select a form template"},parse:function(e){return e.results},get_estimate_query_string:function(e){var t="",i=this;return $.each(["user_role","account_tag","distribute_group"],(function(e,n){if(!i.get(n).get("id"))return!0;t+="".concat(n,"_id=").concat(encodeURIComponent(i.get(n).get("id")),"&")})),t=t.substring(0,t.length-1)}}),Tasks=BaseZenputCollection.extend({legacy_classname:"$f.collections.Tasks",model:BaseTask,paginator:null,typeahead_search_attrs:["title"],default_paginator_options:{order_by:"date_due_local",search_by:"tasks",include_future_tasks:!0,view_type:"full"},allow_group_id_on_me_filter:!1,initialize:function(e,t){var i=this;t=t||{},$.extend(this,_.omit(t,"search_options")),this.paginator||(t&&t.search_options&&_.extend(i.default_paginator_options,t.search_options),t&&t.paginator_options&&_.extend(i.default_paginator_options,t.paginator_options),this.paginator=new Paginator(i.default_paginator_options),t.search_options&&t.search_options.update_paginator&&t.search_options.update_paginator(this.paginator)),i._repair_group_id(),this.listenTo(this.paginator,"change",(function(){i._repair_group_id()}))},url:function(){var e=this.paginator.default_query_string_attrs;return _.contains(e,"status")||e.push("status"),_.contains(e,"loc")||e.push("loc"),_.contains(e,"filter")||e.push("filter"),_.contains(e,"assignee_user_id")||e.push("assignee_user_id"),_.contains(e,"group_id")||e.push("group_id"),_.contains(e,"account_id")||e.push("account_id"),_.contains(e,"project_ids")||e.push("project_ids"),_.contains(e,"search_query")||e.push("search_query"),_.contains(e,"start_date")||e.push("start_date"),_.contains(e,"end_date")||e.push("end_date"),_.contains(e,"submitted_date_start")||e.push("submitted_date_start"),_.contains(e,"submitted_date_end")||e.push("submitted_date_end"),_.contains(e,"include_future_tasks")||e.push("include_future_tasks"),_.contains(e,"include_future_tasks_v2")||e.push("include_future_tasks_v2"),_.contains(e,"include_date_due_null")||e.push("include_date_due_null"),_.contains(e,"view_type")||e.push("view_type"),_.contains(e,"include_has_exceptions")||e.push("include_has_exceptions"),_.contains(e,"group_by_overdue")||e.push("group_by_overdue"),_.contains(e,"parent_project_id")||e.push("parent_project_id"),_.contains(e,"bucket")||e.push("bucket"),_.contains(e,"tz")||e.push("tz"),"/api/v1/tasks/list_tasks/?"+this.paginator.get_query_string({get_count:!0})},add_new:function(e){this.paginator.increase_results_count(),this.add(e)},_repair_group_id:function(){this.allow_group_id_on_me_filter||"me"===this.paginator.get("filter")&&this.paginator.set("group_id",null,{silent:!0})}}),SearchOption=Backbone.Model.extend({legacy_classname:"$f.models.SearchOption",defaults:{field:null,value:null,display_value:null,select_options:null,offline_only:!1},initialize:function(){this.get("select_options")||this.set("select_options",[])}}),global_recurring_utils={legacy_classname:"$f.utils.recurring",weekdays:new Backbone.Collection([{code:"MO",name:"Monday",abbreviation:"M",rrule_weekday_obj:RRule.MO,weekday_js:1},{code:"TU",name:"Tuesday",abbreviation:"T",rrule_weekday_obj:RRule.TU,weekday_js:2},{code:"WE",name:"Wednesday",abbreviation:"W",rrule_weekday_obj:RRule.WE,weekday_js:3},{code:"TH",name:"Thursday",abbreviation:"T",rrule_weekday_obj:RRule.TH,weekday_js:4},{code:"FR",name:"Friday",abbreviation:"F",rrule_weekday_obj:RRule.FR,weekday_js:5},{code:"SA",name:"Saturday",abbreviation:"S",rrule_weekday_obj:RRule.SA,weekday_js:6},{code:"SU",name:"Sunday",abbreviation:"S",rrule_weekday_obj:RRule.SU,weekday_js:0}]),frequencies:new(Backbone.Collection.extend({NEVER:7,YEARLY:RRule.YEARLY,MONTHLY:RRule.MONTHLY,WEEKLY:RRule.WEEKLY,DAILY:RRule.DAILY}))([{id:7,name:"Never"},{id:RRule.YEARLY,name:"Yearly",unit:"year",plural_unit:"years"},{id:RRule.MONTHLY,name:"Monthly",unit:"month",plural_unit:"months"},{id:RRule.WEEKLY,name:"Weekly",unit:"week",plural_unit:"weeks"},{id:RRule.DAILY,name:"Daily",unit:"day",plural_unit:"days"}])},RruleCustomAttrs=BaseZenputModel.extend({legacy_classname:"$f.models.RruleCustomAttrs",defaults:{date_start:null,date_start_naive:null,dtstart_naive:null,set_min_start:!0,dtstart_local:null,time_zone:null}}),Rrule=BaseZenputModel.extend({legacy_classname:"$f.models.Rrule",defaults:{frequency:null,dtstart:null,until:null,count:null,interval:1,wkst:null,byweekday:null,bymonth:null,bysetpos:null,bymonthday:null,byyearday:null,byweekno:null,byhour:null,byminute:null,bysecond:null,custom_attrs:null},submodels:{custom_attrs:RruleCustomAttrs},initialize:function(e,t){t=t||{},$.extend(this,t);var i=this;this.get("custom_attrs")||this.set("custom_attrs",{});var n=new Date,s=$f.utils.get_start_of_day(n).getTime();this.get("custom_attrs").get("dtstart_local")&&(s=Date.parse(this.get("custom_attrs").get("dtstart_local")),this.set("dtstart",null)),this.get("dtstart")||this.set("dtstart",{$date:s}),this.get("custom_attrs").get("date_start")&&this.get("custom_attrs").get("date_start").$date||(this.get("custom_attrs").get("set_min_start")&&this.get("frequency")===$f.utils.recurring.frequencies.DAILY&&(n=moment(n).add(1,"days").toDate()),this.get("custom_attrs").set("date_start",{$date:$f.utils.get_start_of_day(n).getTime()})),this._initialize_defaults_for_frequency(),this.on("change",(function(){$.each(Object.keys(i.attributes),(function(e,t){if(void 0!==i.get(t))return!0;i.set(t,null,{silent:!0})})),i.get("frequency")==$f.utils.recurring.frequencies.WEEKLY&&i._reset_dtstart_for_weekday()})),this.on("change:byweekday",(function(){this.validate&&this.validate()})),this.on("change:frequency",(function(){i._initialize_defaults_for_frequency()})),this.on("change:dtstart",(function(){i.get("frequency")==$f.utils.recurring.frequencies.YEARLY&&i.set_yearly_recurring_day(this.get("dtstart").$date)}))},set_yearly_recurring_day:function(e){_.isNumber(e)&&(e=new Date(e)),this.set({bymonthday:e.getDate(),bymonth:e.getMonth()+1})},set_monthly_recurring_by_type:function(e){if(!_.contains(["dom","dow"],e))throw new Error("Programmer Error: unknown type of monthly recurring");var t=new Date;this.get("dtstart")&&this.get("dtstart").$date&&(t=new Date(this.get("dtstart").$date)),"dom"!=e?this.set({byweekday:{weekday:$f.utils.recurring.weekdays.findWhere({weekday_js:t.getDay()}).get("weekday_js"),n:$f.utils.get_num_week_of_month(t)},bymonthday:null}):this.set({byweekday:null,bymonthday:t.getDate()})},set_until_date:function(e){e?this.set({until:{$date:moment(e).endOf("day").toDate().getTime()},count:null}):this.set("until",null)},set_until_count:function(e){this.set({until:null,count:e})},get_rrule_instance:function(){var e=this.toJSON();return e.freq=e.frequency,delete e.frequency,delete e.custom_attrs,e.dtstart&&e.dtstart.$date&&(e.dtstart=moment(e.dtstart.$date)._d),e.until&&e.until.$date&&(e.until=moment(e.until.$date)._d),e.byweekday&&(delete e.bymonthday,_.isArray(e.byweekday)?e.byweekday=this._byweekday_array_to_rrule_weekday(e.byweekday):e.byweekday=this._byweekday_object_to_rrule_weekday(e.byweekday)),new RRule(e)},_initialize_defaults_for_frequency:function(){if(this.get("frequency")!=$f.utils.recurring.frequencies.WEEKLY||this.get("byweekday")&&this.get("byweekday").length)this.get("frequency")==$f.utils.recurring.frequencies.MONTHLY?this.set({bymonthday:new Date(this.get("dtstart").$date).getDate(),bymonth:null}):this.get("frequency")==$f.utils.recurring.frequencies.YEARLY?this.set_yearly_recurring_day(this.get("dtstart").$date):this.set({bymonthday:null,bymonth:null});else{var e=$f.utils.recurring.weekdays.findWhere({weekday_js:(new Date).getDay()}).get("rrule_weekday_obj").weekday;this.set("byweekday",null!==e?[e]:null)}},_byweekday_array_to_rrule_weekday:function(e){var t=this.get("frequency");if(!e||t!=$f.utils.recurring.frequencies.WEEKLY)return e;var i=$f.utils.recurring.weekdays.filter((function(t){return _.contains(e,t.get("rrule_weekday_obj").weekday)}));return(i=new Backbone.Collection(i).pluck("rrule_weekday_obj")).length>0?i:null},_byweekday_object_to_rrule_weekday:function(e){if(!e)return e;if(_.isArray(e))return e;if(e.nth)return e;var t=$f.utils.recurring.weekdays.findWhere({weekday_js:e.weekday});return RRule[t.get("code")].nth(e.n)},get_earliest_date:function(e,t){var i=[];for(var n in e){var s=6!==e[n]?e[n]+1:0,o=moment(t).days(s);o._d<t&&o.add(7,"days"),i.push(o._d)}return i.sort((function(e,t){return e-t})),i[0]},_reset_dtstart_for_weekday:function(){if(this.get("custom_attrs").get("date_start")){var e=this.get("byweekday");if(e&&e.length){var t=new Date(this.get("custom_attrs").get("date_start").$date),i=this.get_earliest_date(e,t);this.set("dtstart",{$date:i})}}},validation:{byweekday:function(){if(this.get("frequency")===$f.utils.recurring.frequencies.WEEKLY)return this.get("byweekday")&&0!=this.get("byweekday").length?void 0:"Please select a day of the week."}}}),Recurring=BaseZenputModel.extend({legacy_classname:"$f.models.Recurring",defaults:{id:null,queue_create_data:null,rrule:null,is_active:!0},submodels:{rrule:Rrule},initialize:function(e,t){t=t||{},$.extend(this,t),this.get("rrule")||this.set("rrule",new Rrule,{silent:!0})},validate:function(){if(this.get("rrule").validate)return this.get("rrule").validate.apply(this.get("rrule"),arguments)}}),RecurringProject=BaseZenputModel.extend({legacy_classname:"$f.models.RecurringProject",_NAIVE_FORMAT:"YYYY-MM-DDTHH:mm:ss",defaults:{id:null,title:null,description:null,company:null,tasks:null,date_due:null,date_due_naive:null,date_start:null,date_start_naive:null,date_created:null,date_modified:null,num_tasks_closed:null,num_tasks:null,is_active:!0,user_role:null,create_tasks_data:null,recurring:null,followers:null,is_auto_archive:!1,is_started:!0,allow_any_user_fulfill:!1},submodels:{tasks:Tasks,company:Company,create_tasks_data:BaseBatchTask,recurring:Recurring,followers:Followers},url:"/api/v1/projects/project",sync:function(e,t,i){switch(e){case"read":i.url="".concat(t.url,"/get/").concat(t.id);break;case"delete":i.url="".concat(t.url,"/delete/").concat(t.id);break;case"create":case"update":i.url="".concat(t.url,"/save/")}return Backbone.sync(e,t,i)},parse:function(e){if(!e.results)return e;if(!e.results.recurring)return e.results;var t=e.results.recurring.rrule,i=t.custom_attrs;return i&&i.dtstart_naive&&(t.dtstart={$date:moment(i.dtstart_naive,this._NAIVE_FORMAT).toDate().getTime()}),i&&i.date_start_naive&&(i.date_start={$date:moment(i.date_start_naive,this._NAIVE_FORMAT).toDate().getTime()}),e.results},initialize:function(e){this.set("create_tasks_data",this.get("create_tasks_data")||new BaseBatchTask,{silent:!0}),this.get("followers")||this.set("followers",new Followers({id:$f.user.id,display_name:$f.user.display_name}),{silent:!0})},set_recurring_frequency:function(e){this.update_project_followers(e),e!=$f.utils.recurring.frequencies.NEVER?(this.set({date_due:null,recurring:new Recurring({rrule:{frequency:e}})}),e==$f.utils.recurring.frequencies.DAILY?(this.get("recurring").get("rrule").set("dtstart",_.clone(this.get("recurring").get("rrule").get("custom_attrs").get("date_start"))),this.get("create_tasks_data").set("time_frame",{start:"00:00",end:"23:59"})):this.get("create_tasks_data").set("time_frame",null)):this.set({recurring:null,date_start:null})},update_project_followers:function(e){e===$f.utils.recurring.frequencies.DAILY?1===this.get("followers").length&&this.get("followers").at(0).id===$f.user.id&&this.get("followers").reset():0===this.get("followers").length&&this.get("followers").add(new User({id:$f.user.id,display_name:$f.user.display_name}))},validation:{title:function(){if("form_submission"===this.get("create_tasks_data").get("reply").get("type")){var e=this.get("create_tasks_data").get("title");e&&this.set("title",e)}else if(!this.get("title"))return _t("mobile_projects_title_required")},user_role:function(){if(!this.get("create_tasks_data").get("user_role").get("id"))return _t("mobile_projects_user_role_required")},date_due_naive:function(e,t,i){if(this.get("is_auto_archive")&&!this.get("recurring")&&!this.get("date_due_naive"))return _t("mobile_projects_due_date_required")},recurring:function(){if(this.get("recurring")){var e=this.get("recurring").validate();if(e)return e[Object.keys(e)[0]]}},distribute_group:function(){if(this.isNew()&&!this.get("create_tasks_data").get("distribute_group").get("id"))return _t("mobile_projects_team_required")}},set_time_frame:function(e,t){this.get("create_tasks_data").set("time_frame",{start:e,end:t})},set_days_after:function(e){this.get("create_tasks_data").set("days_after",e)},get_text_summary:function(){var e=this.get("recurring").get("rrule").get_rrule_instance(),t="Starting on ".concat(this.get_recurring_start_date().format("MMMM D, YYYY"),", repeats ").concat(e.toText()),i=this.get("create_tasks_data").get("due_type");if(i&&"between"===i){var n=this.get("create_tasks_data").get("time_frame");return t+", due between ".concat($f.utils.get_formatted_time_from_24_hour_time(n.start)," and ").concat($f.utils.get_formatted_time_from_24_hour_time(n.end)," local time")}if(i&&"after"===i&&this.get("create_tasks_data").get("days_after"))return t+", due ".concat(this.get("create_tasks_data").get("days_after")," days later");if(i&&"end_of_period"===i){var s=this.get("recurring").get("rrule").get("byweekday");return s&&s.length>1?t+", due by the end of ".concat("day"):t+", due by the end of ".concat($f.utils.recurring.frequencies.get(this.get("recurring").get("rrule").get("frequency")).get("unit"))}return t},get_recurring_start_date:function(){var e,t=this.get("recurring").get("rrule").get_rrule_instance(),i=this.get("recurring").get("rrule").get("custom_attrs");return e=i.get("dtstart_local")?i.get("dtstart_local"):i.get("date_start")&&i.get("date_start").$date?i.get("date_start").$date:t.after(new Date(0)),moment.isMoment(e)?e:moment(e)},get_recurring_frequency_string:function(){var e=null;if(this.get("parent_project"))try{e=this.get("parent_project").get("recurring").get("rrule").get("frequency")}catch(e){}else try{e=this.get("recurring").get("rrule").get("frequency")}catch(e){}return null!==e?["Yearly","Monthly","Weekly","Daily","Hourly","Minutely","Secondly"][e]:null},save:function(e,t){var i=this;if(!this.get("recurring"))return RecurringProject.__super__.save.apply(this,arguments);var n=this.get("recurring").get("rrule"),s=n.get("custom_attrs");s.set({dtstart_naive:null,date_start_naive:null}),n.get("dtstart")&&(s.set("dtstart_naive",moment(n.get("dtstart").$date).format(this._NAIVE_FORMAT)),n.set("dtstart",null,{silent:!0})),s.get("date_start")&&(s.set("date_start_naive",moment(s.get("date_start").$date).format(this._NAIVE_FORMAT)),s.set("date_start",null,{silent:!0})),(t=t||{}).error||(t.error=function(){});var o=t.error;return t.error=function(){return s.get("dtstart_naive")&&n.set("dtstart",{$date:moment(s.get("dtstart_naive"),i._NAIVE_FORMAT).toDate().getTime()}),s.get("date_start_naive")&&s.set("date_start",{$date:moment(s.get("date_start_naive"),i._NAIVE_FORMAT).toDate().getTime()}),o.apply(this,arguments)},RecurringProject.__super__.save.call(this,e,t)},is_v2_project:function(){return Project._is_v2_project(this)}}),Project=BaseTaskProject.extend({legacy_classname:"$f.models.Project",defaults:{id:null,title:null,description:null,company:null,tasks:null,date_due:null,date_due_naive:null,date_start:null,date_start_naive:null,date_created:null,date_modified:null,create_tasks_data:null,create_tasks_account_tags:null,num_tasks_closed:null,num_tasks:null,is_active:!0,is_auto_archive:!1,is_shared:!1,recurring:null,followers:null,allow_any_user_fulfill:!1},submodels:{tasks:Tasks,company:Company,recurring:Recurring,followers:Followers,parent_project:RecurringProject,create_tasks_data:BaseBatchTask},url:"/api/v1/projects/project",sync:function(e,t,i){i=i||{};try{var n=this.get("create_tasks_data").get("reply").get("type")}catch(e){n=null}switch("form_submission"!==n&&this.set("allow_any_user_fulfill",!1),e){case"read":i.url="".concat(t.url,"/get/").concat(t.id);break;case"delete":i.url="".concat(t.url,"/archive/").concat(t.id);break;case"update":case"create":i.url="".concat(t.url,"/save/")}return Backbone.sync(e,t,i)},unarchive:function(e){(e=e||{}).success=e.success||function(){},e.error=e.error||function(){},$f.utils.select_ajax()({url:"".concat(this.url,"/unarchive/").concat(this.id),dataType:"json",type:"POST",cache:!1,success:function(t){e.success()},error:function(t){e.error()}})},delete:function(e){(e=e||{}).success=e.success||function(){},e.error=e.error||function(){},$f.utils.select_ajax()({url:"".concat(this.url,"/destroy/").concat(this.id),dataType:"json",type:"POST",cache:!1,success:function(t){e.success()},error:function(t){e.error(t)}})},destroy_remotely:function(){return this.set("is_active",!1),this.sync("delete",this)},parse:function(e){return e.results?e.results:e},get_date_due_naive_as_local_date:function(){var e=this.get("date_due_naive");return e?moment(e).toDate():null},get_date_start_as_local_date:function(){try{var e=this.get("date_start_naive")||this.get("date_start").$date}catch(e){return null}return moment(e).toDate()},get_relative_date_due_considering_timezone:function(){if(!this.get("date_due"))return null;var e=$f.utils.get_relative_date_from_today(this.get_date_due_naive_as_local_date());return"red"!=e.color||moment().isBefore(moment(this.get("date_due").$date))&&(e.color=""),e},get_recurring_frequency_string:function(){var e=null;if(this.get("parent_project"))try{e=this.get("parent_project").get("recurring").get("rrule").get("frequency")}catch(e){}else try{e=this.get("recurring").get("rrule").get("frequency")}catch(e){}return null!==e?["Yearly","Monthly","Weekly","Daily","Hourly","Minutely","Secondly"][e]:null},get_account_tags:function(){try{var e=this.get("create_tasks_account_tags");if(e){if(1===e.length)return e[0].name;if(e.length>1)return e.length+" tags"}return this.get("create_tasks_data").get("account_tag").get("name")}catch(e){return null}},get_account_tags_names:function(){return _.pluck(this.get("create_tasks_account_tags"),"name")},get_task_account_names:function(){return _.pluck(this.get("create_tasks_accounts"),"name")},is_v2_project:function(){return Project._is_v2_project(this)}},{get_v2_edit_path:function(e){var t=encodeURIComponent(window.location.hash);return"/projects/edit/".concat(e,"?successurl=").concat(window.location.pathname+t)},_is_v2_project:function(e){return!(!e.get("create_tasks_data")||!e.get("create_tasks_data").get("version").id)&&2===e.get("create_tasks_data").get("version").id}}),Projects=BaseZenputCollection.extend({legacy_classname:"$f.collections.Projects",model:Project,paginator:null,typeahead_search_attrs:["title"],url:function(){var e=this.paginator.default_query_string_attrs;return _.contains(e,"loc")||e.push("loc"),_.contains(e,"filter")||e.push("filter"),_.contains(e,"type")||e.push("type"),_.contains(e,"is_active")||e.push("is_active"),_.contains(e,"group_id")||e.push("group_id"),"me"==this.paginator.get("filter")&&this.paginator.set("group_id",null),"/api/v1/projects/list_projects/?"+this.paginator.get_query_string({get_count:!0})},initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator||(this.paginator=new Paginator({order_by:"date_due"}))},comparator:function(e){return e.get(this.paginator.get("order_by"))}}),BaseRecurringProjects=BaseZenputCollection.extend({legacy_classname:"$f.collections.RecurringProjects",model:Project,paginator:null,typeahead_search_attrs:["title"],url:function(){var e=this.paginator.default_query_string_attrs;return _.contains(e,"parent_project_id")||e.push("parent_project_id"),_.contains(e,"group_id")||e.push("group_id"),"/api/v1/projects/recurring/list_projects/?"+this.paginator.get_query_string({get_count:!0})},initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator||(this.paginator=new Paginator({order_by:"-date_due"}))},comparator:function(e){return e.get(this.paginator.get("order_by"))}}),BaseRecurringParentProjects=BaseRecurringProjects.extend({legacy_classname:"$f.collections.RecurringParentProjects",allow_one_off_projects:null,include_archived:null,url:function(){var e=__spreadArray(__spreadArray([this.paginator.get_query_string({get_count:!0})],this.allow_one_off_projects?["allow_one_off_projects=true"]:[],!0),this.include_archived?["include_archived=true"]:[],!0).join("&");return"/api/v1/projects/recurring/list_parent_projects/?".concat(e)}}),IngredientTemperatureCategory=BaseZenputModel.extend({defaults:{id:null,name:null},initialize:function(e){e=e||{},$.extend(this,e),IngredientTemperatureCategory.__super__.initialize.apply(this,arguments)},fetch_ingredients_count:function(e){return this.fetch(e)}}),IngredientTemperatureCategories=BaseZenputCollection.extend({legacy_classname:"$f.collections.IngredientTemperatureCategories",limit:500,model:IngredientTemperatureCategory,initialize:function(e){e=e||{},$.extend(this,e)},url:function(){return"/api/v3/activities/ingredients/categories/?limit=".concat(this.limit)}}),Ingredient=BaseZenputModel.extend({legacy_classname:"$f.models.Ingredient",defaults:{id:null,name:null,category:null,company:null,date_modified:null,has_expiration:null,translations:[]},url:function(){return"/api/v3/activities/ingredients/".concat(this.id,"/?")}}),Ingredients=BaseZenputCollection.extend({legacy_classname:"$f.collections.Ingredients",search_param:"search",model:Ingredient,paginator:null,default_paginator_options:{start:null,limit:null,order_by:"name",is_disabled:!1,search:"",include_non_expiring:!0},initialize:function(e,t){var i=this;t=t||{},$.extend(this,_.omit(t,"search_options")),this.paginator||(t&&t.search_options&&_.extend(i.default_paginator_options,t.search_options),this.paginator=new Paginator(this.default_paginator_options),t.search_options&&t.search_options.update_paginator&&t.search_options.update_paginator(this.paginator)),Ingredients.__super__.initialize.apply(this,arguments)},url:function(){return"/api/v3/activities/ingredients/?"+this.paginator.get_query_string({attrs:["start","limit","order_by","search"],get_count:!0})}}),EquipmentCategory=BaseZenputModel.extend({legacy_classname:"$f.models.EquipmentCategories",defaults:{id:null},url:function(){return"/api/v2/equipment/categories/".concat(this.id,"/")}}),EquipmentCategories=BaseZenputCollection.extend({legacy_classname:"$f.collections.EquipmentCategories",limit:500,defaults:{id:null},url:function(){return"/api/v2/equipment/categories/?limit=".concat(this.limit)}});$.extend({get_url_vars:function(){var e,t=[],i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=window.location.href.match(/#(.*)/);n&&n.length>0&&(i=i.concat(n[1].split("&")));for(var s=0;s<i.length;s++)e=i[s].split("="),t.push(e[0]),t[e[0]]=e[1]?e[1].replace("#",""):"";return t},get_url_var:function(e){return $.get_url_vars()[e]}}),$.cookie=function(e,t,i){if(arguments.length>1&&(null===t||"object"!=typeof t)){if(i=$.extend({},i),null===t&&(i.expires=-1),"number"==typeof i.expires){var n=i.expires,s=i.expires=new Date;s.setDate(s.getDate()+n)}return document.cookie=[encodeURIComponent(e),"=",i.raw?String(t):encodeURIComponent(String(t)),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"/",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}var o=(i=t||{}).raw?function(e){return e}:decodeURIComponent,a=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie);return a?o(a[1]):null},__webpack_exports__.ZP=$f},"./src/backbone-unorganized/shared/sensors/models.js":function(e,t,i){i.d(t,{DQ:function(){return o},iv:function(){return a},e1:function(){return r},BI:function(){return l},lt:function(){return c},vI:function(){return u},l9:function(){return d},LM:function(){return f},pf:function(){return h}});var n=i("./src/backbone-unorganized/shared/forms.js"),s=i("./src/backbone-unorganized/shared/sensors/util.js"),o=n.Dn.extend({legacy_classname:"$f.shared.sensors.models.SensorSparkline",defaults:{timestamps:[],values:[],id:null,lookback_period:s.Z.LOOKBACK_PERIODS.HALF_DAY,name:null},set_lookback_period:function(e){switch(e){case s.Z.LOOKBACK_PERIODS.HALF_DAY:case s.Z.LOOKBACK_PERIODS.DAY:case s.Z.LOOKBACK_PERIODS.WEEK:case s.Z.LOOKBACK_PERIODS.MONTH:case s.Z.LOOKBACK_PERIODS.YEAR:this.set("lookback_period",e);break;default:throw new Error("Programmer error: Unknown lookback period")}},url:function(){return"/api/v2/sensors/sparkline/".concat(this.get("id"),"/?lookback_period=").concat(this.get("lookback_period"))}}),a=n.Dn.extend({legacy_classname:"$f.shared.sensors.models.SensorRelatedAccount",defaults:{id:null,name:null,time_zone:null}}),r=n.Dn.extend({legacy_classname:"$f.shared.sensors.models.SensorIntegration",defaults:{id:null,integration_type:null,integration_type_name:null}}),l=n.Dn.extend({legacy_classname:"$f.shared.sensors.models.Placement",defaults:{id:null,name:null,sensor_placement_nicknames:null},url:function(){return"/api/v2/sensors/placements/".concat(this.get("id"),"/")}}),_=n.Ds.extend({legacy_classname:"$f.shared.sensors.models.SensorPlacementsPaginator",defaults:$.extend({},n.Ds.prototype.defaults,{order_by:"-name",limit:50})}),c=n.DR.extend({legacy_classname:"$f.shared.sensors.collections.SensorsPlacements",model:l,typeahead_search_attrs:["name"],initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator||(this.paginator=new _)},url:function(){var e=this.models.find((function(e){return e.get("fetchIds")}));return e&&e.get("fetchIds").length?"/api/v2/sensors/placements/?id=".concat(encodeURIComponent(e.get("fetchIds"))):"/api/v2/sensors/placements/?".concat(this.paginator.get_query_string())}}),u=n.Dn.extend({legacy_classname:"$f.shared.sensors.models.Status",defaults:{id:null,name:null}}),d=n.DR.extend({legacy_classname:"$f.shared.sensors.collections.SensorsStatus",paginator:null,model:u,typeahead_search_attrs:["name"],initialize:function(e,t){t=t||{},$.extend(this,t)},sync:function(){return null},fetch:function(){return null},save:function(){return null}}),f=n.Dn.extend({legacy_classname:"$f.shared.sensors.models.Sensor",defaults:{id:null,name:null,date_created:null,date_modified:null,account:null,integration:null,last_reading_value:null,placement:null,sensor_id:null,check_digit:null,is_online:!1,battery:null,in_use:!1,is_enabled:!0,manufacturer:null,equipment_location:null},submodels:{account:a,integration:r,placement:l},url:"/api/v2/sensors/sensors/",validate:function(e){var t;if(!(null===(t=e.name)||void 0===t?void 0:t.trim())){var i=_t("mobile_sensors_nickname");return{field:i,message:_t("mobile_sensors_field_not_blank",{field:i})}}},sync:function(e,t,i){return i&&i.use_id_param?i.url="".concat(t.url).concat(t.id,"/"):i.url=t.url,Backbone.sync(e,t,i)},get_last_reading_value:function(){return $f.utils.convert_to_company_temperature(this.get("last_reading_value"))},get_last_reading_date:function(){return s.Z.get_formatted_sensor_timestamp({timestamp:this.get("last_reading_date"),format:$f.utils.TIME_FMT,account:this.get("account")})},get_last_reading_timedelta_str:function(){return s.Z.get_sensor_timedelta_str_repr({timestamp:this.get("last_reading_date")})},get_placement_for_display:function(){var e=this.get("placement");return e?e.get("name"):""},is_initializing:function(){return!this.get_last_reading_value()},update_barcode_value:function(e,t){t==$f.mobile.sensors.util.MANUFACTURER.MONNIT?this.set($f.mobile.sensors.util.get_sensor_ids_from_scanner(e)):this.set($f.mobile.sensors.util.get_info_from_lorawan_barcode(e,!0))},set_device_id:function(e){this.set("sensor_id",e)},get_device_id:function(){return this.get("sensor_id")},sanitize_device_id:function(){var e=this.get_device_id();this.set_device_id(s.Z.sanitize_dev_eui(e.toUpperCase()))}}),m=n.Ds.extend({legacy_classname:"$f.shared.sensors.models.SensorsPaginator",defaults:$.extend({},n.Ds.prototype.defaults,{order_by:"is_online,-is_enabled,-name",limit:25}),override_default_query_string_attrs:["start","limit","order_by","account_id","name","group_id"],initialize:function(){m.__super__.initialize.apply(this,arguments),this.default_query_string_attrs=this.override_default_query_string_attrs}}),h=n.DR.extend({legacy_classname:"$f.shared.sensors.collections.Sensors",model:f,initialize:function(e,t){t=t||{},$.extend(this,t),this.paginator||(this.paginator=new m)},url:function(){return"/api/v2/sensors/sensors/?".concat(this.paginator.get_query_string())}})},"./src/backbone-unorganized/shared/sensors/util.js":function(e,t,i){var n=i("../../../node_modules/date-fns/esm/differenceInHours/index.js"),s=i("../../../node_modules/date-fns/esm/parseISO/index.js"),o={LOOKBACK_PERIODS:{HALF_DAY:"12h",DAY:"1d",WEEK:"1w",MONTH:"1m",YEAR:"1y"},READING_METHOD:{MANUAL:"manual",PROBE:"probe",SENSOR:"sensor"},DAY_IN_MILLISECONDS:864e5,CENTIGRADE:"°C",FAHRENHEIT:"°F",MINUTE_THRESHOLD:60,HOUR_THRESHOLD:24,YEAR_THRESHOLD:1,TEMPERATURE_LOG_REPORT_MAX_DAYS_INTERVAL:30,TRIGGER_REPORT_MAX_DAYS_INTERVAL:730,get_minimum_timestamp_for_lookback:function(e,t){var i;return void 0===t&&(t=Date.now()),t-((i={})[this.LOOKBACK_PERIODS.HALF_DAY]=this.DAY_IN_MILLISECONDS/2,i[this.LOOKBACK_PERIODS.DAY]=this.DAY_IN_MILLISECONDS,i[this.LOOKBACK_PERIODS.WEEK]=7*this.DAY_IN_MILLISECONDS,i[this.LOOKBACK_PERIODS.MONTH]=30*this.DAY_IN_MILLISECONDS,i[this.LOOKBACK_PERIODS.YEAR]=365*this.DAY_IN_MILLISECONDS,i)[e]},get_minimum_timestamp_for_sparkline:function(e,t){return Math.min(e,t)},get_formatted_sensor_timestamp:function(e){var t=e.account,i=e.timestamp,n=e.format,s=e.time_zone||t&&t.get("time_zone");return s?moment(i).tz(s).format(n):moment(i).format(n)},get_sensor_timedelta_str_repr:function(e){var t=moment(new Date),i=moment(e.timestamp),n=t.diff(i,"minutes"),s=t.diff(i,"hours"),o=t.diff(i,"days");return t.diff(i,"years")>=this.YEAR_THRESHOLD?_t("mobile_sensors_last_reading_max_date"):s>=this.HOUR_THRESHOLD?_t(0===o||o>1?"mobile_sensors_day_count_ago_plural":"mobile_sensors_day_count_ago",{count:o}):n>=this.MINUTE_THRESHOLD?_t(0===s||s>1?"mobile_sensors_hour_count_ago_plural":"mobile_sensors_hour_count_ago",{count:s}):_t(0===n||n>1?"mobile_sensors_minute_count_ago_plural":"mobile_sensors_minute_count_ago",{count:n})},get_formatted_date_for_cooldown:function(e,t,i){var n=new Date(e),s=t.get("time_zone");return s?moment(n).tz(s).format(i):moment(n).format(i)},is_valid_temperature:function(e){return/^-?\d+(,\d+)*(\.\d+(e\d+)?)?$/m.test(e)},is_sensor_temperature_criteria_valid:function(e){return Backbone.$.isArray(e)?this.is_valid_temperature(e[0])&&this.is_valid_temperature(e[1]):this.is_valid_temperature(e)},sanitize_dev_eui:function(e){return e?e.replace(/[:\s]/g,""):""},isValidSensorTemperatureReading:function(e,t,i){if(!e)return!1;if(!t||!i)return!1;var o=new Date;return!((0,n.Z)(o,(0,s.Z)(t))>1)},get_sensor_reading_method_formatted:function(e){return e===this.READING_METHOD.PROBE?"BLE":e===this.READING_METHOD.MANUAL?$f.utils.capitalize_string(e):void 0},get_temperature_formatted_with_reading_method:function(e,t){var i=$f.utils.convert_to_company_temperature(e);if($f.utils.is_nil(t))return i;var n=$f.shared.sensors.util.get_sensor_reading_method_formatted(t);return n?"".concat(i," (").concat(n,")"):i}};t.Z=o},"./src/backbone-unorganized/tasks/models.js":function(e,t,i){i.d(t,{yO:function(){return f},zS:function(){return m},jR:function(){return h},Wm:function(){return g},rd:function(){return p},_q:function(){return b},rM:function(){return v},pW:function(){return w},zz:function(){return y},Aq:function(){return k}});var n=i("./src/backbone/features/mobileForm/BaseField/models.js"),s=i("./src/backbone/features/mobileForm/MobileFormStructure/models.js"),o=i("./src/backbone/shared/models/MobileMediaField.js"),a=i("./src/backbone-unorganized/sensors/models.js"),r=i("./src/backbone-unorganized/shared/forms.js"),l={initialize:function(e,t){if(t.parent_project&&(this.parent_project=t.parent_project),!this.get("title_image_field")&&this.isNew()&&this.get("reply")&&"form_submission"!=this.get("reply").get("type")){if(!this.create_image_field_model)throw new Error("Programmer Error: create_image_field_model() not implemented in MobileTaskMixin implementation");this.set("title_image_field",this.create_image_field_model(),{silent:!0})}this.isNew()&&this.set("fulfillment",null,{silent:!0})},isNew:function(){return!!this.get("local_guid")||f.__super__.isNew.apply(this,arguments)},_convert_json_to_models:function(){!this.get("title_image_field")||this.get("title_image_field")instanceof Backbone.Model||this.set("title_image_field",new b(this.get("title_image_field"),{task_or_project:this instanceof m?this.parent_project:this}),{silent:!0})}},c=r.DR.extend({model:o.u}),u=r.b.extend({defaults:_.extend({},r.b.prototype.defaults,{triggering_image_fields:null}),submodels:{form_submission:s.M5,triggering_image_fields:c}}),d=r.c$.extend({_convert_json_to_models:function(){var e=this;$.each(this.get("fields"),(function(t,i){i instanceof Backbone.Model||(e.get("fields")[t]=new b(i,{task_or_project:e.parent_task}))}))}}),f=r.gb.extend({task_source_klass:u,fast_tasks_model:null,submodels:$.extend({cooldown:a.Uz},r.gb.prototype.submodels),initialize:function(e,t){t=t||{},this.fast_tasks_model=t.fast_tasks_model||null,f.__super__.initialize.apply(this,arguments)},sync:function(e,t,i){return"update"!=e||this.get("is_edit_mode")?f.__super__.sync.apply(this,arguments):(i.url="".concat(t.url,"/fulfill/"),Backbone.sync(e,t,i))},_convert_json_to_models:function(){!this.get("fulfillment")||this.get("fulfillment")instanceof Backbone.Model||this.set("fulfillment",new d(this.get("fulfillment"),{parent_task:this}),{silent:!0}),f.__super__._convert_json_to_models.apply(this,arguments),this.get("followers")&&this.set("followers",new v(this.get("followers").toJSON()),{silent:!0}),this.get("is_edit_mode")||this.set_default_fulfillment(),this.get("title_image")&&this.set("title_image",new n.e6(this.get("title_image").toJSON()),{silent:!0})},create_image_field_model:function(){return new b({id:1,type:"image"},{task_or_project:this})},set_default_fulfillment:function(){if(!this.get("fulfillment")&&this.get("reply")&&!this.isNew()){var e=this.get("reply");this.set("fulfillment",new r.c$({type:e.get("type")},{parent_task:this}));var t=this.get("fulfillment");if(e.get("form_template")&&t.set("form_template",e.get("form_template")),"quick"==t.get("type")){var i=this.create_image_field_model();i.set({title:"Please provide a photo:",required:!0}),t.get("fields").push(i)}}},save:function(){return this.isNew()||this.get("is_edit_mode")?(this.set("fulfillment",null),f.__super__.save.apply(this,arguments)):$f.active_user.is_logged_in()?(this.get("fulfillment").set({date_completed:{$date:(new Date).getTime()},user:{id:$f.active_user.get("id")}}),void f.__super__.save.apply(this,arguments)):f.__super__.save.apply(this,arguments)},get_date_due:function(){if(!this.get("date_due"))return null;var e=this.get("time_zone")||moment.tz.guess();return moment(this.get("date_due").$date).tz(e)},get_date_completed:function(){if(!this.get("date_submitted"))return null;var e=this.get("time_zone")||moment.tz.guess();return moment(this.get("date_submitted").$date).tz(e)},get_date_start:function(){if(!this.get("date_start"))return null;var e=this.get("time_zone")||moment.tz.guess();return moment(this.get("date_start").$date).tz(e)},is_missed:function(){var e=this.get_date_due();if("incomplete_and_closed"===this.get("current_state"))return!0;if(!e)return!1;if(!this.get("project"))return!1;var t=this.get("project").get("is_auto_archive"),i=moment();return!(!t||!i.isAfter(e))},is_task_all_day:function(){if(!this.is_task_started_and_due_within_same_day())return!1;var e=$f.utils.get_start_of_day(this.get_date_due()),t=$f.utils.get_end_of_day(this.get_date_due()),i=this.get_date_start(),n=this.get_date_due();return e===i&&t===n},is_task_started_and_due_within_same_day:function(){var e=this.get_date_start(),t=this.get_date_due();return!!t&&t.dayOfYear()===e.dayOfYear()},is_task_started_and_completed_within_same_day:function(){var e=this.get_date_start(),t=this.get_date_completed();return!!t&&t.dayOfYear()===e.dayOfYear()},is_task_due_today:function(){var e=moment(),t=this.get_date_due();return!!t&&t.dayOfYear()===e.dayOfYear()},is_task_complete_today:function(){var e=moment(),t=this.get_date_completed();return!!t&&t.dayOfYear()===e.dayOfYear()},is_archived:function(){return!(this.get("is_closed")||this.get("is_active"))},get_current_state_string:function(){var e=this.get("current_state");return{open:_t("mobile_task_status_title_open"),processing:_t("mobile_task_status_title_processing"),complete:_t("mobile_task_status_title_complete"),overdue:_t("mobile_tasks_toolbarnav_header_overdue"),incomplete_and_closed:_t("mobile_task_status_title_incomplete_and_closed"),complete_with_exception:_t("mobile_task_status_title_complete_with_exceptions"),unavailable:f.get_available_in_str(this.get_date_start())}[e]||$f.mobile.logging.log_error("Unknown task status",{status:e})},get_assigned_or_fulfilled_user_display:function(){try{return this.get("fulfillment").get("user").display_name}catch(e){if(this.get("assignee"))return this.get("assignee").get("display_name")}return null},delete_from_collection_and_caches:function(e){this.collection&&(this.collection.paginator&&!$f.utils.is_nil(this.collection.paginator.get("results_count"))&&this.collection.paginator.decrease_results_count(),this.collection.remove(this)),$f.mobile.cache.remove_ids_by_cache_substring({ids:this.id,cache_key_substrs:h.cache_denylist_key,callback:e})},persist_updates_to_caches:function(e){var t=this;$f.mobile.cache.update_cache_item({item_id:this.id,cache_key_substrs:h.cache_denylist_key,callback:e,update_fn:function(e){return t}})},mark_as_complete_in_caches:function(e){this.collection&&"active_incomplete"===this.collection.paginator.get("status")&&this.collection.paginator.decrease_results_count(),this.set("current_state","complete"),this.persist_updates_to_caches(e)},mark_as_archived_in_caches:function(e){this.set("current_state","incomplete_and_closed"),this.persist_updates_to_caches(e)},can_start:function(){if("unavailable"!==this.get("current_state"))return!0;var e=this.get("date_start").$date;return(new Date).getTime()>e}},{get_available_in_str:function(e){var t=moment(),i=e.diff(t,"years");if(1===i)return _t("mobile_tasks_bucket_available_in_one_year");if(i>1)return _t("mobile_tasks_bucket_available_in_years",{years:i});var n=e.diff(t,"months");if(1===n)return _t("mobile_tasks_bucket_available_in_one_month");if(n>1&&n<12)return _t("mobile_tasks_bucket_available_in_months",{months:n});var s=e.diff(t,"weeks");if(1===s)return _t("mobile_tasks_bucket_available_in_one_week");if(s>1&&s<=4)return _t("mobile_tasks_bucket_available_in_weeks",{weeks:s});var o=e.diff(t,"days");if(1===o)return _t("mobile_tasks_bucket_available_in_one_day");if(o>1&&o<7)return _t("mobile_tasks_bucket_available_in_days",{days:o});var a=e.diff(t,"hours");if(1===a)return _t("mobile_tasks_bucket_available_in_one_hour");if(a>1&&a<24)return _t("mobile_tasks_bucket_available_in_hours",{hours:a});var r=e.diff(t,"minutes");return 1===r?_t("mobile_tasks_bucket_available_in_one_minute"):r>1&&r<60?_t("mobile_tasks_bucket_available_in_minutes",{minutes:r}):e.diff(t,"seconds")<60?_t("mobile_tasks_bucket_available_in_one_minute"):_t("mobile_task_status_title_upcoming")}}),m=r.Dm.extend({parent_project:null,initialize:function(e,t){t=t||{},$.extend(this,t),m.__super__.initialize.apply(this,arguments),this.parent_project=t.parent_project||null},validation:$.extend({distribute_group:{fn:"_validate_distribute_group"}},r.Dm.prototype.validation),_validate_distribute_group:function(e,t,i){if(!e.get("id"))return"Please select a team."},create_image_field_model:function(){return new b({id:1,type:"image"},{task_or_project:this.parent_project})}});Cocktail.mixin(f,l),Cocktail.mixin(m,l);var h=r.hS.extend({cache_enabled:!0,cache_ttl:1e3,cache_key:null,default_limit:20,cache_fetch_limit:20,model:f,initialize:function(e,t){var i=this;return(t=t||{}).paginator_options=t.paginator_options||{},t.paginator_options.limit=t.paginator_options.limit||this.default_limit,$.extend(this,_.omit(t,"search_options")),this.paginator_options.limit=this.cache_fetch_limit,this.paginator||(t&&t.search_options&&_.extend(i.paginator_options,t.search_options),this.paginator=new r.Ds(i.paginator_options),t.search_options&&t.search_options.update_paginator&&t.search_options.update_paginator(this.paginator)),"name"===this.paginator.get("order_by")&&this.paginator.unset("order_by"),this.listenTo(this.paginator,"change:results_count",(function(){i._persist_results_count_to_cache()})),h.__super__.initialize.apply(this,arguments)},fetch_more_for_bucket:function(e,t){var i=this;this.paginator.next_page();var n=this.paginator.get("limit");this.paginator.set("limit",20),this.fetch({remove:!1,success:e,error:function(){i.paginator.set("limit",n),i.paginator.previous_page(),t()}})},comparator:function(e){},parse:function(e){var t=this,i=h.__super__.parse.apply(this,arguments);return"open"!==t.paginator.get("status")?i:i=$.grep(i,(function(e,i){try{var n=$f.mobile.cache.denylist[t.constructor.cache_denylist_key][e.id]}catch(e){}return!(n&&n>(new Date).getTime()-36e5)}))},fetch:function(e){return this.cache_key=this.get_cache_key(e),this._load_results_count_from_cache(),h.__super__.fetch.apply(this,arguments)},get_cache_key:function(e){var t=[];return _.each(this.paginator.toJSON(),(function(e,i){return!e||!!_.contains(["start","limit","search_query","search_by","results_count","order_by","num_selected","tz"],i)||("object"==typeof e&&(e=JSON.stringify(e)),void t.push("".concat(i,":").concat(e)))})),t=t.sort(),"".concat(this.constructor.cache_denylist_key,"__").concat($f.utils.hash_str(t.join("_")))},_persist_results_count_to_cache:function(){$f.mobile.tasks.results_count_cache.update_results_count(this.get_cache_key(),this.paginator.get("results_count"))},_load_results_count_from_cache:function(){var e=this;$f.mobile.tasks.results_count_cache.get_results_count(this.get_cache_key(),(function(t){e.paginator.set("results_count",t)}))}},{cache_denylist_key:"mobile_tasks",get_order_by_key_for_status:function(e){return"closed"===e?"date_completed":"date_due_local"},create_collection_using_search_options:function(e,t){t=t||{};var i=e.get_options_for_paginator();return t.account_id&&(i.account_id=t.account_id),new this([],{paginator_options:i})},create_collection_for_overdue_bucket:function(e,t){if(t=t||{},$f.utils.is_nil(t.limit))throw new Error("Programmer Error: options.limit requied for create_collection_for_overdue_bucket()");var i=this.create_collection_using_search_options(e,t),n=t.limit||i.paginator.limit;return i.paginator.set({bucket:"".concat(e.get_value_for_field("status"),"_overdue"),limit:n,search_query:null}),i.paginator.unset("status"),i.cache_fetch_limit=23,i},create_collection_for_today_bucket:function(e,t){t=t||{};var i=this.create_collection_using_search_options(e,t);return i.paginator.set({search_query:null,bucket:"".concat(e.get_value_for_field("status"),"_today")}),i.paginator.unset("status"),i},create_collection_for_week_bucket:function(e,t){t=t||{};var i=this.create_collection_using_search_options(e,t);return i.paginator.set({bucket:"".concat(e.get_value_for_field("status"),"_this_week")}),i.paginator.unset("status"),i},create_collection_outside_this_week_bucket:function(e,t){t=t||{};var i=this.create_collection_using_search_options(e,t),n=_.contains(["closed","archived_incomplete"],e.get_value_for_field("status"))?"last_week":"upcoming";return i.paginator.set({bucket:"".concat(e.get_value_for_field("status"),"_").concat(n)}),i.paginator.unset("status"),i},_create_collection_for_project_tasks:function(e,t){t=t||{};var i=this.create_collection_using_search_options(e,t);return i.paginator.set({search_query:null,include_has_exceptions:!0}),i},create_collection_for_project_tasks_complete:function(e,t){var i=this._create_collection_for_project_tasks(e,t);return i.paginator.set({status:"closed",search_query:null,order_by:"date_submitted",include_future_tasks_v2:!0,is_active:"null",include_has_exceptions:!0}),i.paginator.default_query_string_attrs.push("is_active"),i},create_collection_for_project_tasks_incomplete:function(e,t){var i=this._create_collection_for_project_tasks(e,t);return i.paginator.set({include_future_tasks_v2:!0,status:"active_incomplete",search_query:null,order_by:"date_due_local",include_has_exceptions:!0}),i},create_collection_for_project_tasks_archived_incomplete:function(e,t){var i=this._create_collection_for_project_tasks(e,t);return i.paginator.set({status:"archived_incomplete",search_query:null,include_future_tasks_v2:!0,order_by:"date_due_local",include_has_exceptions:!0}),i},create_collection_for_text_search:function(e,t){var i=this.create_collection_using_search_options(e,t),n=!0,s=!0;return"open_available"===i.paginator.get("status")&&(n=!1,s=!1),i.paginator.set({include_has_exceptions:s,include_future_tasks_v2:n}),i}}),g=h.extend({allow_group_id_on_me_filter:!0}),p=h.extend({_remove_cached_on_parse:!0,parse:function(e){var t=p.__super__.parse.apply(this,arguments);if(!this._remove_cached_on_parse)return this._remove_cached_on_parse=!0,t;var i=[];return $f.mobile.tasks.each((function(e,n){var s=!1;$.each(t,(function(t,i){if(i.id==e.get("id"))return s=!0,!1})),s||i.push(e.get("id"))})),$f.mobile.tasks.remove_records(i),t},fetch:function(e){!1===e.remove&&(this._remove_cached_on_parse=!1),p.__super__.fetch.apply(this,arguments)}}),b=o.u.extend({task_or_project:null,initialize:function(){if(b.__super__.initialize.apply(this,arguments),!this.task_or_project)throw new Error("Programmer Error: task_or_project not found in MediaFieldTask")},_is_fulfilling:function(){return!(this.task_or_project instanceof y||this.task_or_project.isNew())},get_parent_upload_guid:function(){return this.task_or_project instanceof y?($f.mobile.uploads.set_model_guid(this.task_or_project),this.task_or_project.id):this.task_or_project.fast_tasks_model?($f.mobile.uploads.set_model_guid(this.task_or_project.fast_tasks_model),this.task_or_project.fast_tasks_model.id):this.task_or_project.id},create_field_upload_filename:function(e){return this._is_fulfilling()?$f.storage.create_s3_filepath($f.active_company.id,"tasks/submissions",this.task_or_project.id,e.name):$f.storage.create_s3_filepath($f.active_company.id,"tasks/templates",null,e.name)}}),v=r.g3.extend({model:r.n5,convert_to_user_distributed:function(){var e=new r.hy;return this.each((function(t){e.add({id:"user~".concat(t.id),raw_id:t.id,type:"user",name:t.get_display_name()})})),e}}),w=r.Dn.extend({defaults:{id:null,tasks:null},submodels:{tasks:h},url:"/api/v1/tasks",sync:function(e,t,i){return"create"===e&&(i.url="".concat(t.url,"/save_fast_tasks/")),Backbone.sync(e,t,i)}}),y=r.IK.extend({submodels:function(){return _.extend({},r.IK.prototype.submodels,{create_tasks_data:m})},validation:_.extend(r.ve.prototype.validation,{distribute_group:function(){if(!this.get("create_tasks_data").get("distribute_group").get("id"))return _t("mobile_projects_team_required")},date_due_naive:function(e,t,i){if(!this.get("recurring")&&!this.get("date_due_naive"))return _t("mobile_projects_due_date_required")}}),initialize:function(){this.get("followers")||this.set("followers",new r.g3)},_get_submodeled_attributes:function(e){if(e.create_tasks_data&&!(e.create_tasks_data instanceof Backbone.Model)){var t=this._get_submodels();e.create_tasks_data=new t.create_tasks_data(e.create_tasks_data,{parent_project:this})}return y.__super__._get_submodeled_attributes.call(this,e)}}),k=r.pj.extend({group_name:null,initialize:function(e,t){k.__super__.initialize.apply(this,arguments),this.paginator.set("order_by","date_due_local")}})},"./src/backbone-unorganized/tasks/views.js":function(e,t,i){i.r(t),i.d(t,{FastTaskItem:function(){return f},FastTasksList:function(){return m},AutocompleteItem:function(){return h},AutocompleteList:function(){return g},FormTaskTypeaheadItem:function(){return p},FormTaskTypeahead:function(){return b},TaskFollower:function(){return v},TaskFollowers:function(){return w},FollowerModal:function(){return y},TasksCreator:function(){return k},TaskEditPage:function(){return T},FastTasksPage:function(){return x},TasksBucketSeeMore:function(){return E},TasksBucketSet:function(){return S},TasksBucket:function(){return C},TasksAccountBucket:function(){return D},TasksAccountBucketList:function(){return O}});var n=i("./src/backbone-unorganized/dashboard/views.js"),s=i("./src/backbone-unorganized/models.js"),o=i("./src/backbone-unorganized/shared/forms.js"),a=i("./src/backbone-unorganized/views.js"),r=i("./src/backbone/shared/views/baseLayoutViews.js"),l=i("./src/backbone-unorganized/tasks/models.js"),c=i("./src/backbone/features/mobileForm/imageField/views.js"),u=i("./src/backbone/shared/views/SelectAccountModal.js"),d=i("./src/backbone/shared/views/EmptyListMessage.js"),f=Backbone.Marionette.ItemView.extend({template:"#tpl_fast_task_item",className:"fast_task_item",tagName:"li",model:null,fast_tasks_model:null,events:{"click .fast_task_item a":"goto_task"},templateHelpers:function(){return{show_form_submission_icon:"form_submission"===this.model.get("reply").get("type")}},initialize:function(e){e=e||{},$.extend(this,e)},goto_task:function(e){e.preventDefault(),$f.mobile.nav.show(T,{model:this.model,fast_tasks_model:this.fast_tasks_model,mode:"temp_edit"})}}),m=Backbone.Marionette.CollectionView.extend({template:"#tpl_fast_tasks_list",itemView:f,className:"fast_tasks_list",tagName:"ul",collection:null,fast_tasks_model:null,initialize:function(e){if(e=e||{},$.extend(this,e),!this.collection)throw new Error("Programmer Error: collection required for FastTasksList")},itemViewOptions:function(e){return{fast_tasks_model:this.fast_tasks_model}}}),h=Backbone.Marionette.ItemView.extend({template:"#tpl_autocomplete_item",className:"autocomplete_item",tagName:"li",model:null,templateHelpers:function(){return{title:this.generate_title()}},events:{"click .autocomplete_item a":"on_select"},initialize:function(e){e=e||{},$.extend(this,e)},on_select:function(e){throw e.preventDefault(),new Error("Programmer Error: on_select not implemented")},generate_title:function(){throw new Error("Programmer Error: generate_title not implemented")}}),g=Backbone.Marionette.CollectionView.extend({template:"#tpl_autocomplete_list",itemView:h,className:"autocomplete_list",tagName:"ul",search_key:null,minimum_text_length:2,collection_class:null,initialize:function(e){if(e=e||{},$.extend(this,e),!this.collection_class)throw new Error("Programmer Error: collection class required for AutocompleteList subclass");this.collection=new this.collection_class,this.setup_collection(),this.setup_event_listeners()},onShow:function(){!this.search_key||this.search_key.length<this.minimum_text_length?$f.mobile.hide_overflow_touchblock():($(".r_form_task_typeahead").removeClass("disabled"),this.search())},setup_collection:function(){},setup_event_listeners:function(){},search:function(e){var t=this,i=$f.mobile.is.web()||$f.mobile.is.connected();this.collection.typeahead_search(this.search_key,(function(e){0===e.length&&t.on_no_results()}),i)},on_select:function(e){},on_no_results:function(){}}),p=h.extend({model:null,on_select:function(e){e.preventDefault(),this.trigger("form_template_selected",this.model)},generate_title:function(){return this.model.get("title")||""}}),b=g.extend({itemView:p,collection_class:o.cG,setup_collection:function(){this.collection.paginator.set({filter:$f.active_user.is_admin()?"all":"me"})},setup_event_listeners:function(){this.listenTo(this,"itemview:form_template_selected",(function(e,t){this.on_select(t)}))}}),v=Backbone.Marionette.ItemView.extend({template:"#tpl_task_follower",className:"form-field",tagName:"li",model:null,events:{"click .follower_item .df-remove-circle":"remove_follower"},templateHelpers:function(){return{show_remove_follower:!1===$f.active_user.is_submitter(),title:this.model.get_display_name()}},initialize:function(e){e=e||{},$.extend(this,e)},remove_follower:function(e){e.preventDefault(),this.model.collection.remove(this.model)}}),w=Backbone.Marionette.CollectionView.extend({template:"#tpl_task_followers",itemView:v,className:"followers_list",tagName:"ul",collection:null,initialize:function(e){e=e||{},$.extend(this,e);var t=this;this.listenTo(this.collection,"remove",(function(){this.trigger("followers:follower_removed",t.collection)}))}}),y=a.SelectUserModal.extend({collection_class:o.hy,allow_multiple:!0,toolbarnav_title:function(){return _t("mobile_tasks_select_followers")}}),k=r.IO.extend({template:"#tpl_tasks_creator",className:"tasks_creator",toolbarnav_center_title:!0,toolbarnav_show_add_task:!1,use_transitions:!0,model:null,fast_tasks_model:null,account:null,assignee:null,date_due_naive:null,title:null,image_files:null,mode:"create",is_changed:!1,regions:{r_task_images:".r_task_images",r_multi_task_creator_date_picker:".r_multi_task_creator_date_picker",r_multi_task_creator_followers:".r_multi_task_creator_followers",r_form_task_typeahead:".r_form_task_typeahead"},events:{"click .btn_account":"select_account","click .btn_user":"select_user","click .btn_date_due":"select_date_due","click .btn_done":"done_clicked","click .clear_title.remove_title":"clear_title","change .btn_date_due":"date_changed","keyup .task_title":"title_keyup"},templateHelpers:function(){return{location:this.account?this.account.get("name"):_t("mobile_common_unassigned"),assignee:this.assignee&&this.assignee.get("id")?this.assignee.get_display_name():_t("mobile_common_unassigned"),date_due_display_str:this.format_date(),title:this.title||"",show_form_submission_icon:"form_submission"===this.model.get("reply").get("type"),placeholder:_t("mobile_tasks_title_placeholder")}},initialize:function(e){e=e||{},$.extend(this,e);var t=this;this.model&&(this.model.store(),this.listenTo(this.model,"change",(function(){t.is_changed=!0})),this.listenTo(this.model.get("title_image_field"),"change",(function(){t.is_changed=!0,t.update_buttons_state()}))),this.fast_tasks_model&&this.fast_tasks_model.get("tasks")&&this.listenTo(this.fast_tasks_model.get("tasks"),"change",(function(){t.is_changed=!0})),this._hide_form_task_typeahead()},onBeforeRender:function(){this.$el.find(".btn_date_due")&&this.$el.find(".btn_date_due").mobiscroll("destroy")},onRender:function(){var e=this;this.show_image_field(),this.setup_date_due_selector(),this.update_buttons_state(),this.listenTo(this,"task_creator:defaults_changed",(function(t){t&&(e.date_due_naive=t.date_due_naive?t.date_due_naive:e.date_due_naive,e.account=t.account?t.account:e.account,e.assignee=t.assignee?t.assignee:e.assignee)})),this._on_rerender()},show_image_field:function(){var e=this;"quick"===this.model.get("reply").get("type")?(this.r_task_images.show(new c.IL({model:this.model.get("title_image_field"),task:this.model,hide_caption:!0,on_select:function(){e.image_files=e.model.get("title_image_field").get("file"),e._on_images_select()}})),this.listenTo(e.r_task_images.currentView.model,"change:file",(function(){e.is_changed=!0}))):this.model.get("title_image_field").set("file",[])},_hide_form_task_typeahead:function(){this.$el.find(".r_form_task_typeahead").addClass("disabled"),this.r_form_task_typeahead&&this.r_form_task_typeahead.close(),$f.mobile.hide_overflow_touchblock()},_on_images_select:function(){},setup_date_due_selector:function(){var e=this.get_date_due(),t=$f.utils.get_utc_date_without_offset(e);this.$el.find(".btn_date_due").mobiscroll().date({theme:"material",display:"bottom",defaultValue:t,max:new Date((new Date).getFullYear()+10,11,31),focusOnClose:!1,dateWheels:"M D d yy",min:moment().startOf("day").toDate()})},select_account:function(e){e.preventDefault();var t=this;if($f.active_user.is_submitter()&&0!==$f.active_user.get("accounts").length)return!1;$f.mobile.nav.show_modal(u.H,{post_on_select:function(e){t.account=e,t.model.set("account",t.account),t.trigger("task_creator:defaults_changed",{account:t.account}),0!==t.account.get("owners").length?t.update_assignee(t.account.get("owners").at(0),(function(){t.trigger("task_creator:defaults_changed",{assignee:t.assignee}),t.model.set("assignee",t.assignee),t._select_account(),t._select_user(),t.render()})):(t._select_account(),t.render())}})},_select_account:function(){},select_user:function(e){e.preventDefault();var t=this;if($f.active_user.is_submitter())return!1;$f.mobile.nav.show_modal(a.SelectUserModal,{post_on_select:function(e){t.update_assignee(e,(function(){t.trigger("task_creator:defaults_changed",{assignee:t.assignee}),t.model.set("assignee",t.assignee),t._select_user(),t.render()}))}})},_select_user:function(){},_reset_view:function(){this._hide_form_task_typeahead(),this.model.set({title:this.title,reply:{type:"quick"}}),this.show_image_field()},select_date_due:function(e){return this.$el.find(".btn_date_due").mobiscroll("show"),!1},clear_title:function(e){e.preventDefault(),this.title="",this.$el.find(".remove_title").addClass("disabled"),this._reset_view(),this.render()},title_keyup:function(e){var t=this;this.title=this.$el.find(".task_title").val(),this.title=this.title.replace(/^\s*\n/gm,"").trim(),this.update_buttons_state(),this.$el.find(".df-form").addClass("disabled"),this.$el.find(".task_title").removeClass("form_submission"),this.$el.find(".r_form_task_typeahead").addClass("disabled"),this.model.set("title",this.title),13===e.keyCode&&this.title&&(e.preventDefault(),this._reset_view(),this._set_title(),this.$el.find(".btn_done").trigger("click")),this.r_form_task_typeahead.show(new b({model:this.model.get("reply").get("form_template")||new o._U,search_key:this.title,on_select:function(e){t.model.get("reply").set({form_template:new o._U({id:e.id,title:e.get("title")}),type:"form_submission"}),t.title=e.get("title"),t.model.set("title",e.get("title")),t.$el.find(".task_title").val(e.get("title")),t.r_task_images.close(),t._set_title(),t.render()},on_no_results:function(){t._reset_view(),t._set_title()}})),this.r_form_task_typeahead.on("show",(function(){$f.mobile.show_overflow_touchblock($(".overflow_touchblock.typeahead"),(function(){return $f.mobile.hide_overflow_touchblock(),t._reset_view(),t._set_title(),t.update_buttons_state(),!1}))}))},_set_title:function(){},date_changed:function(){var e=this.$el.find(".btn_date_due").mobiscroll("getDate");this.date_due_naive=e.toLocaleDateString("en-CA")+"T23:59:59.999Z",this.trigger("task_creator:defaults_changed",{date_due_naive:this.date_due_naive}),this.model.set("date_due_naive",this.date_due_naive),this._select_date_due(),this.render()},_select_date_due:function(){},done_clicked:function(e){e.preventDefault(),this._on_done_clicked()},_on_done_clicked:function(){},_clear_pending_uploads:function(){_.contains(["edit","create"],this.mode)&&(this.model.id||this.model.fast_tasks_model||this.model.fast_tasks_model.id)&&$f.mobile.uploads.clear_pending_file_uploads(this.model.id||this.model.fast_tasks_model.id)},go_back:function(){var e=this,t="edit"!==this.mode?this.fast_tasks_model.get("tasks").length:0,i="create"!==this.mode&&this.title||"create"===this.mode&&t>0,n="create"===this.mode?_t("mobile_tasks_assign_tasks",{count:t}):_t("mobile_message_task_detials_confirm_save_task"),s=_t("mobile_message_task_detials_confirm_message");if(this.is_changed){if(!$f.mobile.is.web()){var o={title:_t("mobile_message_task_detials_confirm_title"),subtitle:s,position:[50,60],addCancelButtonWithLabel:_t("mobile_action_sheet_cancel")};return $f.mobile.is.ios()?(i&&(o.buttonLabels=[n]),o.addDestructiveButtonWithLabel=_t("mobile_common_button_discard"),o.destructiveButtonLast=!0):$f.mobile.is.android()?(o.buttonLabels=i?[n,_t("mobile_common_button_discard")]:[_t("mobile_common_button_discard")],o.androidTheme=$f.mobile.cordova.actionsheet.ANDROID_THEMES.THEME_DEVICE_DEFAULT_LIGHT,o.androidEnableCancelButton=!0):$f.mobile.is.windows()&&(o.buttonLabels=i?[n,_t("mobile_common_button_discard")]:[_t("mobile_common_button_discard")]),void $f.mobile.notifications.decide(o,(function(t){if(i){if(3===t)return;if(1===t)return void("temp_edit"===e.mode?e.$el.find(".btn_done").trigger("click"):"edit"==e.mode?e.$el.find(".btn_save_task").trigger("click"):e.$el.find(".btn_assign_tasks").trigger("click"));e._clear_pending_uploads(),e._restore_model()}else{if(2===t)return;e._clear_pending_uploads(),e._restore_model()}}))}$f.mobile.notifications.confirm(s,(function(t){t&&(e._clear_pending_uploads(),e._restore_model())}),_t("mobile_common_button_save_draft"),_t("mobile_common_button_yes"),_t("mobile_common_button_no"))}else $f.mobile.nav.go_back()},_restore_model:function(){this.model.restore(),this.model.set("title_image_field",new l._q({id:1,type:"image",title:"",value:this.model.get("title_image").toJSON(),required:!1},{task_or_project:this.model}),{silent:!0}),$f.mobile.nav.add_options({model:this.model}),$f.mobile.nav.go_back()},get_date_due:function(){if(this.date_due_naive)return moment.utc(this.date_due_naive);if(this.model.get("date_due")){var e=this.model._get_zoned_time("date_due");if(null!==e)return e}var t=moment.utc().add(3,"day").endOf("day");return moment(t.toISOString())},format_date:function(){return this.get_date_due().format("ddd, MMM D, YYYY")},update_assignee:function(e,t){t=t||function(){},$f.mobile.notifications.hide_loading_dialog(),e&&(this.assignee=new o.n5({id:$f.active_user.is_submitter()?$f.active_user.get("id"):e.get("raw_id")||e.get("id")}),this.assignee.fetch({success:function(){t()},error:function(e){t()}}))},_on_rerender:function(){},update_buttons_state:function(){var e=this.model.get("title_image_field").get("file");this.title?(this.$el.find(".btn_done").removeClass("grayed_out"),this.$el.find(".btn_done").removeClass("disabled"),this.$el.find(".remove_title").removeClass("disabled")):(this.$el.find(".remove_title").addClass("disabled"),e?e&&0===e.length?(this.$el.find(".btn_done").removeClass("grayed_out"),this.$el.find(".btn_done").addClass("disabled")):(this.$el.find(".btn_done").removeClass("disabled"),this.$el.find(".btn_done").addClass("grayed_out")):this.$el.find(".btn_done").addClass("disabled"))}}),T=k.extend({template:"#tpl_task_edit_page",followers:null,toolbarnav_title:function(){return _t("mobile_tasks_toolbarnav_title_edit_task")},regions:function(){return $.extend({},k.prototype.regions,{r_followers_list:".r_followers_list"})},events:$.extend({"change .description_watched_input":"update_description","click .btn_add_followers":"show_followers","click .btn_delete_task":"delete_task","click .btn_save_task":"save_task"},k.prototype.events),templateHelpers:function(){return $.extend({},T.__super__.templateHelpers.apply(this,arguments),{show_delete:"temp_edit"===this.mode,show_followers_title:!!this.followers&&this.followers.length>0,placeholder_description:_t("mobile_task_placeholder_description"),followers_title:_t("mobile_tasks_followers"),add_followers:_t("mobile_tasks_add_followers"),show_add_followers:!$f.active_user.is_submitter()})},initialize:function(e){e=e||{},$.extend(this,e),this.mode=e.mode,this.account=this.model.get("account"),this.assignee=this.model.get("assignee"),this.date_due=this.model.get("date_due"),this.title=this.model.get("title"),this.model.get("followers")&&this.model.get("followers").length>0?this.followers=this.model.get("followers"):(this.followers=new l.rM,T.__super__.initialize.apply(this,arguments))},_on_rerender:function(){var e=this,t=new w({collection:this.followers});this.r_followers_list.show(t),this.listenTo(t,"followers:follower_removed",(function(t){e.followers=t,e.model.set("followers",e.followers),e.render()}))},update_buttons_state:function(){"temp_edit"!==this.mode?(this.$el.find(".btn_done").addClass("disabled"),this.title?(this.$el.find(".btn_save_task").removeClass("disabled"),this.$el.find(".remove_title").removeClass("disabled")):(this.$el.find(".btn_save_task").addClass("disabled"),this.$el.find(".remove_title").addClass("disabled"))):T.__super__.update_buttons_state.apply(this,arguments)},_on_done_clicked:function(){if("temp_edit"===this.mode)return this.title="",this.image_files=null,void $f.mobile.nav.go_back()},update_description:function(e){var t=$(e.target);this.model.set("description",t.val())},show_followers:function(e){e.preventDefault();var t=this,i=t.followers?t.followers.convert_to_user_distributed():new o.hy;$f.mobile.nav.show_modal(y,{collection:i,default_selections:i,post_on_select:function(e){t.followers=new l.rM,e.each((function(e){t.followers.push({id:e.get("raw_id"),display_name:e.get("name")})})),t.model.set("followers",t.followers),t.render()}})},delete_task:function(e){e.preventDefault();var t=this,i=_t("mobile_message_task_detials_confirm_message"),n=_t("mobile_drafts_button_delete"),s=_t("mobile_message_task_detials_confirm_save_task");if("temp_edit"===this.mode){if(!$f.mobile.is.web()){var o={title:_t("mobile_message_task_detials_confirm_title"),subtitle:i,position:[50,60],addCancelButtonWithLabel:_t("mobile_action_sheet_cancel")};return $f.mobile.is.ios()?(this.title&&(o.buttonLabels=[s]),o.addDestructiveButtonWithLabel=n,o.destructiveButtonLast=!0):$f.mobile.is.android()?(this.title?o.buttonLabels=[s,n]:o.buttonLabels=[n],o.androidTheme=$f.mobile.cordova.actionsheet.ANDROID_THEMES.THEME_DEVICE_DEFAULT_LIGHT,o.androidEnableCancelButton=!0):$f.mobile.is.windows()&&(this.title?o.buttonLabels=[s,n]:o.buttonLabels=[n]),void $f.mobile.notifications.decide(o,(function(e){if(t.title){if(3===e)return;if(1===e)return void t.$el.find(".btn_done").trigger("click");t._delete_task()}else{if(2===e)return;t._delete_task()}}))}$f.mobile.notifications.confirm(i,(function(e){e&&t._delete_task()}),_t("mobile_common_button_save_draft"),_t("mobile_common_button_yes"),_t("mobile_common_button_no"))}},save_task:function(e){e.preventDefault();var t=this;this.$el.find(".btn_save_task").addClass("disabled"),$f.mobile.notifications.show_loading_dialog(),$f.mobile.new_tasks.get_pending_task(t.model.id,(function(e){e?$f.mobile.notifications.show_error_msg(_t("mobile_task_edition_already_in_progress"),!0):$f.mobile.new_tasks.add_records(t.model,(function(){t.$el.find(".btn_save_task").removeClass("disabled"),$f.mobile.notifications.hide_loading_dialog(),$f.mobile.nav.add_options({model:t.model}),t.model.persist_updates_to_caches((function(){$f.mobile.is.native()&&$f.mobile.nav.go_back(),$f.mobile.uploads.start_upload({msg:_t("mobile_task_task_updated"),error_msg:_t("mobile_task_error_updating_task"),success:function(){t.model.set("is_edit_mode",!1),$f.mobile.is.web()&&$f.mobile.nav.go_back()}})}))}),(function(){t.$el.find(".btn_save_task").removeClass("disabled"),$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg(_t("mobile_task_error_updating_task"),!0)}))}))},_delete_task:function(){this.fast_tasks_model.get("tasks").remove(this.model),$f.mobile.nav.go_back()}}),x=k.extend({template:"#tpl_fast_tasks_page",mode:"create",toolbarnav_title:function(){return _t("mobile_tasks_create_task")},regions:function(){return $.extend({},k.prototype.regions,{r_fast_tasks_list:".r_fast_tasks_list"})},events:$.extend({"click .btn_assign_tasks":"assign_tasks"},k.prototype.events),templateHelpers:function(){return $.extend({},x.__super__.templateHelpers.apply(this,arguments),{assign_task_title:"create"===this.mode?_t("mobile_tasks_assign_tasks",{count:this.fast_tasks_model.get("tasks").length}):""})},initialize:function(e){var t=this;if(e=e||{},$.extend(this,e),this.fast_tasks_model||(this.fast_tasks_model=new l.pW,this.fast_tasks_model.set("tasks",new l.jR,{silent:!0})),this.init_task_model(),x.__super__.initialize.apply(this,arguments),!this.date_due_naive){var i=moment.utc().add(3,"day").endOf("day");this.date_due_naive=i.toISOString()}this.listenTo(this.fast_tasks_model.get("tasks"),"add remove reset",(function(){t.init_task_model(),t.render()}))},_on_rerender:function(){var e=this;this.model.set({account:this.account,assignee:this.assignee,date_due_naive:this.date_due_naive,title:this.title},{silent:!0}),this.image_files&&(this.model.get("title_image_field").set("file",this.image_files,{silent:!0}),this.show_image_field()),this.r_fast_tasks_list.show(new m({collection:this.fast_tasks_model.get("tasks"),fast_tasks_model:this.fast_tasks_model})),this.fast_tasks_model&&this.fast_tasks_model.get("tasks").length>0?this.$el.find(".btn_assign_tasks").removeClass("disabled"):this.$el.find(".btn_assign_tasks").addClass("disabled"),this.account||this.assignee||($f.mobile.notifications.show_loading_dialog(),this.fetch_accounts((function(t){var i=$f.active_user.get("accounts");if($f.active_user.is_submitter())return i&&0!==i.length&&(e.account=t.findWhere({id:i[0].id})),void e.update_assignee($f.active_user,(function(){$f.mobile.nav.add_options({assignee:e.assignee}),e.render()}));0!==t.length?(e.account=t.at(0),$f.mobile.nav.add_options({account:e.account}),0!==e.account.get("owners").length?e.update_assignee(e.account.get("owners").at(0),(function(){$f.mobile.nav.add_options({assignee:e.assignee}),e.render()})):($f.mobile.notifications.hide_loading_dialog(),e.render())):$f.mobile.notifications.hide_loading_dialog()}),(function(e){$f.mobile.notifications.hide_loading_dialog()}))),this.fast_tasks_model&&this.fast_tasks_model.get("tasks")&&this.fast_tasks_model.get("tasks").length>0&&(this.is_changed=!0)},onDomRefresh:function(){var e=this;setTimeout((function(){e.title||e.$el.find(".task_title").focus()}),500)},init_task_model:function(){this.model=new l.yO({reply:{type:"quick"},assignee:this.assignee,account:this.account,date_due_naive:this.date_due_naive,source:new o.b({type:"mobile"})},{fast_tasks_model:this.fast_tasks_model}),$f.mobile.nav.add_options({model:this.model,fast_tasks_model:this.fast_tasks_model})},_on_done_clicked:function(){var e=this;this.trigger("task_creator:defaults_changed",{assignee:e.assignee,account:e.account,date_due_naive:e.date_due_naive}),this.title="",this.image_files=null,$f.mobile.nav.add_options({title:"",image_files:null}),this.fast_tasks_model.get("tasks").unshift(this.model)},_select_account:function(){$f.mobile.nav.add_options({account:this.account})},_select_user:function(){$f.mobile.nav.add_options({assignee:this.assignee})},_select_date_due:function(){$f.mobile.nav.add_options({date_due_naive:this.date_due_naive})},_set_title:function(){$f.mobile.nav.add_options({title:this.title})},_on_images_select:function(){$f.mobile.nav.add_options({image_files:this.image_files})},assign_tasks:function(e){e.preventDefault();var t=this;$f.mobile.notifications.show_loading_dialog(),$f.mobile.fast_tasks.add_records(t.fast_tasks_model,(function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.nav.add_options({fast_tasks_model:t.fast_tasks_model}),$f.mobile.is.native()&&$f.mobile.nav.go_back(),$f.mobile.uploads.start_upload({error_msg:_t("mobile_common_message_task_creator_error_save"),success:function(){$f.mobile.is.web()&&$f.mobile.nav.go_back()},msg:_t("mobile_message_task_detials_wait_submit_task_created")},!0)}),(function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg(_t("mobile_common_message_task_creator_error_save"),!0)}))},fetch_accounts:function(e,t){e=e||function(){},t=t||function(){};var i=new s.RM;i.fetch({success:function(){e(i)},error:function(e){t(e)}})}}),E=Backbone.Marionette.ItemView.extend({template:"#tpl_tasks_bucket_see_more",tagName:"a",className:"tasks_bucket_see_more",collection:null,attributes:{href:"#"},events:{click:"fetch_more"},fetch_more:function(){var e=this;return this.$el.hasClass("disabled")||(this._disable_button(),this.collection.fetch_more_for_bucket((function(){return e._enable_button()}),(function(){e._enable_button(),$f.mobile.is.connected()||$f.mobile.notifications.show_offline_msg()}))),!1},_disable_button:function(){this.$el.addClass("disabled")},_enable_button:function(){this.$el.removeClass("disabled")}}),S=Backbone.Marionette.Layout.extend({template:"#tpl_tasks_bucket_set",search_options:null,tasks_collection_class:null,account_id:null,task_bucket_collections:null,regions:{r_tasks_overdue:".r_tasks_overdue",r_today_tasks:".r_today_tasks",r_week_tasks:".r_week_tasks",r_outside_week_tasks:".r_outside_week_tasks",r_project_tasks_incomplete:".r_project_tasks_incomplete",r_project_tasks_complete:".r_project_tasks_complete",r_project_tasks_archived_incomplete:".r_project_tasks_archived_incomplete"},initialize:function(e){e=e||{},$.extend(this,e);var t=this;this.listenTo($f.application.vent,"dashboard:tasks:rerender_tasks",(function(){t.search_options.fetch_from_local((function(){t.task_bucket_collections={},t._show_buckets()}))}))},onRender:function(){this._isShown&&this._on_show_render()},onShow:function(){this._on_show_render()},_on_show_render:function(){this._show_buckets()},_show_buckets:function(){var e=this.search_options.findWhere({field:"project_ids"});e&&e.get("value")?this._show_task_buckets_for_project(this.search_options):this._show_task_buckets(this.search_options)},_show_task_buckets:function(){var e,t,i,n=this.search_options.get_value_for_field("status"),s="closed"!==n,o="archived_incomplete"===n,a="account"===this.search_options.get_value_for_field("group_by");s&&!o&&this.r_tasks_overdue.show(new C({bucket_title:_t("mobile_tasks_toolbarnav_header_overdue"),collection:this._get_collection_for_overdue(this.search_options),show_count:!0,should_hide_when_empty:!0,no_fetch:!this._should_show_overdue_card(this.search_options),empty_view_i18n_key:"mobile_empty_list_message_no_tasks_overdue"})),e=s?o?_t("mobile_tasks_bucket_missed_today"):_t("mobile_tasks_bucket_due_next_24_hours"):_t("mobile_tasks_bucket_completed_today"),this.r_today_tasks.show(new C({bucket_title:e,collection:this._get_collection_for_today_tasks(this.search_options),always_display_time:!0})),a||(t=s?o?_t("mobile_tasks_bucket_missed_this_week"):_t("mobile_tasks_bucket_due_next_7_days"):_t("mobile_tasks_bucket_completed_this_week"),this.r_week_tasks.show(new C({bucket_title:t,collection:this._get_collection_for_week(this.search_options),is_collapsed:!0}))),a||(i=s?o?_t("mobile_tasks_bucket_missed_last_week"):_t("mobile_tasks_bucket_open_tasks"):_t("mobile_tasks_bucket_completed_last_week"),this.r_outside_week_tasks.show(new C({bucket_title:i,collection:this._get_collection_for_outside_this_week(this.search_options),is_collapsed:!0})))},_show_task_buckets_for_project:function(){var e=this.search_options.findWhere({field:"status"}).get("value")||"all";"all"!==e&&"open"!==e||this.r_project_tasks_incomplete.show(new C({bucket_title:_t("mobile_tso_filter_incomplete"),collection:this._get_collection_for_project_tasks_incomplete(this.search_options)})),"all"!==e&&"closed"!==e||this.r_project_tasks_complete.show(new C({bucket_title:_t("mobile_tso_filter_completed"),collection:this._get_collection_for_project_tasks_complete(this.search_options)})),"all"!==e&&"archived_incomplete"!==e||this.r_project_tasks_archived_incomplete.show(new C({bucket_title:_t("mobile_task_status_title_incomplete_and_closed"),collection:this._get_collection_for_project_tasks_archived_incomplete(this.search_options)}))},_should_show_overdue_card:function(){return"closed"!==this.search_options.get_value_for_field("status")},_get_collection_for_overdue:function(e){return this.task_bucket_collections.overdue||(this.task_bucket_collections.overdue=this.tasks_collection_class.create_collection_for_overdue_bucket(e,{limit:3,account_id:this.account_id})),this.task_bucket_collections.overdue},_get_collection_for_today_tasks:function(e){return this.task_bucket_collections.today||(this.task_bucket_collections.today=this.tasks_collection_class.create_collection_for_today_bucket(e,{account_id:this.account_id})),this.task_bucket_collections.today},_get_collection_for_week:function(e){return this.task_bucket_collections.week||(this.task_bucket_collections.week=this.tasks_collection_class.create_collection_for_week_bucket(e,{account_id:this.account_id})),this.task_bucket_collections.week},_get_collection_for_outside_this_week:function(e){return this.task_bucket_collections.outside_this_week||(this.task_bucket_collections.outside_this_week=this.tasks_collection_class.create_collection_outside_this_week_bucket(e,{account_id:this.account_id})),this.task_bucket_collections.outside_this_week},_get_collection_for_project_tasks_complete:function(e){return this.task_bucket_collections.complete||(this.task_bucket_collections.complete=this.tasks_collection_class.create_collection_for_project_tasks_complete(e,{account_id:this.account_id})),this.task_bucket_collections.complete},_get_collection_for_project_tasks_incomplete:function(e){return this.task_bucket_collections.incomplete||(this.task_bucket_collections.incomplete=this.tasks_collection_class.create_collection_for_project_tasks_incomplete(e,{account_id:this.account_id})),this.task_bucket_collections.incomplete},_get_collection_for_project_tasks_archived_incomplete:function(e){return this.task_bucket_collections.archived_incomplete||(this.task_bucket_collections.archived_incomplete=this.tasks_collection_class.create_collection_for_project_tasks_archived_incomplete(e,{account_id:this.account_id})),this.task_bucket_collections.archived_incomplete}}),C=Backbone.Marionette.Layout.extend({template:"#tpl_tasks_bucket",className:"dashboard_card card sticky_header",collection:null,bucket_title:null,no_fetch:!1,show_count:!1,empty_view_i18n_key:null,always_display_time:!1,should_hide_when_empty:!1,is_collapsed:!1,regions:{r_body:".r_body",r_tasks_bucket_see_more:".r_tasks_bucket_see_more"},templateHelpers:function(){return{bucket_title:this.bucket_title,show_header:this.bucket_title,show_count:this.show_count,results_count:this._get_results_count_display(),is_collapsed:this.is_collapsed}},events:{"click .dashboard_card_header":"toggle_task_bucket"},initialize:function(e){e=e||{},$.extend(this,e);var t=this;t.is_collapsed&&($f.mobile.tasks.buckets_collapsed_states[this._get_collapsed_state_id()]=!0),this.listenTo(this.collection,"sync",(function(){t._show_hide_see_more_button(),t._update_header_count(),t._show_tasks_list()})),this.listenTo(this.collection,"error",(function(){$f.mobile.is.connected()&&t._show_error_state()}))},onBeforeRender:function(){this.r_tasks_bucket_see_more.close()},onRender:function(){this._isShown&&this._on_show_render()},onShow:function(){this._on_show_render()},_on_show_render:function(){this._watch_for_visible(),this._show_loading_state(),this._show_hide_see_more_button()},onClose:function(){this._get_$page_scrollable().off(this._get_scroll_event_name())},_should_fetch:function(){return!this.no_fetch&&!this.collection.is_fetched&&!this.is_collapsed},_watch_for_visible:function(){var e=this;!$f.utils.is_element_in_viewport(this.$el)&&e._should_fetch()?this._get_$page_scrollable().on(this._get_scroll_event_name(),(function(){$f.utils.is_element_in_viewport(e.$el)&&(e._get_$page_scrollable().off(e._get_scroll_event_name()),e._perform_initial_fetch())})):e._perform_initial_fetch()},_get_$page_scrollable:function(){if(!this.$el.parents(".page_scrollable").length)throw new Error("page_scrollable element not found");return this.$el.parents(".page_scrollable")},_show_tasks_list:function(){this.r_body.show(new a.MobileTasksList({collection:this.collection,empty_view_i18n_key:this.empty_view_i18n_key,always_display_time:this.always_display_time})),0===this.collection.length&&this.should_hide_when_empty?this.$el.hide():this.$el.show()},_get_scroll_event_name:function(){return"scroll.tasks_bucket_"+this.cid},_perform_initial_fetch:function(){this._should_fetch()&&this.collection.fetch()},_show_loading_state:function(){this.collection.is_fetching&&$f.mobile.is.connected()?this.r_body.show(new n.ComponentLoadingStateTableItem):this._show_tasks_list()},_show_error_state:function(){var e=this;this.r_body.show(new n.ComponentDownState),this.r_tasks_bucket_see_more.close(),this.listenToOnce(this.r_body.currentView,"downstate_retry",(function(){e.collection.fetch()}))},_show_hide_see_more_button:function(){this._should_show_see_more()?this.r_tasks_bucket_see_more.currentView||this.r_tasks_bucket_see_more.show(new E({collection:this.collection})):this.r_tasks_bucket_see_more.close()},_should_show_see_more:function(){return void 0!==this.collection.paginator.get("results_count")&&this.collection.length!==this.collection.paginator.get("results_count")&&this.collection.length>0},_get_results_count_display:function(){return this.collection.paginator.get("results_count")||""},_update_header_count:function(){this.show_count&&this.$el.find(".tasks_bucket_count").html(this._get_results_count_display())},toggle_task_bucket:function(){var e=!this.is_collapsed;return this.is_collapsed=e,$f.mobile.tasks.buckets_collapsed_states[this._get_collapsed_state_id()]=e,this.render(),!1},_get_collapsed_state_id:function(){return this.collection.get_cache_key()}}),D=Backbone.Marionette.Layout.extend({template:"#tpl_tasks_account_bucket",className:"tasks_account_bucket",model:o.mR,search_options:null,tasks_collection_class:null,task_bucket_collections:null,regions:{r_account_bucket_body:".r_account_bucket_body"},templateHelpers:function(){return{is_collapsed:$f.mobile.tasks.location_buckets_collapsed_states[this._get_collapsed_state_id()]}},events:{"click .account_bucket_header":"toggle_tasks_account_bucket"},initialize:function(e){e=e||{},$.extend(this,e)},onRender:function(){this._isShown&&this._on_show_render()},onShow:function(){this._on_show_render()},_on_show_render:function(){var e=this.model.id,t="account-".concat(e);this.task_bucket_collections[t]=this.task_bucket_collections[t]||{},this.r_account_bucket_body.show(new S({search_options:this.search_options,tasks_collection_class:this.tasks_collection_class,account_id:e,task_bucket_collections:this.task_bucket_collections[t]}))},toggle_tasks_account_bucket:function(){var e=$f.mobile.tasks.location_buckets_collapsed_states[this._get_collapsed_state_id()];return $f.mobile.tasks.location_buckets_collapsed_states[this._get_collapsed_state_id()]=!e,this.render(),!1},_get_collapsed_state_id:function(){var e=this.model.id;return e?"account_".concat(e):null}}),O=Backbone.Marionette.CollectionView.extend({collection:null,itemView:D,search_options:null,tasks_collection_class:null,task_bucket_collections:null,itemViewOptions:function(){return{search_options:this.search_options,tasks_collection_class:this.tasks_collection_class,task_bucket_collections:this.task_bucket_collections}},getEmptyView:function(){return d.G.extend({icon_class:"df-location",i18n_key_message:"mobile_empty_list_message_no_accounts"})},initialize:function(e){e=e||{},$.extend(this,e)}})},"./src/backbone-unorganized/utils/attachModulesToWindow.js":function(e,t,i){i.d(t,{Z:function(){return Z}});var n={};i.r(n),i.d(n,{getSSOCompanyInfo:function(){return j}});var s,o=i("../../../node_modules/@auth0/cordova/src/index.js"),a=i.n(o),r=i("../../../node_modules/@auth0/cordova/src/agent/index.js"),l=i.n(r),_=i("../../../node_modules/auth0-js/dist/auth0.min.esm.js"),c=i("../../../node_modules/linkify-html/dist/linkify-html.es.js"),u=i("../../../node_modules/decimal.js-light/decimal.js"),d=i("../../../node_modules/lodash/cloneDeep.js"),f=i.n(d),m=i("../../../node_modules/pako/index.js"),h=i.n(m),g=i("./src/backbone-unorganized/announcements/announcements.js"),p=i("./src/backbone-unorganized/dashboard/dashboard.js"),b=i("./src/backbone-unorganized/i18n-translations.js"),v=i("./src/backbone-unorganized/mobile.js"),w=i("./src/backbone-unorganized/sensors/sensors.js"),y=function(e,t,i,n){return new(i||(i=Promise))((function(s,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))},k=function(e,t){var i,n,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},T=function(e,t,i){if(i||2===arguments.length)for(var n,s=0,o=t.length;s<o;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},x="__zenput_storage_keys",E="zenput_keyvalues",S="sqlite",C=function(e){if(null==e?void 0:e.exception)throw e.exception},D=function(e){return function(){try{e.apply(this,arguments)}catch(e){throw console.error(e),$f.mobile.logging.capture_exception(e),e}}},O=((s={})["local-storage"]={clear:function(){return new Promise((function(e){localStorage.clear(),e()}))},get:function(e){var t=localStorage.getItem(e);return new Promise((function(e){try{return void e(JSON.parse(t))}catch(e){}e("undefined"!==t?t:void 0)}))},getKeys:function(){return new Promise((function(e){e(Object.keys(localStorage))}))},remove:function(e){return new Promise((function(t){localStorage.removeItem(e),t()}))},set:function(e,t){return new Promise((function(i,n){if(void 0!==t){try{t=JSON.stringify(t)}catch(e){}try{localStorage.setItem(e,t)}catch(e){return void n(e.message||"Failed to save to localStorage")}i()}else i()}))}},s["native-storage"]={clear:function(){return new Promise((function(e,t){var i=[];A.keys_cache=i,A.set(x,i,(function(){$f.mobile.cordova.NativeStorage.clear(e,t)}),t)}))},get:function(e){return new Promise((function(t,i){$f.mobile.cordova.NativeStorage.getItem(e,t,(function(e){2===(null==e?void 0:e.code)?t(null):i()}))}))},getKeys:function(){return new Promise((function(e){A.keys_cache?e(A.keys_cache):$f.mobile.cordova.NativeStorage.getItem(x,(function(t){void 0===t&&(t=[]),A.keys_cache=t,e(t)}),(function(){A.keys_cache=[],e(A.keys_cache)}))}))},remove:function(e){return new Promise((function(t,i){$f.mobile.cordova.NativeStorage.remove(e,(function(){return y(void 0,void 0,void 0,(function(){return k(this,(function(i){switch(i.label){case 0:return[4,(n=e,new Promise((function(e,t){A.get(x,(function(i){if(void 0===i&&(i=[]),i.length){var s=i.filter((function(e){return e===n}));i.length!==s.length?(A.keys_cache=s,A.set(x,s,e,t)):e()}else e()}),t)})))];case 1:return i.sent(),t(),[2]}var n}))}))}),i)}))},set:function(e,t){return new Promise((function(i,n){$f.mobile.cordova.NativeStorage.setItem(e,t,(function(){return y(void 0,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,(n=e,new Promise((function(e,t){A.keys((function(i){if(i.includes(n))e();else{var s=T(T([],i,!0),[n],!1);A.keys_cache=s,A.set(x,s,e,t)}}),t)})))];case 1:return t.sent(),i(),[2]}var n}))}))}),n)}))}},s.sqlite={clear:function(){return new Promise((function(e,t){A.sqlite_db.transaction((function(t){t.executeSql("DELETE FROM ".concat(E,";"),[],(function(t,i){e()}))}),(function(e){t(e)}))}))},get:function(e){return new Promise((function(t,i){A.sqlite_db.transaction((function(i){i.executeSql("SELECT value FROM ".concat(E," WHERE `key` = ?"),[e],(function(e,i){if(!i.rows.length||void 0===i.rows.item(0)||null===i.rows.item(0))return t(null);var n=i.rows.item(0).value;try{n=JSON.parse(n)}catch(e){}t(n)}))}),(function(e){i(e)}))}))},getKeys:function(){return new Promise((function(e,t){A.sqlite_db.transaction((function(t){t.executeSql("SELECT `key` FROM ".concat(E,";"),[],(function(t,i){for(var n=[],s=0;s<i.rows.length;s++)n.push(i.rows.item(s).key);e(n)}))}),(function(e){t(e)}))}))},remove:function(e){return new Promise((function(t,i){A.sqlite_db.transaction((function(i){i.executeSql("DELETE FROM ".concat(E," WHERE `key` = ?;"),[e],(function(e,i){t()}))}),(function(e){i()}))}))},set:function(e,t){return new Promise((function(i,n){A.sqlite_db.transaction((function(n){try{t=JSON.stringify(t)}catch(e){}n.executeSql("INSERT OR REPLACE INTO ".concat(E," (`key`, `value`) VALUES (?, ?);"),[e,t],(function(e,t){i()}))}),(function(e){n(e)}))}))}},s),R=function(){return $f.mobile.is.web()?"local-storage":$f.mobile.is.windows()?S:"native-storage"},M=function(){return O[R()]},A={keys_cache:null,sqlite_db:null,initialize:function(e){return void 0===e&&(e=function(){}),y(this,void 0,void 0,(function(){var t;return k(this,(function(i){switch(i.label){case 0:return R()!==S?[3,2]:(t=this,[4,(n=$f.mobile.cordova.sqlitePlugin.openDatabase({name:"zenput.db",location:"default"}),new Promise((function(e){n.transaction((function(t){t.executeSql("CREATE TABLE IF NOT EXISTS ".concat(E," (`key` VARCHAR(45) NOT NULL UNIQUE, `value` BLOB NULL);"),[],(function(t,i){e(n)}),(function(t){$f.mobile.log("Error initializing SQLite",t),e(n)}))}))})))]);case 1:t.sqlite_db=i.sent(),i.label=2;case 2:return e(),[2]}var n}))}))},set:function(e,t,i,n){void 0===i&&(i=function(){}),void 0===n&&(n=C),i=D(i),M().set(e,t).then(i).catch(n)},get:function(e,t,i){void 0===t&&(t=function(){}),void 0===i&&(i=C),t=D(t),M().get(e).then(t).catch(i)},remove:function(e,t,i){void 0===t&&(t=function(){}),void 0===i&&(i=C),t=D(t),M().remove(e).then(t).catch(i)},clear:function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=C),e=D(e),M().clear().then(e).catch(t)},keys:function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=function(){}),O[R()].getKeys().then(e).catch(t)}},N=A,I={config:{},build_options:function(e){return $f.mobile&&$f.mobile.is.native()?$.extend({},e,{scope:"offline_access openid profile email"}):$.extend({},e,{scope:"offline_access openid profile email",redirectUri:$f.utils.auth0.config.webapp_callback_url,responseType:"code"})},web_auth:function(e){return $f.mobile&&$f.mobile.is.native()?new window.Auth0Cordova({domain:$f.utils.auth0.config.domain,clientId:$f.utils.auth0.config.client_id,packageIdentifier:"zenput"}):new window.Auth0Desktop.WebAuth({domain:$f.utils.auth0.config.domain,clientID:$f.utils.auth0.config.client_id})},logout:function(){function e(){var e=null;e=$f.mobile&&$f.mobile.is.native()?$f.utils.auth0.config.native_logout_callback:$f.utils.auth0.config.webapp_logout_callback,$f.mobile&&$f.mobile.is.windows()&&(e="ms-appx-web://Zenput.Zenput/");var t={returnTo:e,federated:!0};$f.utils.auth0.web_auth().logout(t)}($f.mobile?$f.mobile.ajax:$.ajax)({url:"/logout_ajax/",type:"GET",success:e,error:e})},desktopAuthorize:function(e){return $f.utils.auth0.web_auth().authorize($f.utils.auth0.build_options(e))},nativeAuthorize:function(e){e.prompt="login";var t=function(e,t){if(!t||!t.accessToken||!t.refreshToken)return $f.mobile.logging.log_event("Mobile O-auth Login Failure",{user_agent:navigator.userAgent,response:e}),void($f.mobile.is.windows()?$f.mobile.redirect("zenput://logout"):location.reload());var i={access_token:t.accessToken,refresh_token:t.refreshToken};$f.mobile.ajax({url:"/auth0_callback/ajax_login/",dataType:"json",type:"POST",cache:!1,data:JSON.stringify(i),timeout:2e4,success:$f.mobile.login,error:function(e){if(e=e||{},$f.mobile.notifications.hide_loading_dialog(),$(".login").show(),$(".oauth-intermediary").hide(),"no-user-found"!=e.message)return $f.mobile.notifications.show_error_msg(_t("mobile_oauth_generic_error_message"));$(".oauth-login-error-sub-message").show(),$f.mobile.notifications.show_error_msg(_t("mobile_oauth_no_user_error_message"),!1,2e4)}})};$f.mobile.is.windows()?$f.utils.auth0.web_auth().authorizeWindows($f.utils.auth0.build_options(e),t):$f.utils.auth0.web_auth().authorize($f.utils.auth0.build_options(e),t)},authorize:function(e){return $f.mobile&&$f.mobile.is.native()?$f.utils.auth0.nativeAuthorize(e):$f.utils.auth0.desktopAuthorize(e)}},j=function(e,t){var i={email:e};($f.mobile?$f.mobile.ajax:$.ajax)({url:"/get_sso_company_info/",dataType:"json",type:"POST",cache:!1,data:JSON.stringify(i),timeout:2e4,success:t,error:t})},z=i("./src/backbone-unorganized/shared/deployment_flags/index.js"),P={FETCH_FREQUENCY_MS:200,KEYCODE_ENTER:13,COMMENT_MAX_LENGTH:2500,ALLOWED_KEYCODES:[8,35,36,37,38,39,40,46],COMMENTS_TAB_ID:"comments_tab",ANIMATION_SPEED:200,INCLUDE_TARGET_TYPES:{ANNOUNCEMENT:"announcement",SUBMISSION:"submission",TASK:"task"},fix_corrupted_mention_html:function(e){var t=this;e.find("span").each((function(i,n){var s=$(n),o=s.attr("data-check-text"),a=s.text();t._is_mention_html_valid(s)||(0!==a.indexOf(o)||o===a?o!==a&&s.remove():t._fix_mention_suffix_text(s,e))})),e.find("font").remove()},_is_mention_html_valid:function(e){if(e.text())return e.attr("data-check-text")===e.text()},_fix_mention_suffix_text:function(e,t){var i=e.attr("data-check-text"),n=e.text().split(i)[1];e.html(i),e.after(n),P.move_cursor_to_end_of_contenteditable(t)},move_cursor_to_end_of_contenteditable:function(e){var t=e.get(0),i=document.createRange(),n=window.getSelection(),s=t.childNodes[t.childNodes.length-1];i.setStart(s,s.length),i.collapse(!0),n.removeAllRanges(),n.addRange(i)},sanitize_comment_pasted_html:function(e){e.preventDefault();var t;t=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData.getData("text/plain"),document.execCommand(-1!==navigator.userAgent.indexOf("Trident")?"paste":"insertHTML",!1,t)}};P.rangeSelectionSaveRestore=function(){var e=void 0!==window.getSelection().extend;function t(e,t){return(t||document).getElementById(e)}function i(e){e.parentNode.removeChild(e)}function n(e){return"string"==typeof e?/^backward(?:s)?$/i.test(e):!!e}function s(t,i){if(e){var n=i.cloneRange();return n.collapse(!1),t.removeAllRanges(),t.addRange(n),t.extend(i.startContainer,i.startOffset),!0}return t.removeAllRanges(),t.addRange(i),!1}function o(e,t){var i,n="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),s=e.startContainer.ownerDocument,o=e.cloneRange();return o.collapse(t),(i=s.createElement("span")).id=n,i.style.lineHeight="0",i.style.display="none",i.textContent="\ufeff",o.insertNode(i),i}function a(e,n,s,o){var a=t(s,e);a?(n[o?"setStartBefore":"setEndBefore"](a),i(a)):console.warn("Marker element has been removed. Cannot restore selection.")}function r(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function l(e,t){var i,s=e.startContainer.ownerDocument,a=e.toString();return e.collapsed?{document:s,markerId:(i=o(e,!1)).id,collapsed:!0}:(i=o(e,!1),{document:s,startMarkerId:o(e,!0).id,endMarkerId:i.id,collapsed:!1,backward:n(t),toString:function(){return"original text: '"+a+"', new text: '"+e.toString()+"'"}})}function _(e){var n=e.document,s=n.createRange(n);if(e.collapsed){var o=t(e.markerId,n);if(o){o.style.display="inline";var r=o.previousSibling;r&&3==r.nodeType?(i(o),s.setStart(r,r.length),s.collapse(!0)):(s.setEndBefore(o),s.collapse(!1),i(o))}else console.warn("Marker element has been removed. Cannot restore selection.")}else a(n,s,e.startMarkerId,!0),a(n,s,e.endMarkerId,!1);return s}function c(e,i){(e=e.slice(0)).sort(r);for(var s,o,a=n(i),_=e.map((function(e){return l(e,a)})),c=e.length-1;c>=0;--c)o=(s=e[c]).startContainer.ownerDocument,s.collapsed?(s.setStartAfter(t(_[c].markerId,o)),s.collapse(!0)):(s.setEndBefore(t(_[c].endMarkerId,o)),s.setStartAfter(t(_[c].startMarkerId,o)));return _}function u(e){for(var t=[],i=e.length-1;i>=0;i--)t[i]=_(e[i]);return t}function d(e,n){var s=t(n,e);s&&i(s)}return{saveRange:l,restoreRange:_,saveRanges:c,restoreRanges:u,saveSelection:function(e){for(var t=(e=e||window).getSelection(),i=[],n=0;n<t.rangeCount;++n)i.push(t.getRangeAt(n));var o=1==i.length&&function(e){var t=!1;if(!e.isCollapsed){var i=document.createRange();i.setStart(e.anchorNode,e.anchorOffset),i.setEnd(e.focusNode,e.focusOffset),t=i.collapsed}return t}(t),a=c(i,o);return t.removeAllRanges(),o?s(t,i[0]):i.forEach((function(e){t.addRange(e)})),{win:e,rangeInfos:a,restored:!1}},restoreSelection:function(t,i){if(!t.restored){var n=t.rangeInfos,o=t.win.getSelection(),a=u(n),r=n.length;o.removeAllRanges(),1==r&&i&&e&&n[0].backward?s(o,a[0]):a.forEach((function(e){o.addRange(e)})),t.restored=!0}},removeMarkerElement:d,removeMarkers:function(e){e.rangeInfos.forEach((function(t){t.collapsed?d(e.doc,t.markerId):(d(e.doc,t.startMarkerId),d(e.doc,t.endMarkerId))}))}}}();var B=P,L=i("./src/backbone-unorganized/shared/forms.js"),q=i("./src/backbone-unorganized/shared/sensors/util.js"),F={utils:{is_single_account_submitter:function(){return $f.active_user.is_submitter()&&$f.mobile.dashboard.is_single_account_owner()}},buckets_collapsed_states:{},location_buckets_collapsed_states:{},initialize:function(){var e=this;$f.application.vent.on("nav:clear",(function(){e.reset_buckets_collapsed_states()}))},reset_buckets_collapsed_states:function(){this.buckets_collapsed_states={},this.location_buckets_collapsed_states={}},results_count_cache:{RESULTS_COUNT_CACHE_KEY:"results_counts_by_cache_keys",update_results_count:function(e,t,i){var n=this;$f.mobile.cache.get(this.RESULTS_COUNT_CACHE_KEY,(function(s){(s=s||{})[e]=t,$f.mobile.cache.set(n.RESULTS_COUNT_CACHE_KEY,s,i)}))},get_results_count:function(e,t){$f.mobile.cache.get(this.RESULTS_COUNT_CACHE_KEY,(function(i){t((i=i||{})[e])}))}}},U=i("./src/backbone-unorganized/utils/bluetooth.js"),H=i("./src/backbone-unorganized/utils/is.js"),Y=i("./src/backbone-unorganized/utils/localization.js"),Z=function(e){e.Auth0Desktop=_.default,e.Auth0Cordova=a(),e.pako=h(),e.linkifyHtml=c.Z,window.Decimal=u.Decimal,window.cloneDeep=f(),e.$f=L.ZP,e.$f.i18n=b.Z,e.$f.utils=L.Vl,e.$f.utils.formula=L.xY,e.$f.utils.recurring=L.YE,e.$f.utils.auth0=I,e.$f.utils.sso=n,e.$f.window=v.a,e.$f.mobile=v.Z,e.$f.flags=z.Z,e.$f.mobile.bluetooth=U.ZP,e.$f.mobile.is=H.Z,e.$f.mobile.localization=Y.Z,e.$f.mobile.dashboard=p.Z,e.$f.mobile.tasks=F,e.$f.mobile.sensors=w.ZP,e.$f.mobile.storage=N,e.$f.mobile.announcements=g.Z,e.$f.shared.comments.utils=B,e.$f.shared.sensors.util=q.Z,e.Auth0Cordova.prototype.logout=function(e){var t=this.client.buildLogoutUrl(e);l()((function(e,i){i.open(t,(function(e,t){e&&console.error("Error launching logoutURL modal",e),setTimeout(i.close,2e3)}))}))}}},"./src/backbone-unorganized/utils/barcodes.js":function(e,t,i){i.d(t,{Y:function(){return n}});var n=function(){return new Promise((function(e){$f.mobile.cordova.barcodeScanner.scan((function(t){var i=t.cancelled,n=t.format,s=t.text;i?e(null):($f.mobile.logging.log_event("Barcode scanned",{format:n}),e(s))}),(function(t){void 0===t&&(t={}),("string"==typeof t?t:t.message||"").toLowerCase().includes("access")?$f.mobile.notifications.show_permission_denied_msg(_t("mobile_common_camera")):($f.mobile.notifications.show_error_msg(),$f.mobile.logging.log_error("Barcode scanner failed",{error:t})),e(null)}),!0)}))}},"./src/backbone-unorganized/utils/bluetooth.js":function(e,t,i){i.d(t,{my:function(){return l},f4:function(){return c}});var n=i("./src/backbone/shared/models/BluetoothDeviceAPI.js"),s=i("./src/backbone-unorganized/shared/forms.js"),o=i("./src/backbone-unorganized/utils/is.js"),a=function(e,t,i,n){return new(i||(i=Promise))((function(s,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))},r=function(e,t){var i,n,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},l={ERROR_BLUETOOTH_DISABLED:1,ERROR_NO_PERMISSION:2,ERROR_INITIALIZE_BLUETOOTH:3,ERROR_SCAN_FAILURE:4,ERROR_SCAN_TIMEOUT:5,ERROR_MISSING_ACTIVE_ADDRESS:6,ERROR_FAILURE_TO_CONNECT:7,ERROR_DISCONNECTION_SUCCESSFUL:8,ERROR_FAILURE_TO_POLL:9,ERROR_FAILURE_TO_STOP_POLL:10,ERROR_PLATFORM_NOT_SUPPORTED:11,ERROR_PAIR_REQUEST_DENIED:12},c=function(e){var t,i=(0,o.d)()<12?_t("mobile_message_blue_therm_no_permission_android_pre_12"):_t("mobile_message_blue_therm_no_permission_android"),n=((t={})[l.ERROR_BLUETOOTH_DISABLED]=_t("mobile_message_blue_therm_error_bluetooth"),t[l.ERROR_SCAN_FAILURE]=_t("mobile_message_blue_therm_error_device"),t[l.ERROR_NO_PERMISSION]=s.ZP.mobile.is.android()?i:_t("mobile_message_blue_therm_error_bluetooth"),t),a="".concat(_t("mobile_message_blue_therm_error_code")," ").concat(_t("mobile_message_blue_therm_error_bluetooth"));return n[e]||a},u={SCAN_TIMEOUT_MS:15e3,ALLOWED_DEVICE_NAMES:{ThermaQ:"bluetherm_ble",ThermapenBlue:"bluetherm_ble","BlueTherm One":"bluetherm_ble",RayTemp:"bluetherm_ble",Blue2:"cooperatkins",TempAlert:"tempalert","104IR":"testo","TempTest Blue":"bluetherm_ble"},devices:null,device:null,api_by_type:{},callbacks:null,is_scanning:!1,is_connected:!1,is_connecting:!1,_scan_timeout_id:null,initialize:function(e){if(this.supports_bluetooth()){var t=this;this._callback_wrappers={on_pre_connect:function(){t.callbacks.on_pre_connect(arguments),s.ZP.application.vent.trigger("btdevice:connecting")},on_device_connected:function(){t.is_connected||(s.ZP.mobile.logging.log_event("Bluetooth Device Connected",{device:t.device.get("type")}),t.is_connected=!0,t.is_connecting=!1,s.ZP.application.vent.trigger("btdevice:connected"),t.callbacks.on_device_connected(arguments))},on_device_connection_failure:function(e){t.is_connecting&&(t.is_connecting=!1,t.callbacks.on_device_connection_failure(e),s.ZP.mobile.is.android()&&s.ZP.mobile.bluetooth.close(),s.ZP.application.vent.trigger("btdevice:disconnected"))},on_device_disconnected:function(){t.is_connected&&(t.is_connected=!1,t.is_connecting=!1,t.callbacks.on_device_disconnected(arguments),s.ZP.mobile.is.android()&&s.ZP.mobile.bluetooth.close(),s.ZP.application.vent.trigger("btdevice:disconnected"))},on_reading_received:function(e){t.callbacks.on_reading_received(arguments),s.ZP.application.vent.trigger("btdevice:new_reading",e)},on_button_pressed:function(e){t.callbacks.on_button_pressed(arguments),s.ZP.application.vent.trigger("btdevice:button_pressed",e)}},this.api_by_type={cooperatkins:new n.EX(this._callback_wrappers),bluetherm_ble:new n.Q8(this._callback_wrappers),tempalert:new n.pG(this._callback_wrappers),testo:new n.l4(this._callback_wrappers)},this.devices=new n.qf}},supports_bluetooth:function(){return!s.ZP.mobile.is.web()&&!s.ZP.mobile.is.windows()},register_callbacks:function(e){this.callbacks=e},unregister_callbacks:function(){this.callbacks={on_pre_connect:function(){},on_device_connected:function(){},on_device_connection_failure:function(e){},on_device_disconnected:function(){},on_reading_received:function(e){},on_button_pressed:function(e){}}},is_device_connected:function(e){this.device?this._get_device_api().is_device_connected(e):e(!1)},_register_device:function(e){return this.devices.findWhere({address:e.get("address")})||(this.devices.add(e),e)},_get_device_api:function(e){return(e=e||this.device)?this.api_by_type[e.get("type")]:null},_connect_to_device:function(e){this.device=e,this._get_device_api().connect(e.get("address"))},_scan_and_connect:function(){var e=this;this.start_scan({on_device_discovered:function(t){e.stop_scan((function(){e._connect_to_device(t)}))},on_timeout:function(){e.stop_scan((function(){e._callback_wrappers.on_device_connection_failure(),s.ZP.application.vent.trigger("btdevice:disconnected")}))},error:function(t){e.stop_scan((function(){e._callback_wrappers.on_device_connection_failure(t),s.ZP.application.vent.trigger("btdevice:disconnected")}))}})},connect:function(){this.is_connected||this.is_connecting||(this.is_connected=!1,this.is_connecting=!0,this.devices.selected_device?this._connect_to_device(this.devices.selected_device):this._scan_and_connect())},disconnect:function(){if(this.is_connecting&&this.is_scanning)return this.is_connecting=!1,s.ZP.application.vent.trigger("btdevice:disconnected"),void this.stop_scan();this.device&&(this._get_device_api().disconnect(),this.device=null)},close:function(){this.device&&(s.ZP.mobile.cordova.bluetoothle.close(null,null,{address:this.device.get("address")}),this.device=null)},enumerate_devices:function(){var e=this,t=[];this.start_scan({on_device_discovered:function(i){var n=e._register_device(i);-1===t.indexOf(n)&&(s.ZP.application.vent.trigger("btdevice:device_discovered",n),t.push(n))},on_timeout:function(){s.ZP.application.vent.trigger("btdevice:ble_scan_stopped"),e.is_scanning=!1},error:function(t){s.ZP.application.vent.trigger("btdevice:ble_scan_stopped"),e.is_scanning=!1,s.ZP.mobile.notifications.show_error_msg(c(t))}})},get_device_from_scan_response:function(e){var t=e.name;if(e.advertisement&&e.advertisement.localName&&(t=e.advertisement.localName),t){var i=null;if(_.each(this.ALLOWED_DEVICE_NAMES,(function(e,n){if(-1===t.toLowerCase().indexOf(n.toLowerCase()))return!0;i=e})),i)return new n.MC({name:t,address:e.address,type:i})}},start_scan:function(e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return e.on_device_discovered=e.on_device_discovered||function(){},e.error=e.error||function(){},[4,a(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return!s.ZP.mobile.is.android()||s.ZP.mobile.is.android_pre_marshmallow()?[2,!0]:(0,o.d)()<12?[4,new Promise((function(e){s.ZP.mobile.cordova.bluetoothle.hasPermission((function(t){e(Boolean(null==t?void 0:t.hasPermission))}))}))]:[3,4];case 1:return e.sent()?[3,3]:[4,new Promise((function(e){s.ZP.mobile.cordova.bluetoothle.requestPermission((function(t){e(Boolean(null==t?void 0:t.requestPermission))}),(function(){e(!1)}))}))];case 2:if(!e.sent())return[2,!1];e.label=3;case 3:return[2,!0];case 4:return[4,new Promise((function(e){s.ZP.mobile.cordova.bluetoothle.hasPermissionBtScan((function(t){e(Boolean(null==t?void 0:t.hasPermission))}))}))];case 5:return e.sent()?[3,7]:[4,new Promise((function(e){s.ZP.mobile.cordova.bluetoothle.requestPermissionBtScan((function(t){e(Boolean(null==t?void 0:t.requestPermission))}),(function(){e(!1)}))}))];case 6:if(!e.sent())return[2,!1];e.label=7;case 7:return[4,new Promise((function(e){s.ZP.mobile.cordova.bluetoothle.hasPermissionBtConnect((function(t){e(Boolean(null==t?void 0:t.hasPermission))}))}))];case 8:return e.sent()?[3,10]:[4,new Promise((function(e){s.ZP.mobile.cordova.bluetoothle.requestPermissionBtConnect((function(t){e(Boolean(null==t?void 0:t.requestPermission))}),(function(){e(!1)}))}))];case 9:if(!e.sent())return[2,!1];e.label=10;case 10:return[2,!0]}}))}))];case 1:return t.sent()?(s.ZP.application.vent.trigger("btdevice:ble_scan_started"),this.is_scanning=!0,this.is_scanning?(this.start_scan_ble(e),[2]):[2]):(e.error(l.ERROR_NO_PERMISSION),[2])}}))}))},preflight:function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=function(){});var i=!1;s.ZP.mobile.cordova.bluetoothle.initialize((function(){i||(i=!0,s.ZP.mobile.cordova.bluetoothle.isEnabled((function(i){if(!i.isEnabled)return t(l.ERROR_BLUETOOTH_DISABLED);e()})))}),{request:!0})},_clear_scan_timeout:function(){this._scan_timeout_id&&(clearTimeout(this._scan_timeout_id),this._scan_timeout_id=null)},start_scan_ble:function(e){(e=e||{}).error=e.error||function(){},e.on_timeout=e.on_timeout||function(){},e.on_device_discovered=e.on_device_discovered||function(){};var t=this;this.preflight((function(){var i=!0,n=!1;t._clear_scan_timeout(),t._scan_timeout_id=setTimeout((function(){i=!1,n||(e.on_timeout(),t.stop_scan((function(){n=!0})))}),t.SCAN_TIMEOUT_MS);var o=e.error;e.error=function(){n=!0,o.apply(this,arguments)},t.is_scanning=!0,s.ZP.application.vent.trigger("btdevice:connecting"),s.ZP.mobile.notifications.toast(_t("mobile_message_bluetooth_device_press_button_field")),s.ZP.mobile.cordova.bluetoothle.startScan((function(n){if(i&&"scanResult"===n.status){var s=t.get_device_from_scan_response(n);s&&e.on_device_discovered(s)}}),(function(i){if(t.is_scanning=!1,"enable"===i.error)return e.error(l.ERROR_BLUETOOTH_DISABLED);e.error(l.ERROR_SCAN_FAILURE)}),{services:[]})}),(function(t,i){e.error(t,i)}))},stop_scan:function(e){e=e||function(){};var t=this;this._clear_scan_timeout(),s.ZP.mobile.cordova.bluetoothle.stopScan((function(i){t.is_scanning=!1,s.ZP.application.vent.trigger("btdevice:ble_scan_stopped"),e()}),(function(i){t.is_scanning=!1,s.ZP.application.vent.trigger("btdevice:ble_scan_stopped"),e()}))},start_polling:function(e){this._get_device_api().start_polling(e)},stop_polling:function(){this._get_device_api().stop_polling()}};t.ZP=u},"./src/backbone-unorganized/utils/files/index.js":function(e,t,i){i.d(t,{a:function(){return c},Lk:function(){return r},yy:function(){return _}});var n=i("../../../node_modules/lodash.uniqueid/index.js"),s=i.n(n),o=function(e,t,i,n){return new(i||(i=Promise))((function(s,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))},a=function(e,t){var i,n,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},r=function(){return"".concat(Date.now(),"-").concat(s()())},l=function(e){return new Promise((function(t){$f.mobile.cordova.resolveLocalFileSystemURL(e,(function(e){t([null,e])}),(function(e){t([e,null])}))}))},_=function(e){return o(void 0,void 0,void 0,(function(){var t,i;return a(this,(function(n){switch(n.label){case 0:return $f.mobile.is.web()?[2,new Promise((function(e){e()}))]:[4,l("".concat($f.mobile.cordova.file.dataDirectory).concat(e))];case 1:return t=n.sent(),i=t[1],[2,new Promise((function(e){i?i.remove(e):e()}))]}}))}))},c=function(e,t){return o(void 0,void 0,void 0,(function(){var i,n,s,o,_,c,u,d;return a(this,(function(a){switch(a.label){case 0:return i=function(e,t){return!e.startsWith("content://")&&e.includes(".")?".".concat(e.split(".").pop()):t?".".concat(t.split("/").pop()):""}(e,t),n="".concat("zp-").concat(r()).concat(i),[4,l($f.mobile.cordova.file.dataDirectory)];case 1:return s=a.sent(),o=s[0],_=s[1],o?[2,new Promise((function(e){e([o,null])}))]:[4,l(e)];case 2:return c=a.sent(),u=c[0],d=c[1],u?[2,new Promise((function(e){e([u,null])}))]:[2,new Promise((function(e){d.copyTo(_,n,(function(t){e([null,t])}),(function(t){e([t,null])}))}))]}}))}))}},"./src/backbone-unorganized/utils/is.js":function(e,t,i){i.d(t,{d:function(){return n}});var n=function(){var e,t=null===(e=navigator.userAgent.toLowerCase().match(/android (\d+(\.\d{1,2})?)/))||void 0===e?void 0:e[1];return t?Number(t):null},s={login_from:null,native:function(){return!this.web()},_get_href:function(){return window.location.href},web:function(){var e=this._get_href();return-1===e.indexOf("index.html")&&-1===e.indexOf("zenput://")},portrait:function(){return $f.window.viewport.width<$f.window.viewport.height},landscape:function(){return!this.portrait()},large_screen:function(){return this.portrait()&&$f.window.viewport.width>700||this.landscape()&&$f.window.viewport.width>960},small_screen:function(){return!this.large_screen()},connected:function(){return this.web()?void 0===navigator.onLine||navigator.onLine:"none"!=$f.mobile.cordova.connection.type},ios:function(){if($f.mobile.debugging.get_flag("ua_ios"))return!0;if(void 0!==$f.mobile.cordova.device&&"iOS"==$f.mobile.cordova.device.platform)return!0;var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("iphone")||-1!=e.indexOf("ipad")||-1!=e.indexOf("ipod")},windows:function(){return navigator.userAgent.includes("Windows NT")},android:function(){return!!$f.mobile.debugging.get_flag("ua_android")||void 0!==$f.mobile.cordova.device&&"Android"==$f.mobile.cordova.device.platform||-1!=navigator.userAgent.toLowerCase().indexOf("android")},android_pre_marshmallow:function(){return!!navigator.userAgent.toLowerCase().match(/android [1-5]\./)},logged_in:function(e,t,i){$f.mobile.ajax({url:"/api/v1/users/is_logged_in/",dataType:"json",type:"GET",cache:!1,success:function(){$f.mobile.settings.update_last_login(),e()},error:function(){i?t():e()}})}};t.Z=s},"./src/backbone-unorganized/utils/localization.js":function(e,t){var i={DEFAULT_LOCALE:"en_US",get_locale:function(e){e=e||function(){},$f.mobile.settings.get("locale",(function(t){if($f.active_user.is_logged_in())e($f.active_user.get("userprofile__locale")||null);else{if(t)return e(t);if($f.mobile.is.web()||$f.mobile.is.native()){var n=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage;return e(i.map_to_supported_locale(n))}$f.mobile.cordova.globalization.getPreferredLanguage((function(t){return e(i.map_to_supported_locale(t.value))}),null)}}))},set_locale:function(e,t,i){if(i=i||function(){},void 0===t&&(t=!0),e=this.map_to_supported_locale(e),t&&this.set_framework_locales(e),!$f.active_user.is_logged_in())return $f.mobile.settings.set("locale",e,i);$f.active_user.set("userprofile__locale",e),i()},set_framework_locales:function(e){e&&(i18next.changeLanguage(e),moment.locale(e))},initialize:function(e){var t=this;i.get_locale((function(i){t.set_framework_locales(i),e(i)}))},map_to_supported_locale:function(e){if(!(e=(e=e||"").replace("-","_")))return this.DEFAULT_LOCALE;if(!_.contains($f.available_locales,e)){var t=this.locale_to_lang(e);return e=null,_.each($f.available_locales,(function(i){return 0!==i.indexOf(t)||(e=i,!1)})),e||this.DEFAULT_LOCALE}return e},map_to_supported_lang:function(e){return _.contains($f.available_locales,e)?this.locale_to_lang(e):"en"},locale_to_lang:function(e){return-1===e.indexOf("_")?e:e.split("_")[0]}};t.Z=i},"./src/backbone-unorganized/utils/logging/index.js":function(e,t,i){i.d(t,{I:function(){return o}});var n=i("./src/backbone-unorganized/utils/logging/zendesk.js"),s=[1,6,466,1444],o=function(){return e=void 0,t=void 0,o=function(){return function(e,t){var i,n,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}}(this,(function(e){switch(e.label){case 0:return $f.mobile.is.login_from||!$f.active_user.is_logged_in()?[2]:(t=$f.mobile.settings.get_release_details(),i={id:$f.active_user.id,email:$f.active_user.get("email"),company:$f.active_company.get("name")},$f.mobile.logging.get_sentry().configureScope((function(e){e.setTag("device",t.device),e.setTag("release_native",t.release_native),e.setTag("base_url",$f.base_url),e.setUser(i),e.addEventProcessor((function(e){return e.release=t.release_native,e}))})),["production","staging"].includes($f.deploy_env)&&(window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(i,n);for(var s=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},o=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],a=0;a<o.length;a++)heap[o[a]]=s(o[a])},window.heap.load($f.heap_app_id),function(e){e.identify($f.active_user.id),e.addUserProperties({email:$f.active_user.get("email"),company_id:$f.active_company.get("id"),Company:$f.active_company.get("name"),"User Name":$f.active_user.get_display_name(),"User Role":$f.active_user.get("role")});var t=$f.mobile.settings.get_release_details();e.addEventProperties({"Logged In":"true","App Version":t.release_native,"Device Model":t.device,"Platform Type":"".concat(t.platform_name," ").concat(t.platform_version),"Screen Width":$(window).outerWidth(),"Screen Height":$(window).outerHeight()})}(window.heap)),$f.flags.get_flag("fullstory_mobile")&&(s.includes($f.active_company.id)||function(e){var t,i,n,s,o,a,r,l;e._fs_debug=!1,e._fs_script="edge.fullstory.com/s/fs.js",e._fs_host="fullstory.com",e._fs_org="5SJPW",e._fs_namespace="FS",t=e,i=document,n=e._fs_namespace,s="script",o="user",n in t?t.console&&t.console.log&&t.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].'):((r=t[n]=function(e,t,i){r.q?r.q.push([e,t,i]):r._api(e,t,i)}).q=[],(a=i.createElement(s)).async=1,a.crossOrigin="anonymous",a.src="https://"+_fs_script,(l=i.getElementsByTagName(s)[0]).parentNode.insertBefore(a,l),r.identify=function(e,t,i){r(o,{uid:e},i),t&&r(o,t,i)},r.setUserVars=function(e,t){r(o,e,t)},r.event=function(e,t,i){r("event",{n:e,p:t},i)},r.anonymize=function(){r.identify(!1)},r.shutdown=function(){r("rec",!1)},r.restart=function(){r("rec",!0)},r.log=function(e,t){r("log",[e,t])},r.consent=function(e){r("consent",!arguments.length||e)},r.identifyAccount=function(e,t){a="account",(t=t||{}).acctId=e,r(a,t)},r.clearUserCookie=function(){},r.setVars=function(e,t){r("setVars",[e,t])},r._w={},l="XMLHttpRequest",r._w[l]=t[l],l="fetch",r._w[l]=t[l],t[l]&&(t[l]=function(){return r._w[l].apply(this,arguments)}),r._v="1.3.0"),FS.identify($f.active_user.id,{email:$f.active_user.get("email"),displayName:$f.active_user.get_display_name(),companyId_int:$f.active_company.id?$f.active_company.id:null,companyStatus_str:$f.active_company.get("status"),company_str:$f.active_company.get("name"),brand_str:$f.active_company.get("brand_name"),userName_str:$f.active_user.get_display_name(),userRole_str:$f.active_user.get("role")})}(window)),$f.flags.get_flag("pendo_mobile_analytics")&&["production","staging"].includes($f.deploy_env)&&!s.includes($f.active_company.id)&&function(e){!function(e,t,i,n,s){var o,a,r,l,_;for((s=e[n]=e[n]||{})._q=s._q||[],a=0,r=(o=["initialize","identify","updateOptions","pageLoad","track"]).length;a<r;++a)!function(e){s[e]=s[e]||function(){s._q[e===o[0]?"unshift":"push"]([e].concat([].slice.call(arguments,0)))}}(o[a]);(l=t.createElement(i)).async=!0,l.src="https://cdn.pendo.io/agent/static/5954d98f-89cc-4db4-6042-406200cd04eb/pendo.js",(_=t.getElementsByTagName(i)[0]).parentNode.insertBefore(l,_)}(window,document,"script","pendo");var t="submitter";$f.active_user.is_owner()?t="owner":$f.active_user.is_admin()?t="admin":$f.active_user.is_manager()&&(t="manager");var i=$f.mobile.settings.get_release_details();window.pendo.initialize({visitor:{id:$f.active_user.get("id"),email:$f.active_user.get("email"),full_name:$f.active_user.get_display_name(),role:t,app_version:i.release_native,device_model:i.device,platform_type:"".concat(i.platform_name," ").concat(i.platform_version),screen_width:$(window).outerWidth(),screen_height:$(window).outerHeight()},account:{id:$f.active_company.get("id"),name:$f.active_company.get("name")},location:{transforms:[{attr:"hostname",action:"Replace",data:$f.base_url.replace("https://","")}]}})}(),[4,(0,n.rr)()]);case 1:return e.sent(),[2]}var t,i}))},new((i=void 0)||(i=Promise))((function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((o=o.apply(e,t||[])).next())}));var e,t,i,o}},"./src/backbone-unorganized/utils/logging/zendesk.js":function(e,t,i){i.d(t,{rr:function(){return l},M:function(){return _}});var n=i("./src/backbone-unorganized/utils/is.js"),s=function(e,t){return new Promise((function(i){var n=new MutationObserver((function(e){e.forEach((function(e){Array.from(e.removedNodes).some((function(e){return e.id===t}))&&(n.disconnect(),i())}))}));n.observe(e,{subtree:!1,childList:!0})}))},o=function(e,t,i,n){return new(i||(i=Promise))((function(s,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))},a=function(e,t){var i,n,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},r="webWidget",l=function(){return o(void 0,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,o(void 0,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,(t="https://static.zdassets.com/ekr/snippet.js?key=".concat($f.zendesk_widget_key),i="ze-snippet",new Promise((function(e,n){var s=document.createElement("script");s.src=t,s.id=i,s.addEventListener("load",(function(){e()})),s.addEventListener("error",(function(){n()})),document.head.appendChild(s)})))];case 1:return e.sent(),[2]}var t,i}))}))];case 1:return e.sent(),[3,3];case 2:return e.sent(),[2];case 3:return window.zE?(window.zESettings={webWidget:{authenticate:{chat:{jwtFn:function(e){o(void 0,void 0,void 0,(function(){return a(this,(function(e){return[2,new Promise((function(e){$f.mobile.ajax({url:"/api/v3/users/current/zendesk_auth/",success:function(t){e(t.data.token)},error:function(){e("null")}})}))]}))})).then((function(t){e(t)}))}}}}},window.zE((function(){window.zE.hide(),window.zE.identify({name:$f.active_user.get("display_name"),email:$f.active_user.get("email"),organization:$f.active_company.get("name")})})),[2]):[2]}}))}))},_=function(){return o(void 0,void 0,void 0,(function(){var e,t;return a(this,(function(i){switch(i.label){case 0:return window.zE?[4,new Promise((function(e){return window.zE((function(){window.zE.activate(),e()}))}))]:($f.mobile.notifications.show_error_msg("mobile_common_chat_unavailable"),[2]);case 1:return i.sent(),n.Z.ios()&&n.Z.native()?(e=document.querySelector("iframe[data-product=web_widget]"),[4,(o=e.nextSibling,r,new Promise((function(e){var t=new MutationObserver((function(i){i.forEach((function(i){Array.from(i.addedNodes).some((function(e){return"webWidget"===e.id}))&&(t.disconnect(),e())}))}));t.observe(o,{subtree:!1,childList:!0})})))]):[3,4];case 2:return i.sent(),t=document.querySelector("iframe#".concat(r)),"0px"===getComputedStyle(t).top?($f.mobile.cordova.Keyboard.disableScroll(!1),[4,s(t.parentElement,r)]):[3,4];case 3:i.sent(),$f.mobile.cordova.Keyboard.disableScroll(!0),i.label=4;case 4:return[2]}var o}))}))}},"./src/backbone-unorganized/utils/setStatusBarColor.ts":function(e,t,i){i.d(t,{Q:function(){return s}});var n=i("./src/backbone-unorganized/utils/is.js"),s=function(e){void 0===e&&(e="#132d74"),n.Z.web()||n.Z.windows()||(n.Z.ios()?window.$(".fullscreen_filler").css("background-color",e):$f.mobile.cordova.StatusBar.backgroundColorByHexString(e))}},"./src/backbone-unorganized/utils/sso.js":function(e,t,i){i.d(t,{Q:function(){return n}});var n=function(e){return e.split("?token=")[1]}},"./src/backbone-unorganized/views.js":function(e,t,i){i.r(t),i.d(t,{AccountTypeahead:function(){return ue},AccountsView:function(){return pe},BaseTaskProjectFilter:function(){return Y},BaseToolbarNavList:function(){return U},DateDuePicker:function(){return ve},Debug:function(){return D},DeviceItem:function(){return G},Devices:function(){return K},DevicesList:function(){return W},FormDraftItem:function(){return j},FormDraftsPage:function(){return z},FormTemplateItem:function(){return N},FormTemplateTypeahead:function(){return me},FormTemplatesPage:function(){return I},GenerateBatchEstimateCount:function(){return he},LanguageSelector:function(){return O},LeftMenu:function(){return L},LoginForm:function(){return Te},MobileAppLayout:function(){return B},MobileProjectsList:function(){return te},MobileTasksList:function(){return H},MobileUserProfileSettings:function(){return R},NotificationSettings:function(){return M},NotificationSettingsItem:function(){return S},NotificationSettingsSet:function(){return A},OiaDialog:function(){return q},ProjectCreator:function(){return be},ProjectFilter:function(){return ee},ProjectItem:function(){return X},ProjectsView:function(){return ie},RolesMultiSelectModal:function(){return _e},SelectAccountOrGroupModal:function(){return ce},SelectDistributeGroupModal:function(){return le},SelectFormTemplateModal:function(){return ae},SelectTagModal:function(){return ne},SelectUserModal:function(){return se},SelectUsersModal:function(){return oe},Settings:function(){return C},StatusPage:function(){return Ee},TagTypeahead:function(){return de},TaskDetailsPage:function(){return ke},TaskFilter:function(){return Z},TaskInfo:function(){return $e},TaskItem:function(){return F},TaskReplyTypeTabs:function(){return we},TasksFilteredByProject:function(){return Q},TasksFilteredByProjectFilter:function(){return V},TasksLegendModal:function(){return xe},TasksPage:function(){return J},TeamMultiSelectModal:function(){return re},TransitionRegion:function(){return P},TriggeringImageFieldsList:function(){return ye},UserRoleSelect:function(){return ge},UsersTypeahead:function(){return fe}});var n=i("./src/backbone/features/mobileForm/BaseField/views.js"),s=i("./src/backbone/features/mobileForm/imageField/views.js"),o=i("./src/backbone/features/mobileForm/MobileFormStructure/models.js"),a=i("./src/backbone/shared/models/CommentsPageLayoutMixin.js"),r=i("./src/backbone/shared/views/EmptyListMessage.js"),l=i("./src/backbone/shared/views/baseLayoutViews.js"),c=i("./src/backbone/shared/views/MobileSearchBar.js"),u=i("./src/backbone/shared/views/SelectAccountModal.js"),d=i("./src/backbone/shared/views/tabs.js"),f=i("./src/backbone/shared/views/typeaheads.js"),m=i("./src/backbone-unorganized/models.js"),h=i("./src/backbone-unorganized/djangosaml2/index.js"),g=i("./src/backbone-unorganized/shared/forms.js"),p=i("./src/backbone-unorganized/tasks/models.js"),b=i("./src/backbone-unorganized/utils/localization.js"),v=function(e){return{comments:_t("mobile_tasks_tab_title_comments"),alerts:_t("mobile_settings_notifications_sub_category_alerts"),new_forms:_t("mobile_settings_notifications_sub_category_new_forms_available"),task_assigned:_t("mobile_settings_notifications_sub_category_task_assigned"),task_completed:_t("mobile_settings_notifications_sub_category_task_completed"),tasks_due_soon:_t("mobile_settings_notifications_sub_category_tasks_due_soon_reminder"),overdue_tasks:_t("mobile_settings_notifications_sub_category_overdue_tasks_reminder"),announcements:_t("mobile_left_menu_announcements"),sensor_alerts:_t("mobile_settings_notifications_sub_category_sensor_alerts"),critical_sensor_alerts:_t("mobile_settings_notifications_sub_category_critical_sensor_alerts")}[e]},w=i("./src/backbone/features/PrivacyPolicy/index.js"),y=i("../js/shared/sso.js"),k=i("./src/backbone-unorganized/utils/logging/zendesk.js"),T=i("./src/backbone-unorganized/utils/setStatusBarColor.ts"),x=function(e,t,i,n){return new(i||(i=Promise))((function(s,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))},E=function(e,t){var i,n,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},S=Backbone.Marionette.ItemView.extend({template:"#tpl_notification_settings_item",tagName:"li",className:"form-field",events:{"change select":"save_value"},initialize:function(){this.model.set("name",v(this.model.get("translation_id"))),S.__super__.initialize.apply(this,arguments)},templateHelpers:function(){return{push_notifications_enabled:this.model.collection.push_notifications_enabled,sms_notifications_enabled:this.model.collection.sms_notifications_enabled}},save_value:function(e){var t=$(e.target);this.model.set("delivery_type",t.val())}}),C=l.mp.extend({template:"#tpl_settings_list",toolbarnav_title:function(){return _t("mobile_toolbarnav_title_my_setttings")},is_top_level_page:!0,events:{"click #profile_settings":"click_profile","click #notification_settings":"click_notification","click #devices_settings":"click_devices_settings","click #privacy_policy":"click_privacy_policy","click #remote_debug":"remote_debug"},templateHelpers:function(){return{version_info:$f.mobile.get_version_string()}},initialize:function(){$f.application.vent.trigger("mobile:set_active_leftmenu_item","nav_settings")},click_profile:function(e){return $f.mobile.is.connected()?($f.mobile.nav.show(R,{use_transitions:!0}),!1):($f.mobile.notifications.show_offline_msg(),!1)},click_notification:function(e){return $f.mobile.is.connected()?($f.mobile.nav.show(M,{use_transitions:!0}),!1):($f.mobile.notifications.show_offline_msg(),!1)},click_devices_settings:function(e){return $f.mobile.nav.show(K,{use_transitions:!0}),!1},click_privacy_policy:function(e){return $f.mobile.nav.show(w.p,{use_transitions:!0}),!1},remote_debug:function(e){return $f.mobile.notifications.confirm('This feature helps Zenput Support troubleshoot problems you may be having with your Zenput app. Please contact Zenput Support before pressing "Continue."',(function(e){e&&$f.mobile.debugging.enable_weinre_remote_debug()}),null,_t("mobile_login_continue_button"),_t("mobile_action_sheet_cancel")),!1}}),D=l.mp.extend({template:"#tpl_debug",toolbarnav_title:function(){return"Debug"},is_top_level_page:!0,templateHelpers:function(){var e={disable_cache:"Disable Backbone Cache",disable_background_uploading:"Disable Background Uploading",fail_file_uploads:"Force File Upload Failures",disable_template_validation:"Disable Submission validation"};return $f.mobile.is.web()&&$.extend(e,{css_native:"Simulate native CSS",pending:"Allow pending uploads"}),{flags:e}},initialize:function(){$f.application.vent.trigger("mobile:set_active_leftmenu_item","nav_debug")},events:{"click .flags_list":"toggle_flag","click #disable_debug":"disable_debug"},toggle_flag:function(e){var t=$(e.target).data("flag"),i=$f.mobile.debugging.get_flag(t);return $f.mobile.debugging.set_flag(t,!i),this.render(),!1},disable_debug:function(){return $f.mobile.debugging.disable(),window.location.reload(),!1}}),O=Backbone.Marionette.ItemView.extend({template:"#tpl_language_selector",active_locale:b.Z.DEFAULT_LOCALE,auto_change:!0,triggers:{languange_change_noop:"language_selector:change_language"},events:{"change .saveonchange":"save_value"},templateHelpers:function(){return{active_locale:this.active_locale}},initialize:function(e){e=e||{},$.extend(this,e)},save_value:function(e){var t=this,i=$(e.target).val();return this.active_locale=i,this.auto_change&&$f.mobile.settings.set("locale",i,(function(){t.on_select(i),t._change_language(i)})),t.render(),!1},_change_language:function(e){var t=this;$f.mobile.localization.set_locale(e,!0,(function(){t.trigger("language_selector:change_language")}))},on_select:function(){console.error("Programmer Error: You must provide an on_select function upon initialization of LanguageSelector.")}}),R=l.IO.extend({template:"#tpl_profile_settings",toolbarnav_title:function(){return _t("mobile_toolbarnav_title_profile_settings")},model:null,regions:{r_language_selector:".language_selector"},events:{"click .action_button":"save_user","change input":"save_value"},initialize:function(e){e=e||{},$.extend(this,e);var t=this;this.model=new g.n5($f.active_user.toJSON()),Backbone.Validation.unbind(this),Backbone.Validation.bind(this),this.model.bind("validated:invalid",(function(e,t){$(".invalid").parents(".form-field").addClass("invalid")})),this.model.bind("validated:valid",(function(e,i){t.$el.find(".invalid").removeClass("invalid")}))},save_value:function(e){var t=$(e.target),i=t.val();return t.is(":checkbox")&&(i=!!t.is(":checked")),this.model.set(t.attr("name"),i),!1},save_user:function(e){e.preventDefault();var t=this;return $f.mobile.is.connected()?this.model.isValid(!0)?($f.mobile.notifications.show_loading_dialog(),this.model.set("userprofile__locale",this.r_language_selector.currentView.active_locale),t._change_language((function(){t.model.save({},{success:function(e){$f.active_user.set(t.model.toJSON()),$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_success_msg(_t("mobile_message_settings_success_saved"))},error:function(e,i){$f.mobile.notifications.hide_loading_dialog(),i&&i.results?i.results.every((function(e){return $f.mobile.notifications.show_error_msg(e.message),Backbone.Validation.callbacks.invalid(self,e.name,e.message,"name"),t.model.trigger("validated:invalid"),!1})):$f.mobile.notifications.show_error_msg(i?i.message:_t("mobile_message_settings_error_saved"))}})})),!1):($f.mobile.notifications.show_error_msg(_t("mobile_message_profile_settings_error_fields")),!1):($f.mobile.notifications.show_offline_msg(),!1)},_change_language:function(e){e=e||function(){};var t=this;$f.mobile.localization.set_locale(this.model.get_locale(),!0,(function(){t.render(),$f.application.content.currentView.r_leftmenu.currentView.render(),e()}))},onRender:function(){var e=this;this.r_language_selector.show(new O({active_locale:e.model.get_locale(),on_select:function(t){e.model.set("userprofile__locale",t)},auto_change:!1}))},onBeforeClose:function(){Backbone.Validation.unbind(this),this.model.unbind("validated:valid")}}),M=l.IO.extend({template:"#tpl_notification_settings",collection:g.bL,allow_reverse_transitions:!0,regions:{r_notification_communication:".r_notification_communication",r_notification_settings_forms_and_triggers:".r_notification_settings_forms_and_triggers",r_notification_settings_tasks:".r_notification_settings_tasks"},getEmptyView:function(){return r.G.extend({i18n_key_message:"mobile_message_show_error_message",icon_class:"df-alert"})},className:"form_container",toolbarnav_title:function(){return _t("mobile_toolbarnav_title_notification")},events:{"click .action_button":"save_settings","change input":"save_value"},initialize:function(e){var t=this;e=e||{},$.extend(this,e),$f.mobile.notifications.show_loading_dialog(),this.collection=new g.bL,this.collection.fetch({timeout:1e4,success:function(){$f.mobile.notifications.hide_loading_dialog(),t._show_notifications_settings()},error:function(){$f.mobile.notifications.hide_loading_dialog()}})},_get_collection_by_category:function(e){var t=this.collection.where({category:e});return new g.bL(t)},_show_notifications_settings:function(){this.r_notification_communication.show(new A({collection:this._get_collection_by_category("communication")})),this.r_notification_settings_forms_and_triggers.show(new A({collection:this._get_collection_by_category("forms_and_triggers")})),this.r_notification_settings_tasks.show(new A({collection:this._get_collection_by_category("tasks")}))},save_settings:function(e){return e.preventDefault(),$f.mobile.is.connected()||$f.mobile.notifications.show_offline_msg(),$f.mobile.notifications.show_loading_dialog(),this.collection.save({success:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_success_msg(_t("mobile_message_settings_success_saved"))},error:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.is.connected()?$f.mobile.notifications.show_error_msg(_t("mobile_message_settings_error_saved")):$f.mobile.notifications.show_offline_msg()}}),!1}}),A=Backbone.Marionette.CollectionView.extend({collection:g.bL,itemView:S,allow_reverse_transitions:!0,tagName:"ul",className:"form_container card"}),N=Backbone.Marionette.ItemView.extend({template:"#tpl_form_template_item",tagName:"li",events:{"click .navlink":"click_navlink"},click_navlink:function(e){return $f.mobile.load_collection(this.model.get("id"),null,!0),!1}}),I=l.mp.extend({template:"#tpl_form_templates_list",itemView:N,allow_reverse_transitions:!0,is_top_level_page:!0,_is_loading:!0,getEmptyView:function(){return this._is_loading?null:r.G},itemViewContainer:"ul.pagelist",className:"form_template_list",toolbarnav_title:function(){return _t("mobile_left_menu_my_forms")},initialize:function(e){this.collection=$f.mobile.form_templates,e=e||{},$.extend(this,e),this._show_loader(),$f.mobile.form_templates.get_user_templates(this._on_template_load_success.bind(this)),$f.application.vent.trigger("mobile:set_active_leftmenu_item","nav_form_templates")},on_resume:function(){this._show_loader(),$f.mobile.form_templates.get_user_templates(this._on_template_load_success.bind(this))},_show_loader:function(){$f.mobile.form_templates.isEmpty()&&$f.mobile.notifications.show_loading_dialog()},_on_template_load_success:function(){this._is_loading=!1,$f.mobile.notifications.hide_loading_dialog(),this.render()}}),j=Backbone.Marionette.ItemView.extend({template:"#tpl_form_draft_item",tagName:"li",form_template:null,events:{"click .delete_draft":"delete_draft","click a":"load_draft"},templateHelpers:function(){var e=moment(this.model.get("date_modified"));return{date:e.format("ddd, MMM D"),time:e.format("h:mm a"),account_name:this.model.get("account_name")}},load_draft:function(e){var t=this;return $f.mobile.notifications.show_loading_dialog(),$f.mobile.form_drafts.get_record(this.model.id,null,(function(e){if(!e)return $f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg(),void $f.mobile.logging.log_error("Unable to retrieve draft from disk",{draft_id:t.model.id});$f.mobile.show_collection(e,{animate:!0})})),!1},delete_draft:function(e){var t=this;return $f.mobile.is.connected()?($f.mobile.notifications.confirm(_t("mobile_message_drafts_form_confirm"),(function(e){e&&$f.application.vent.trigger("mobile:delete_draft",t.model.get("id"))}),_t("mobile_message_drafts_confirm_delete"),_t("mobile_common_button_yes"),_t("mobile_common_button_no")),!1):($f.mobile.notifications.show_offline_msg(),!1)}}),z=l.mp.extend({template:"#tpl_form_drafts_list",itemView:j,itemViewContainer:"ul.pagelist",className:"form_template_list drafts_list",collection:null,toolbarnav_title:function(){return _t("mobile_left_menu_drafts")},is_editing:!1,allow_reverse_transitions:!0,is_top_level_page:!0,toolbarnav_show_add_task:!1,events:{"click .edit_drafts":"edit_drafts"},initialize:function(e){e=e||{},$.extend(this,e);var t=this;$f.mobile.form_drafts.get_user_drafts(),this.collection=$f.mobile.form_drafts,this.collection.sort(),this.listenTo($f.application.vent,"mobile:delete_draft",(function(e){t.delete_draft(e)})),$f.application.vent.trigger("mobile:set_active_leftmenu_item","nav_drafts")},getEmptyView:function(){return r.G.extend({i18n_key_message:"mobile_drafts_message",icon_class:"df-drafts"})},on_toolbarnav_init:function(){$f.mobile.form_drafts.draft_count&&0!==$f.mobile.form_drafts.draft_count&&this.toolbarnav.add_actions([{container_class:"edit_drafts",icon_class:"df-edit",i18n_key_text:"mobile_drafts_form_text",display:"icon"}])},edit_drafts:function(e){var t=this;this.is_editing?(this.is_editing=!1,t.$el.find(".pagelist").removeClass("editing"),this.$el.find(".edit_drafts i").velocity({opacity:0},"fast",(function(){t.$el.find(".edit_drafts i").removeClass("df-success").addClass("df-edit"),t.$el.find(".datetime, .edit_drafts i").velocity({opacity:1},"fast")}))):(this.is_editing=!0,t.$el.find(".pagelist").addClass("editing"),this.$el.find(".datetime, .edit_drafts i").velocity({opacity:0},"fast",(function(){t.$el.find(".edit_drafts i").removeClass("df-edit").addClass("df-success"),t.$el.find(".edit_drafts i").velocity({opacity:1},"fast")})))},delete_draft:function(e){!0===$f.mobile.form_drafts.get(e).get("is_synced")&&$f.mobile.form_drafts.get_record(e,null,(function(e){e.delete()})),this.collection.remove_records(e),0==this.collection.length&&this.render()}}),P=Backbone.Marionette.Region.extend({currently_replacing_view:!1,ANIMATION_TIME_MS:250,_old_view:null,show:function(e,t){var i=this,n=(t=t||{}).is_historic_view&&e.allow_reverse_transitions,s=t.disable_transition;if(e.is_historic_view=t.is_historic_view,s||!e.use_transitions&&!n||1==$f.mobile.nav._views.length&&!e.is_historic_view)return P.__super__.show.call(this,e);this.$el.after("<".concat($(".main_content").prop("tagName").toLowerCase(),' class="').concat($(".main_content").attr("class")||"",'" style="').concat($(".main_content").attr("style")||"",'"></').concat($(".main_content").prop("tagName").toLowerCase(),">")),this.$el.addClass("stale"),this.$el=this.$el.siblings(".main_content:not(.stale)"),this.el=this.$el.get(0);var o=this.$el,a=this.$el.siblings(".main_content.stale"),r=n?a:o,l=n?"0%":"100%",_=n?"100%":"0%";o.css("opacity",0),i.currently_replacing_view=!0,P.__super__.show.call(i,e),$.Velocity.hook(r,"z-index",99999),$.Velocity.hook(r,"translateX",l),$(".page_transition_touchblock").show(),r.velocity({translateX:_},{duration:i.ANIMATION_TIME_MS,easing:n?"easeInCirc":"easeOutCirc",begin:function(){o.css("opacity",1)},complete:function(){o.css("z-index",""),i._close_old_view(),a.remove(),$(".page_transition_touchblock").hide()}})},close:function(){if(!this.currently_replacing_view)return P.__super__.close.apply(this,arguments);this._old_this=jQuery.extend(!0,{},this)},_close_old_view:function(){this._old_this&&(P.__super__.close.apply(this._old_this,arguments),this.currently_replacing_view=!1,this._old_this=null)}}),B=Backbone.Marionette.Layout.extend({template:"#tpl_mobile_app_layout",initial_page_options:{is_top_level_page:!0},_initial_page_class:null,get_initial_page_class:function(e){return this._initial_page_class||$f.mobile.default_start_page_class},regions:{r_leftmenu:"#leftmenu",r_main_content:{selector:".main_content",regionType:P}},initialize:function(e){e=e||{},$f.mobile.nav.clear(),e.initial_page_data&&e.initial_page_data.klass&&(this._initial_page_class=e.initial_page_data.klass,delete e.initial_page_data.klass,this.initial_page_options=e.initial_page_data)},onShow:function(){(0,T.Q)(),$("body").removeClass("snapjs-left"),this.r_leftmenu.show(new L),$f.mobile.nav.show(this.get_initial_page_class(),this.initial_page_options)}}),L=Backbone.Marionette.ItemView.extend({template:"#tpl_leftmenu",show_nav_locations:!0,_temporary_drawer_close_callback:null,snapper:null,events:{"click .upload_background":"click_upload_background","click .logout":"logout","click .show_oia_modal":"show_oia_modal","click .nav_notifications":"show_notifications","click .nav_form_templates":"show_form_templates","click .nav_announcements":"show_announcements","click .nav_dashboard":"show_dashboard","click .nav_settings":"show_settings","click .nav_drafts":"show_drafts","click .nav_history":"show_history","click .nav_locations":"show_accounts","click .nav_tasks":"show_tasks","click .nav_projects":"show_projects","click .nav_debug":"show_debug","click .zenput_docs":"show_zenput_docs","click .zenput_support":"show_zenput_support"},templateHelpers:function(){return{draft_count:$f.mobile.form_drafts.draft_count,unread_notifications_count:$f.mobile.unread_notifications_count.get("count"),show_nav_locations:this.show_nav_locations}},initialize:function(e){var t=this;e=e||{},$.extend(this,e),this.listenTo($f.application.vent,"mobile:close_leftmenu",(function(){t.close_drawer()})),this.listenTo($f.application.vent,"mobile:toggle_leftmenu",(function(){t.toggle()})),this.listenTo($f.application.vent,"mobile:set_num_uploads",t.show_num_uploading),this.listenTo($f.mobile.form_drafts,"add remove",t.render),$f.mobile.uploads.for_each_pending_upload_structure((function(e){t.listenTo(e,"add remove",t.render)})),$f.mobile.unread_notifications_count.on("change",t.render),$f.mobile.form_drafts.get_user_draft_count(t.render)},onBeforeRender:function(){this.$el.find(".selected").length>0&&(this._selected_navlink_classname=this.$el.find(".selected").prop("class"),this._selected_navlink_classname=this._selected_navlink_classname.replace("selected",""))},onRender:function(){var e=this;this._selected_navlink_classname&&($(this.$el.get(0).getElementsByClassName(this._selected_navlink_classname)).addClass("selected"),this._selected_navlink_classname=null),this.listenTo($f.application.vent,"mobile:set_active_leftmenu_item",(function(t){e.$el.find(".selected").removeClass("selected"),e.$el.find("."+t).addClass("selected")}))},onShow:function(){this.snapper?this.snapper.enable():this._setup_snapper()},_setup_snapper:function(){var e=this;this.snapper=new Snap({element:$("#pagebody").get(0),dragger:$("#leftmenu_dragger").get(0),disable:"right",touchToDrag:$f.mobile.is.android()||$f.mobile.is.ios()||$f.mobile.is.windows(),tapToClose:!1,slideIntent:80}),this.snapper.on("animated",(function(t){e.is_open()?e.on_drawer_open():e.on_drawer_closed()})),$("#pagebody .leftmenu_open_pagebody_blocker").off("click.ie_close_drawer"),$("#pagebody .leftmenu_open_pagebody_blocker").on("click.ie_close_drawer",(function(){e.close_drawer()}))},on_drawer_open:function(){},on_drawer_closed:function(){this._temporary_drawer_close_callback&&this._temporary_drawer_close_callback(),this._temporary_drawer_close_callback=null},show_num_uploading:function(){var e=$f.mobile.uploads.get_num_pending_submission_uploads(!0);e>0?$(".upload_background").addClass("error").show().find(".count").html(e):$(".upload_background").removeClass("error").hide()},is_open:function(){try{return"left"==this.snapper.state().state}catch(e){return!1}},open_drawer:function(){$f.mobile.unread_notifications_count.fetch(),this.snapper.open("left")},close_drawer:function(){this.snapper.close("left")},toggle:function(){this.is_open()?this.close_drawer():this.open_drawer()},click_upload_background:function(e){return this.close_drawer(),this._temporary_drawer_close_callback=function(){if(!$f.mobile.is.connected())return $f.mobile.notifications.show_offline_msg(),void $f.application.vent.trigger("mobile:set_num_uploads");$f.mobile.uploads.start_upload()},!1},logout:function(e){var t=_t("mobile_common_logout_message"),i=$f.mobile.form_drafts.where({is_synced:!1}).length;return i>0&&(t+="\n\n"+_t("mobile_message_log_out_confirm_unsynced_drafts",{count:i})),$f.mobile.notifications.confirm(t,(function(e){e&&$f.mobile.logout()}),_t("mobile_common_logout_message")),!1},show_oia_modal:function(){return $f.mobile.nav.clear(),$f.mobile.nav.show_modal(q,{}),!1},_show_page:function(e,t){return t=t||{},$f.mobile.nav.clear(),this.close_drawer(),$f.mobile.nav.show(e,t),!1},show_notifications:function(){var e=this;Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/comments/views.js")).then((function(t){e._show_page(t.NotificationsPage,{})}))},show_dashboard:function(){var e=this;return Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/dashboard/views.js")).then((function(t){e._show_page(t.MobileDashboard,{is_top_level_page:!0})})),!1},show_form_templates:function(){return this._show_page(I),!1},show_announcements:function(){var e=this;return i.e(511).then(i.bind(i,"./src/backbone-unorganized/announcements/views.js")).then((function(t){e._show_page(t.AnnouncementsPage)})),!1},show_settings:function(){return this._show_page(C),!1},show_debug:function(){return this._show_page(D),!1},show_drafts:function(){return this._show_page(z),!1},show_history:function(e){var t=this;return Promise.resolve().then(i.bind(i,"./src/backbone/features/mobileForm/views.jsx")).then((function(e){t._show_page(e.AllSubmissionsHistoryList)})),!1},show_accounts:function(e){return this._show_page(pe),!1},show_tasks:function(e){return this._show_page(J),!1},show_projects:function(e){return this._show_page(ie),!1},show_zenput_docs:function(e){return $f.mobile.open_uri("https://support.zenput.com/"),!1},show_zenput_support:function(e){return this.close_drawer(),(0,k.M)(),!1},onBeforeClose:function(){$f.application.vent.off("mobile:close_leftmenu"),$f.application.vent.off("mobile:toggle_leftmenu"),$f.application.vent.off("mobile:set_num_uploads"),$("#pagebody .leftmenu_open_pagebody_blocker").off("click.ie_close_drawer")},hide_account_link:function(){this.show_nav_locations=!1,this.$el.find(".nav_locations").hide()}}),q=Backbone.Marionette.Layout.extend({template:"#tpl_oia_dialog",on_dismiss_for_web:function(){this.close()},events:{"click #oia_btn":"open_app","click #download_app_btn":"download_app","click #oiw_btn":"open_web"},initialize:function(e){e=e||{},$.extend(this,e)},onShow:function(){$f.application.vent.trigger("mobile:close_leftmenu")},open_app:function(e){return location.href="zenput://"+window.location.hash.replace("#",""),!1},download_app:function(e){return $f.mobile.version.download_app(),!1},open_web:function(e){var t=this;return $f.mobile.settings.set("oia",(new Date).getTime(),(function(){t.on_dismiss_for_web()})),!1}}),F=Backbone.Marionette.ItemView.extend({template:"#tpl_task_item",model:null,tagName:"li",toolbarnav_title:null,always_display_time:!1,initialize:function(e){e=e||{},$.extend(this,e)},templateHelpers:function(){var e=!(!this.model.get("source").get("rule")||!this.model.get("source").get("rule").id),t="closed"===this.model.collection.paginator.get("status"),i=_.contains(["complete","complete_with_exception"],this.model.get("current_state"))&&!t,n=this.model.get_current_state_string(),s=this.model.get_date_start(),o=this.get_day_str(s),a=this.get_time_str(s),r=this.model.get_date_due(),l=this.get_day_str(r),c=this.get_time_str(r);return{current_state:n,date_due_by:r?_t("mobile_tasks_bucket_due_by_at",{date:l,time:c}):null,date_start:_t("mobile_tasks_bucket_open_at",{date:o,time:a}),is_complete_with_exceptions:"complete_with_exception"===this.model.get("current_state"),is_followup:e,is_overdue:"overdue"===this.model.get("current_state"),location_name:this.model.get("account")?this.model.get("account").get("name"):null,should_show_location:!$f.mobile.tasks.utils.is_single_account_submitter(),show_strikeout:i,state_icon:$f.mobile.get_state_icon_for_task(this.model.get("current_state"))}},events:{"click .navlink":"show_task"},show_task:function(e){return $f.mobile.nav.show(ke,{model:this.model,toolbarnav_title:this.toolbarnav_title}),!1},get_time_zone_code:function(){var e=this.model.get_date_due();return e?e.format("z"):""},get_day_str:function(e){var t=moment(e);return t.isSame(moment(),"day")?_t("mobile_tasks_toolbarnav_header_today"):t.format("MMM DD")},get_time_str:function(e){return moment(e).format("h:mm a z")}}),U=Backbone.Marionette.CollectionView.extend({tagName:"ul",className:null,should_show_section_legend_buttons:!1,_last_fetch_timestamp:0,constructor:function(){U.__super__.constructor.apply(this,arguments),this.$el.addClass("pagelist")},initialize:function(e){e=e||{},$.extend(this,e)},onShow:function(){this._setup_infinite_scroll()},_show_loading_spinner:function(){this.$el.parent().siblings(".infinite_scroll_loading").css("visibility","visible")},_remove_loading_spinner:function(){this.$el.parent().siblings(".infinite_scroll_loading").css("visibility","hidden")},perform_scroll_fetch:function(){var e=this,t=this;this._show_loading_spinner(),Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/local_records.js")).then((function(i){e.collection.fetch({force:e.collection instanceof i.LocalRecords,success:function(){t._remove_loading_spinner()},error:function(){t._remove_loading_spinner()},remove:!1})}))},_setup_infinite_scroll:function(){var e=this,t=this.$el.parents(".page_scrollable");setTimeout((function(){t.scrollTop(0),t.off("scroll"),t.on("scroll",(function(){if(!(t.scrollTop()<t.get(0).scrollHeight-t.height()-100)&&!(e._last_fetch_timestamp+1e3>(new Date).getTime())&&(e._last_fetch_timestamp=(new Date).getTime(),$f.mobile.is.connected())){var i=e.collection.paginator;e.collection.paginator?(i.set("start",i.get("start")+i.get("limit")),e.perform_scroll_fetch()):$f.mobile.logging.log_error("Attempting to use infinite scroll with collection that does not have a paginator")}}))}),100)}}),H=Backbone.Marionette.CollectionView.extend({tagName:"ul",className:"tasks_list pagelist",collection:null,itemView:F,toolbarnav_title:null,zenput_code:null,allow_retry:!1,empty_view_i18n_key:null,always_display_time:!1,attributes:{"data-cy":"tasks-list"},itemViewOptions:function(){return{toolbarnav_title:this.toolbarnav_title,always_display_time:this.always_display_time}},initialize:function(e){e=e||{},$.extend(this,e),H.__super__.initialize.apply(this,arguments),this.collection=this.collection||new p.jR,this.empty_view_i18n_key=this.empty_view_i18n_key||"mobile_empty_list_message_no_tasks"},onRender:function(){var e=this;this.children.first()instanceof r.G&&this.listenTo(this.children.first(),"empty_view:retry_fetch",(function(){e.trigger("empty_view:retry_fetch")}))},getEmptyView:function(){return r.G.extend({icon_class:"df-success",i18n_key_message:this.empty_view_i18n_key,zenput_codes:this.zenput_code,allow_retry:this.allow_retry})}}),Y=l.IO.extend({template:null,collection:null,toolbarnav_title:null,use_transitions:!0,className:null,toolbarnav_show_add_task:!1,toolbarnav_center_title:!0,_last_known_scrollpos:0,events:{"click .pagelist a:not(.team_filter, .account_filter)":"update_search_option","click .pagelist .team_filter":"show_team_selector_modal","click .pagelist .clear_team_filter":"clear_team_filter","click .apply_filters":"go_back"},initialize:function(e){this.allowed_filters=this.allowed_filters||{},e=e||{},$.extend(this,e)},onBeforeRender:function(){this._isShown&&(this._last_known_scrollpos=this.$el.find(".page_scrollable").scrollTop())},onRender:function(){var e=this;"me"==this.collection.findWhere({field:"filter"}).get("value")?this.hide_team_filter():this.show_team_filter(),e._isShown&&setTimeout((function(){e.$el.find(".page_scrollable").scrollTop(e._last_known_scrollpos)}),1)},hide_team_filter:function(){this.$el.find(".team_filter, .toggle_buttons .clear_team_filter").addClass("disabled")},show_team_filter:function(){this.$el.find(".team_filter, .toggle_buttons .clear_team_filter").removeClass("disabled")},clear_team_filter:function(){return this.collection.findWhere({field:"group_id"}).set({display_value:"",value:null}),this.render(),!1},go_back:function(){var e=this,t=arguments;return this.collection.save_local((function(){e.collection.trigger("filters_updated"),$f.mobile.tasks.reset_buckets_collapsed_states(),e.is_modal?e.close():Y.__super__.go_back.apply(e,t)})),!1},update_search_option:function(e){var t=$(e.target);if(t.is("a")||(t=t.parents("a")),t.hasClass("disabled"))return!1;!t.hasClass("filter_button")&&t.parents(".filter_button").length>0&&(t=t.parents(".filter_button"));var i=t.data("field"),n=t.attr("value");n&&"is_active"===i&&(n=JSON.parse(t.attr("value"))),this.collection.findWhere({field:i}).set({value:n});var s=this.collection.findWhere({field:"filter"});return this.allowed_filters.ownership?"me"==s.get("value")?(this.allowed_filters.creator=!1,this.allowed_filters.assignee=!0,this.hide_team_filter()):"by_me"==s.get("value")?(this.allowed_filters.creator=!0,this.allowed_filters.assignee=!1,this.hide_team_filter()):(this.allowed_filters.creator=!0,this.allowed_filters.assignee=!0,this.show_team_filter()):this.show_team_filter(),this.render(),!1},_reshow_modal:function(){this.isClosed?$f.mobile.nav.show_modal(this.constructor,this.options):this.render()},show_team_selector_modal:function(e){var t=this;return $(e.target).hasClass("disabled")||$f.mobile.nav.show_modal(le,{post_on_select:function(e){t.collection.findWhere({field:"group_id"}).set({value:e.get("id"),display_value:e.get("name")}),t._reshow_modal()},on_clear:function(){t.clear_team_filter()}}),!1}}),Z=Y.extend({template:"#tpl_task_filter",toolbarnav_title:function(){return _t("mobile_toolbarnav_title_filter_tasks")},className:"task_filter_page",allowed_filters:null,templateHelpers:function(){var e=this.collection.findWhere({field:"group_id"}),t=this.collection.findWhere({field:"account_id"}),i=this.collection.findWhere({field:"status"}),n=this.collection.findWhere({field:"filter"}),s=this.collection.findWhere({field:"order_by"}),o=this.collection.findWhere({field:"group_by"}),a=this.collection.findWhere({field:"search_query"}).get("value");if(this.allowed_filters&&this.allowed_filters.ownership&&("me"==n.get("value")?this.allowed_filters.creator=!1:"by_me"==n.get("value")&&(this.allowed_filters.assignee=!1)),this.allowed_filters&&this.allowed_filters.status){var r=i.get("value");this.allowed_filters.sort="closed"!==r&&"archived_incomplete"!==r}return{account_filter_name:t.get("display_value"),team_filter_name:e.get("display_value"),status_filter_options:_.map(i.get("select_options"),(function(e){return _.extend(e,{selected:i.get("value")==e.value?"selected":""})})),filter_filter_options:_.map(n.get("select_options"),(function(e){return _.extend(e,{selected:n.get("value")==e.value?"selected":""})})),sort_options:s&&_.map(s.get("select_options"),(function(e){return _.extend(e,{selected:s.get("value")==e.value?"selected":""})})),group_by_options:_.map(o.get("select_options"),(function(e){return _.extend(e,{selected:o.get("value")==e.value?"selected":""})})),allowed_filters:this.allowed_filters,has_search_query:a&&""!==a}},initialize:function(){Z.__super__.initialize.apply(this,arguments),this.collection.set_valid_group_by_filter()},events:$.extend({"click .pagelist .account_filter":"show_account_selector_modal","click .pagelist .clear_account_filter":"clear_account_filter"},Y.prototype.events),clear_account_filter:function(e){return this.collection.findWhere({field:"account_id"}).set({display_value:"",value:null}),this.collection.set_valid_group_by_filter(),this.render(),!1},show_account_selector_modal:function(e){var t=this;return $(e.target).hasClass("disabled")||$f.mobile.nav.show_modal(u.H,{post_on_select:function(e){t.collection.findWhere({field:"account_id"}).set({value:e.get("id"),display_value:e.get("name")}),t.collection.set_valid_group_by_filter(),t._reshow_modal()},on_clear:function(){t.collection.set_valid_group_by_filter(),t.clear_account_filter()}}),!1}}),V=Z.extend({template:"#tpl_tasks_filtered_by_project_filter",toolbarnav_title:function(){return _t("mobile_toolbarnav_title_filter_project_tasks")},className:"tasks_filtered_by_project_page",toolbarnav_center_title:!0}),G=Backbone.Marionette.ItemView.extend({template:"#tpl_device_item",tagName:"li",templateHelpers:function(){return{is_selected:$f.mobile.bluetooth.devices.selected_device===this.model}},events:{"click .device_btn":"select_device"},_remove_discovered_class_timeout:function(){this._remove_discovered_class_id&&(clearTimeout(this._remove_discovered_class_id),this._remove_discovered_class_id=null)},on_discovered:function(){var e=this;this._remove_discovered_class_timeout();var t=this.$el.find(".device_btn");t.addClass("discovered"),this._remove_discovered_class_id=setTimeout((function(){t.removeClass("discovered"),e._remove_discovered_class_id=null}),500)},select_device:function(e){return this.$el.find(".checked").length?this.model.collection.unselect_device():this.model.collection.select_device(this.model),this.trigger("selected_device_changed"),!1},onClose:function(){this._remove_discovered_class_timeout()}}),W=Backbone.Marionette.CollectionView.extend({tagName:"ul",itemView:G,className:"pagelist",initialize:function(e){e=e||{},$.extend(this,e);var t=this;this.on("itemview:selected_device_changed",(function(e){t.render()})),this.listenTo($f.application.vent,"btdevice:device_discovered",(function(e){var i=t.children.findByModel(e);i&&i.on_discovered()}))}}),K=l.IO.extend({template:"#tpl_devices",toolbarnav_title:function(){return _t("mobile_settings_devices")},events:{"click .scan_btn:not(.scanning)":"start_scan"},initialize:function(e){e=e||{},$.extend(this,e);var t=this;this.$el.addClass("bluetooth_devices"),this.start_scan(),$f.application.vent.on("btdevice:ble_scan_stopped",(function(){t.$el.find(".scan_btn").removeClass("scanning")})),$f.application.vent.on("btdevice:ble_scan_started",(function(){t.$el.find(".scan_btn").addClass("scanning")}))},regions:{r_bluetooth_device_list:".bluetooth_device_list"},onRender:function(){this.r_bluetooth_device_list.show(new W({collection:$f.mobile.bluetooth.devices}))},start_scan:function(){return $f.mobile.bluetooth.enumerate_devices(),!1},onClose:function(){$f.application.vent.off("btdevice:ble_scan_stopped"),$f.application.vent.off("btdevice:ble_scan_started"),$f.mobile.bluetooth.stop_scan()}}),J=l.IO.extend({template:"#tpl_tasks",toolbarnav_title:function(){return _t("mobile_common_tasks")},use_transitions:!1,className:"tasks",search_options:null,search_options_class:m.uW,is_top_level_page:!0,default_value:"",toolbarnav_toggle_search:!1,allowed_filters:null,show_search:!0,include_page_scrollable:!0,tasks_collection_class:p.jR,prioritize_cached_results:!1,task_bucket_collections:null,ACTIVE_SCROLLTOP_RESTORE_DELAY_MS:100,dashboard_cards:null,dashboard_tab_id:null,regions:{r_dashboard_cards:".tasks_dashboard_cards_container",r_search_bar:".search_bar",r_search_tasks:".r_search_tasks",r_tasks_buckets:".r_tasks_buckets"},events:{"click .filter_list":"view_filter_tasks","focus .search_bar .search":"hide_filter_list","blur .search_bar .search":"show_filter_list"},templateHelpers:function(){return{allowed_filters:this.allowed_filters,is_filter_shown:null===this.allowed_filters||_.size(this.allowed_filters)>0,show_search:this.show_search,include_page_scrollable:this.include_page_scrollable}},initialize:function(e){e=e||{},$.extend(this,e),this.task_bucket_collections||this._reset_task_bucket_collections(),$f.mobile.nav.is_current_page_historic()&&(this.is_historic_view=!0),this.is_top_level_page&&$f.application.vent.trigger("mobile:set_active_leftmenu_item","nav_tasks")},onRender:function(){this._isShown&&this._on_show_render()},_reset_task_bucket_collections:function(){this.task_bucket_collections={},$f.mobile.nav.add_options({task_bucket_collections:this.task_bucket_collections})},_on_show_render:function(){var e=this;this._get_search_options((function(t){t.set_valid_group_by_filter(),e._show_search_bar(t),e._show_active_filter_string(t),e._show_dashboard_cards(t),e.default_value?(e.search(e.default_value),e._show_task_search_results(e.task_bucket_collections.search)):e._show_bucket_sets()}))},onShow:function(){J.__super__.onShow.call(this),this.on_orientation_change(),this._on_show_render(),this._restore_active_scrolltop()},_restore_active_scrolltop:function(){setTimeout((function(){$f.mobile.nav.restore_scroll_position()}),this.ACTIVE_SCROLLTOP_RESTORE_DELAY_MS)},_show_bucket_sets:function(){var e=this;this._get_search_options((function(t){var n=t.findWhere({field:"group_by"});n&&"account"===n.get("value")?e._show_account_buckets(t):Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/tasks/views.js")).then((function(i){e.r_tasks_buckets.show(new i.TasksBucketSet({task_bucket_collections:e.task_bucket_collections,search_options:t,tasks_collection_class:e.tasks_collection_class}))}))}))},_show_account_buckets:function(e){var t=this,n=e.findWhere({field:"group_id"}),s=new m.Sp([],{distribute_group_id:n?n.get("value"):null});$f.mobile.notifications.show_loading_dialog(),s.fetch({prefer_offline:Boolean(Object.keys(t.task_bucket_collections).length),success:function(){var n=new g.mR({id:"null",name:_t("mobile_tasks_bucket_no_location")});s.add(n),Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/tasks/views.js")).then((function(i){t.r_tasks_buckets.show(new i.TasksAccountBucketList({collection:s,task_bucket_collections:t.task_bucket_collections,search_options:e,tasks_collection_class:t.tasks_collection_class})),$f.mobile.notifications.hide_loading_dialog()}))},error:function(){$f.mobile.notifications.hide_loading_dialog()}})},_get_search_options:function(e){var t=this;if(this.search_options)e(this.search_options);else{var i=new this.search_options_class(null);i.fetch_from_local((function(){t.search_options=i,t.listenTo(t.search_options,"filters_updated",(function(){t._reset_task_bucket_collections(),t.render()})),e(t.search_options)}))}},_get_collection_for_text_search:function(e){return this.task_bucket_collections.search||(this.task_bucket_collections.search=this.tasks_collection_class.create_collection_for_text_search(e)),this.task_bucket_collections.search},view_filter_tasks:function(){if(!this.search_options)return!1;var e=this.allowed_filters||{team:!0,location:!0,ownership:!0,assignee:!0,creator:!0,status:!0,group_by:!0,sort:!0};return $f.mobile.nav.show_modal(Z,{collection:this.search_options,allowed_filters:e}),!1},hide_filter_list:function(){$f.mobile.is.web()||($(".active_filters").hide(),$(".filter_list").hide())},show_filter_list:function(){$f.mobile.is.web()||($(".active_filters").show(),$(".filter_list").show())},_show_dashboard_cards:function(){var e=this;this.dashboard_cards&&Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/dashboard/views.js")).then((function(t){e.r_dashboard_cards.show(new t.MobileDashboardCards({collection:e.dashboard_cards,tab_id:e.dashboard_tab_id}))}))},_show_search_bar:function(e){var t=this,i=e.findWhere({field:"search_query"}).get("value");null!=i&&(this.default_value=i),this.r_search_bar.show(new c.R({collection:t._get_collection_for_text_search(e),default_value:t.default_value,on_search_clear:function(){t.clear_search()},search:function(e,i){t.search(e,i)}}))},_show_active_filter_string:function(e){if(e.get_filter_string()){var t=_.template("<%- filter %>");this.$el.find(".active_filters").html(t({filter:e.get_filter_string()}))}},_show_task_search_results:function(e){var t=this;Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/tasks/views.js")).then((function(i){t.r_search_tasks.show(new i.TasksBucket({collection:e,no_fetch:!0})),t._hide_bucket_sets()}))},search:function(e){var t=this;if(!e||""===e)return this.clear_search(),this.r_search_tasks.close(),void this._show_bucket_sets();e===this.search_options.get_value_for_field("search_query")&&this.task_bucket_collections.search.is_fetched?t._show_task_search_results(this.task_bucket_collections.search):(this.task_bucket_collections.search.reset(),$f.mobile.notifications.show_loading_dialog(),this.task_bucket_collections.search.typeahead_search(e,(function(i){$f.mobile.notifications.hide_loading_dialog();var n=t.search_options;t.default_value=e,n.findWhere({field:"search_query"}).set("value",e),t._show_active_filter_string(n),t._show_task_search_results(i)})))},_hide_bucket_sets:function(){this.r_tasks_buckets.close()},clear_search:function(){this.search_options.findWhere({field:"search_query"}).set("value",null),this._show_active_filter_string(this.search_options),this.default_value=""}}),Q=J.extend({toolbarnav_title:function(){return _t("mobile_common_projects")},is_top_level_page:!1,className:"tasks_filtered_by_project",search_options:null,search_options_class:m.Qp,view_filter_tasks:function(){return $f.mobile.nav.add_options(),!!this.search_options&&($f.mobile.nav.show_modal(V,{collection:this.search_options}),!1)}}),X=Backbone.Marionette.ItemView.extend({template:"#tpl_project_item",model:null,tagName:"li",templateHelpers:function(){return{relative_date_due:this.model.get("date_due")?$f.utils.get_relative_date_from_today(new Date(this.model.get("date_due").$date)):null,relative_date_start:this.model.get("date_start")?$f.utils.get_relative_date_from_today(new Date(this.model.get("date_start").$date)):null,is_recurring:this.model.get("parent_project")&&null!=this.model.get("parent_project").recurring,time_due:this.model.get_time_start_and_due_str(),tasks_remaining:this.model.get("num_tasks")-this.model.get("num_tasks_closed")}},events:{"click .navlink":"navigate_to_task_list"},navigate_to_task_list:function(e){var t=this;if(!this.model.get("is_started"))return!1;var i=new m.Qp(null,{persist_on_change:!1});i.findWhere({field:"group_id"}).set({value:this.model.collection.paginator.get("group_id"),display_value:this.model.collection.group_name}),i.findWhere({field:"status"}).set({value:"all"}),i.findWhere({field:"is_active"}).set({value:this.model.get("is_active")}),i.findWhere({field:"filter"}).set({value:this.model.collection.paginator.get("filter")}),i.findWhere({field:"project_ids"}).set({value:this.model.get("id"),display_value:this.model.get("title")}),i.save_local((function(){$f.mobile.nav.show(Q,{toolbarnav_title:t.model.get("title")})}))}}),ee=Y.extend({template:"#tpl_project_filter",toolbarnav_title:function(){return _t("mobile_toolbarnav_title_filter_projects")},className:"project_filter_page",templateHelpers:function(){var e=this.collection.findWhere({field:"group_id"}),t=this.collection.findWhere({field:"filter"}),i=this.collection.findWhere({field:"is_active"}),n=this.collection.findWhere({field:"type"});return{team_filter_name:e.get("display_value"),ownership_filter_options:_.map(t.get("select_options"),(function(e){return _.extend(e,{selected:t.get("value")===e.value?"selected":""})})),active_filter_options:_.map(i.get("select_options"),(function(e){return _.extend(e,{selected:i.get("value")===e.value?"selected":""})})),type_filter_options:_.map(n.get("select_options"),(function(e){return _.extend(e,{selected:n.get("value")===e.value?"selected":""})}))}}}),te=U.extend({collection:null,itemView:X,className:"projects_list",getEmptyView:function(){return r.G.extend({icon_class:"df-success",i18n_key_message:"mobile_empty_list_message_no_projects"})},initialize:function(e){this.collection||(this.collection=new p.Aq)}}),ie=l.IO.extend({template:"#tpl_projects",default_search_value:"",toolbarnav_title:function(){return _t("mobile_common_projects")},toolbarnav_toggle_search:!1,use_transitions:!1,className:"projects",search_options:null,is_top_level_page:!0,_fetched_from_local:!1,regions:{r_projects_list:".projects_list_container",r_search_bar:".search_bar"},events:{"click .filter_list":"view_filter_projects","click .projects_list li":"navigate_to_task_list"},initialize:function(e){e=e||{},$.extend(this,e),$f.mobile.nav.is_current_view_top_level_page()||(this.is_top_level_page=!1,this.use_transitions=!0)},onRender:function(){$f.application.vent.trigger("mobile:set_active_leftmenu_item","nav_projects");var e=this;e.search_options||(e.search_options=new m.tb(null)),this.search_options&&this.search_options.findWhere({field:"search_query"}).get("value")&&(this.default_search_value=this.search_options.findWhere({field:"search_query"}).get("value")),e._fetched_from_local?e.view_projects_list():e.search_options.fetch_from_local((function(){e._fetched_from_local=!0,e.render()}))},view_projects_list:function(){var e={};this.search_options.each((function(t){return e[t.get("field")]=t.get("value")})),this.show_projects_list(new p.Aq([],{group_name:this.search_options.findWhere({field:"group_id"}).get("display_value")}),{force_request_gps_permission:!0,paginator_options:e})},view_filter_projects:function(){return $f.mobile.nav.add_options(),!!this.search_options&&($f.mobile.nav.show(ee,{collection:this.search_options}),!1)},show_projects_list:function(e,t){t=t||{},t=$.extend({force_request_gps_permission:!1},t),this.r_projects_list&&this.r_projects_list.currentView&&this.r_projects_list.close();var i=this,n=function(t,n){$f.mobile.notifications.hide_loading_dialog(),i.r_projects_list.show(new te({collection:e}))};i.r_search_bar.show(new c.R({collection:e,default_value:i.default_search_value,on_search_clear:function(){i.clear_search()},search:function(e,t){i.search(e,t)}})),i.search_options.get_filter_string()&&i.$el.find(".active_filters").html(i.search_options.get_filter_string()),e.paginator.reset_pagination(),e.paginator.set(t.paginator_options),$f.mobile.notifications.show_loading_dialog(),$f.mobile.is.connected()?e.fetch({success:n,error:function(){$f.mobile.notifications.hide_loading_dialog(),i.r_projects_list.show(new r.G({icon_class:"df-alert",i18n_key_message:"mobile_empty_list_message_connection_error"}))}}):n()},search:function(e,t){t||(t=function(){}),e||(e="");var i=this.r_projects_list.currentView.collection;$f.mobile.notifications.show_loading_dialog(),i.typeahead_search(e,(function(e){$f.mobile.notifications.hide_loading_dialog(),t()})),this.default_search_value=e,this.search_options.findWhere({field:"search_query"}).set("value",e)},clear_search:function(e){this.search_options.findWhere({field:"search_query"}).set("value",null),this.default_search_value=""}}),ne=f.kG.extend({collection:new g.MK,toolbarnav_title:function(){return _t("mobile_toolbarnav_title_select_tag")},model:null,format_result:function(e){return"Tag: "+e.get("name")},transform_collection:function(e){return e.filter((function(e){return!0===e.get("is_editable")}))}}),se=f.kG.extend({collection:null,toolbarnav_title:function(){return _t("mobile_toolbarnav_title_select_user")},allow_teams:!1,allow_users:!0,initialize:function(e){e=e||{},$.extend(this,e),this.collection=new g.hy([],{allow_all_company_group:this.allow_teams}),se.__super__.initialize.apply(this,arguments)},format_result:function(e){return e.get("name")},transform_collection:function(e){var t=this,i=e.filter((function(e){return!(!t.allow_teams&&"group"==e.get("type")||!t.allow_users&&"user"==e.get("type"))}));return new g.hy(i)}}),oe=se.extend({allow_multiple:!0,collection_class:g.hy}),ae=f.kG.extend({collection:new g.cG,toolbarnav_title:function(){return _t("mobile_toolbarnav_title_select_template")},initialize:function(e){ae.__super__.initialize.apply(this,arguments),this.collection.paginator.set({filter:this.get_filter(e.is_create_context)})},get_filter:function(e){return $f.active_user.is_admin()||$f.active_user.is_manager()&&!e?"all":"me"}}),re=f.kG.extend({collection_class:g.gS,toolbarnav_title:function(){return _t("mobile_toolbarnav_title_select_team")},format_result:function(e){return e.get("name")},allow_multiple:!0}),le=f.kG.extend({collection:new g.gS,toolbarnav_title:function(){return _t("mobile_toolbarnav_title_select_team")},format_result:function(e){return e.get("name")},post_on_select:function(e){return e}}),_e=f.kG.extend({collection_class:m.$c,toolbarnav_title:function(){return _t("mobile_placeholder_user_select_role")},format_result:function(e){return e.get("name")},get_modal_options:function(){var e=_e.__super__.get_modal_options.apply(this,arguments);return $.extend(e,this.extra_modal_options),e},allow_multiple:!0}),ce=f.kG.extend({collection:new m.OF,toolbarnav_title:function(){return _t("mobile_toolbarnav_title_select_team_or_location")},format_result:function(e){return e.get("name")},post_on_select:function(e){return e},on_select:function(e){var t=this;if("group"===e.get("type"))return $f.mobile.dashboard.active_search_item_name=e.get("name"),this.post_on_select($f.mobile.dashboard.distribute_groups.get(e.get("raw_id"))),this.close(),!1;if("account"===e.get("type")){var i=new g.mR({id:e.get("raw_id")});$f.mobile.notifications.show_loading_dialog(),i.fetch({success:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.dashboard.active_search_item_name=i.get("name"),t.post_on_select(i),t.close()},error:function(){$f.mobile.notifications.show_error_msg(_t("mobile_message_task_detials_error_view_account")),$f.mobile.dashboard.active_search_item_name=null,t.post_on_select(null),t.close()}})}}}),ue=f.y3.extend({template:"#tpl_zp_account_autocomplete",model:null,modal_class:u.H,i18n_key_placeholder:"mobile_placeholder_account_location_name",display_address:!1,templateHelpers:function(){var e=ue.__super__.templateHelpers.apply(this,arguments);return e||(e={}),e.display_address=this.display_address,this.model.get("address")?e.display_address=this.display_address:e.display_address=!1,e},get_modal_options:function(){var e=ue.__super__.get_modal_options.apply(this,arguments);return $.extend(e,{show_add_task:!1}),e},get_default_value:function(){return this.model.get("name")}}),de=f.y3.extend({model:null,modal_class:ne,i18n_key_placeholder:"mobile_placeholder_tag_filter_by",get_default_value:function(){return this.model.get("name")}}),fe=f.y3.extend({model:null,modal_class:se,i18n_key_placeholder:"mobile_placeholder_user_type",extra_modal_options:{},html_name:"user",get_default_value:function(){return this.model instanceof g.n5?this.model.get_display_name():this.model.get("name")},get_modal_options:function(){var e=ue.__super__.get_modal_options.apply(this,arguments);return $.extend(e,this.extra_modal_options),e}}),me=f.y3.extend({model:null,modal_class:ae,i18n_key_placeholder:"mobile_task_tab_form",is_create_context:!1,get_default_value:function(){return this.model.get("title")}}),he=Backbone.Marionette.ItemView.extend({template:"#tpl_generate_batch_estimate_count",model:null,_reestimate_timeout:null,initialize:function(){this.listenTo(this.model.get("user_role"),"change",this.reestimate,this),this.listenTo(this.model.get("distribute_group"),"change",this.reestimate,this),this.listenTo(this.model.get("account_tag"),"change",this.reestimate,this)},templateHelpers:function(){var e=this.model.get("estimate_task_count"),t=1===e?"1 "+_t("mobile_common_task"):e+" "+_t("mobile_common_tasks"),i=this.model.get("estimate_user_count"),n=1===i?"1 "+_t("mobile_batch_estimate_user"):i+" "+_t("mobile_batch_estimate_users");return{has_changed:this.has_changed,task_count_string:t,user_count_string:n}},reestimate:function(){var e=this;if(!this._reestimate_timeout){if(!this.model.get("user_role").get("id")||!this.model.get("distribute_group").get("id"))return this.model.set({estimate_task_count:null,estimate_user_count:null}),this.render();this.render().$el.html($f.utils.get_loading_spinner_html()),this._reestimate_timeout=setTimeout((function(){clearTimeout(e._reestimate_timeout),e._reestimate_timeout=null,e.model.fetch({success:function(){e.render()},error:function(){e.render()}})}),300)}}}),ge=Backbone.Marionette.ItemView.extend({template:"#tpl_user_role_select",user_roles:null,model:null,i18n_key_placeholder:"mobile_placeholder_user_select_role",templateHelpers:function(){return{user_roles:this.user_roles,selected_id:this.model.get("id"),placeholder:_t(this.i18n_key_placeholder)||this.i18n_key_placeholder}},events:{"change select":"bind_value"},initialize:function(e){e=e||{},$.extend(this,e)},bind_value:function(e){var t=$(e.target);this.model.set({id:t.val(),name:t.attr("name")})}}),pe=u.H.extend({is_top_level_page:!0,is_modal:!1,toolbarnav_title:function(){return _t("mobile_common_locations")},toolbarnav_center_title:!1,toolbarnav_show_add_task:!0,initialize:function(e,t){pe.__super__.initialize.apply(this,arguments),$f.mobile.nav.add_options({collection:this.collection})},onRender:function(){$f.application.vent.trigger("mobile:set_active_leftmenu_item","nav_locations")},on_select:function(e){if(!$f.mobile.is.connected())return $f.mobile.notifications.show_offline_msg();$f.mobile.dashboard.active_tab_id=null,Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/dashboard/views.js")).then((function(t){var i=t.getDefaultLocationDashboardTabId,n=t.MobileDashboard;$f.mobile.nav.show(n,{active_account_or_group:e,active_tab_id:i(),do_not_set_leftnav:!0,reset_active_group_or_account_on_close:!1})}))}}),be=l.IO.extend({template:"#tpl_project_creator",className:"task_create_page",model:null,tasks_data:null,default_account:null,use_transitions:!0,toolbarnav_show_add_task:!1,toolbarnav_center_title:!0,_saving:!1,_has_changed:!1,toolbarnav_title:function(){return"".concat(_t("mobile_task_button_create")," ").concat(_t("mobile_task_button_project"))},events:{"change .watched_input":"title_changed","change .description_watched_input":"description_changed","click .save_project_details":"create_project","keyup textarea":"expand_textarea","click .auto_archive":"set_auto_archive"},regions:{r_reply_tabs_for_task:"#reply_tabs_for_task",r_form_template_typeahead_for_task:"#form_template_typeahead_for_task",r_title_image_field:".add_title_image_field",r_role_typeahead_for_task:"#role_typeahead_for_task",r_teams_typeahead_for_task:"#teams_typeahead_for_task",r_date_start_picker_for_task:"#date_start_picker_for_task",r_date_due_picker_for_task:"#date_due_picker_for_task",r_location_tags_for_task:"#location_tags_for_task",r_batch_generate_count:"#batch_generate_count"},templateHelpers:function(){return{reply:this.tasks_data.get("reply"),mode:this.mode}},initialize:function(e){var t=this;e=e||{},$.extend(this,e),this.model||(this.model=new p.zz({id:$f.utils.local_guid(),local_guid:!0,date_due:{$date:null},is_auto_archive:!0}),this.model.set("create_tasks_data",new p.zS({reply:{type:"quick"}},{parent_project:this.model})),$f.mobile.nav.add_options({model:this.model})),this.tasks_data=this.model.get("create_tasks_data"),this.tasks_data.get("assignee")||this.tasks_data.set("assignee",{},{silent:!0}),this.tasks_data.get("account_tags")||this.tasks_data.set("account_tags",{},{silent:!0}),this.listenTo(this.tasks_data.get("reply"),"change",(function(){t._has_changed=!0,t.render()})),this.model.store(),this.listenTo(this.model,"change",(function(){t._has_changed=!0,t.on_model_changed()})),this.listenTo(this.tasks_data,"change",(function(){t._has_changed=!0,t.on_model_changed()})),this.listenTo(this.tasks_data.get("title_image_field"),"change:file",(function(){t._has_changed=!0})),this.listenTo($f.application.vent,"mobile:due_date_change",this.handle_due_date_change),this.listenTo($f.application.vent,"mobile:start_date_change",this.handle_start_date_change)},onRender:function(){this.$el.find("textarea").trigger("keyup"),this.show_regions(),this._initialize_auto_archive(),this.bind_validation(),this._has_changed&&this.on_model_changed(),this.on_orientation_change()},handle_due_date_change:function(){var e=this.$el.find(".date_due input"),t=this.$el.find(".date_start input"),i=e.val()?new Date(e.val()):new Date,n=t.val()?new Date(t.val()):new Date,s=moment().startOf("day").toDate();this.set_date_picker(t,n,i,s)},handle_start_date_change:function(){var e=this.$el.find(".date_due input"),t=this.$el.find(".date_start input"),i=e.val()?new Date(e.val()):new Date,n=t.val()?new Date(t.val()):new Date,s=new Date((new Date).getFullYear()+10,11,31);this.set_date_picker(e,i,s,n)},set_date_picker:function(e,t,i,n){e.mobiscroll().date({theme:"material",display:"bottom",defaultValue:t,max:i,focusOnClose:!1,dateWheels:"M D d yy",min:n})},show_regions:function(){var e=this,t=new g.SM;this.r_reply_tabs_for_task.show(new we({model:this.tasks_data.get("reply")})),this.r_title_image_field.show(new s.IL({model:this.tasks_data.get("title_image_field"),task:this.model,hide_caption:!0}));var i=this.tasks_data.get("reply");"form_submission"==i.get("type")&&(i.get("form_template")||i.set("form_template",new g._U),this.r_form_template_typeahead_for_task.show(new me({is_create_context:!0,model:i.get("form_template"),post_on_select:function(t){i&&i.get("form_template")&&t.get("id")==i.get("form_template").get("id")||(i.set("form_template",new g._U({id:t.id,title:t.get("title")})),e.model.set("title",e.tasks_data.get("reply").get("form_template").get("title")))},on_clear:function(){e.tasks_data.get("reply").set("form_template",null),e.model.set("title","")}}))),this.r_date_start_picker_for_task.show(new ve({i18n_key_placeholder:"mobile_tso_filter_start_date",date_due:new Date,picker_type:"date_start",on_select:function(t){e.set_date_start(t),$f.application.vent.trigger("mobile:start_date_change")}})),this.r_date_due_picker_for_task.show(new ve({i18n_key_placeholder:"mobile_tso_filter_due_date",date_due:this.model.get("date_due"),on_select:function(t){e.set_date_due(t),$f.application.vent.trigger("mobile:due_date_change")}})),this.r_teams_typeahead_for_task.show(new fe({i18n_key_placeholder:"mobile_placeholder_filter_by_team",extra_modal_options:{allow_teams:!0,allow_users:!1,toolbarnav_title:function(){return _t("mobile_toolbarnav_title_select_team")}},html_name:"distribute_group",model:e.tasks_data.get("distribute_group"),post_on_select:function(t){e.model.get("create_tasks_data").get("distribute_group").set({id:t.get("raw_id"),name:t.get("name")})},on_clear:function(){e.tasks_data.get("distribute_group").clear()}})),this.r_location_tags_for_task.show(new de({model:e.tasks_data.get("account_tag"),post_on_select:function(t){e.model.get("create_tasks_data").get("account_tag").set({id:t.get("raw_id"),name:t.get("name")})},on_clear:function(){e.tasks_data.get("account_tag").clear()}})),t.fetch({success:function(){e.r_role_typeahead_for_task.show(new ge({user_roles:t,model:e.tasks_data.get("user_role"),i18n_key_placeholder:"mobile_placeholder_assign_to_user_role"}))},error:function(){e.$el.find(".roles_loading_msg").html(_t("mobile_html_failed_loading_roles"))}}),this.r_batch_generate_count.show(new he({model:this.model.get("create_tasks_data")})),this.$el.find(".save_project_details").removeClass("disabled")},_initialize_auto_archive:function(){var e=this.model.get("is_auto_archive")?1:0;this.$el.find('[name="auto_archive_radio"][value="'+e+'"]').attr("checked",!0)},bind_validation:function(){var e=this;Backbone.Validation.unbind(this),Backbone.Validation.bind(this),this.model.unbind("validated:invalid"),this.model.bind("validated:invalid",(function(t,i){e.$el.find(".form-field.invalid").removeClass("invalid"),e.$el.find(".invalid").parents(".form-field").addClass("invalid")})),this.model.unbind("validated:valid"),this.model.bind("validated:valid",(function(t,i){e.$el.find(".invalid").removeClass("invalid")}))},on_model_changed:function(){this.model.validate()},title_changed:function(e){var t=$(e.target);this.model.set("title",t.val())},description_changed:function(e){var t=$(e.target);this.model.set("description",t.val())},create_project:function(e){if($(e.target).hasClass("disabled"))return!1;var t=this.tasks_data.get("reply");return"form_submission"!=t.get("type")&&t.set("form_template",null),"form_submission"!=t.get("type")||t.get("form_template").id?this.model.isValid(!0)&&this.tasks_data.isValid(!0)?(this.model.get("date_due")&&!this.model.get("date_due").$date&&this.model.set("date_due",null),this.$el.find(".save_project_details").addClass("disabled"),$f.mobile.notifications.show_loading_dialog(),this.save_project(e),!1):($f.mobile.notifications.show_error_msg(_t("mobile_message_task_creator_error_save_required_fields")),!1):($f.mobile.notifications.show_error_msg(_t("mobile_message_task_creator_error_save_select_form")),!1)},reenable_save_button:function(){this.$el.find(".save_project_details").removeClass("disabled"),$f.mobile.notifications.hide_loading_dialog()},save_project:function(e){var t=this,i=this.tasks_data.get("estimate_task_count");if(null==i||0==i)return $f.mobile.notifications.show_error_msg(_t("mobile_message_task_creator_error_save_batch_change")),this.reenable_save_button(),!1;$f.mobile.new_project.add_records(this.model,(function(){t.saving=!0,t.reenable_save_button(),$f.mobile.uploads.start_upload({error_msg:_t("mobile_message_task_detials_error_submit_task_project"),success:function(){$f.mobile.cache.void_ttl_by_cache_substring("mobile_tasks__"),$f.mobile.nav.go_back()},msg:_t("mobile_message_task_detials_wait_submit_task_created")})}),(function(){t.reenable_save_button(),$f.mobile.notifications.show_error_msg(_t("mobile_common_message_task_creator_error_save"),!0)}))},set_auto_archive:function(e){this.model.set("is_auto_archive","1"===$(e.target).val())},set_date_start:function(e){if(!e)return this.model.get("create_tasks_data").set("date_start",null),void this.model.set("date_start_naive",null);var t=moment(e).utcOffset(0).startOf("day").toDate().toISOString().replace("Z","");this.model.set("date_start_naive",t)},set_date_due:function(e){if(!e)return this.model.get("create_tasks_data").set("date_due",null),void this.model.set("date_due_naive",null);var t=new Date(e).toLocaleDateString("en-CA")+"T23:59:59.999";this.model.set("date_due_naive",t)},_restore_model:function(){this.model.restore(),this.tasks_data.set("title_image_field",new p._q({id:1,type:"image",value:this.tasks_data.get("title_image").toJSON()},{task_or_project:this.tasks_data}),{silent:!0}),$f.mobile.nav.add_options({model:this.model}),$f.mobile.nav.go_back()},go_back:function(){var e=this;if(this._saving||!this._has_changed)return be.__super__.go_back.apply(this,arguments);if(!$f.mobile.is.web()){var t={title:_t("mobile_projects_leaving_project"),subtitle:_t("mobile_message_task_detials_confirm_message"),position:[50,60],addCancelButtonWithLabel:_t("mobile_action_sheet_cancel")};return $f.mobile.is.ios()?(t.buttonLabels=[_t("mobile_projects_save_project")],t.addDestructiveButtonWithLabel=_t("mobile_common_button_discard"),t.destructiveButtonLast=!0):$f.mobile.is.android()?(t.buttonLabels=[_t("mobile_projects_save_project"),_t("mobile_common_button_discard")],t.androidTheme=$f.mobile.cordova.actionsheet.ANDROID_THEMES.THEME_DEVICE_DEFAULT_LIGHT,t.androidEnableCancelButton=!0):$f.mobile.is.windows()&&(t.buttonLabels=[_t("mobile_projects_save_project"),_t("mobile_common_button_discard")]),void $f.mobile.notifications.decide(t,(function(t){3!==t&&(1!==t?($f.mobile.uploads.clear_pending_file_uploads(e.model.id),e._restore_model()):e.$el.find(".save_project_details").trigger("click"))}))}$f.mobile.notifications.confirm(_t("mobile_message_task_detials_confirm_message"),(function(t){t&&($f.mobile.uploads.clear_pending_file_uploads(e.model.id),e._restore_model())}),_t("mobile_projects_leaving_project"),_t("mobile_common_button_yes"),_t("mobile_common_button_no"))},expand_textarea:g.Vl.expand_textarea}),ve=Backbone.Marionette.ItemView.extend({template:"#tpl_date_due_picker",date_due:null,i18n_key_placeholder:"mobile_common_placeholder_date",picker_type:"date_due",events:{"change input":"save_value","click input":"show_picker"},templateHelpers:function(){return{formatted_date:this.format_date(),date_due:this.date_due&&this.date_due.$date?this.date_due.$date:null,placeholder:_t(this.i18n_key_placeholder)||this.i18n_key_placeholder,picker_type:this.picker_type}},initialize:function(e){e=e||{},$.extend(this,e)},format_date:function(){if(!this.date_due||!this.date_due.$date)return null;var e=new Date(this.date_due.$date);return moment(e).format("ddd, MMM D, YYYY")},onBeforeRender:function(){this.$el.find(".date input")&&this.$el.find(".date input").mobiscroll("destroy")},onRender:function(){var e=$(".date_due input"),t=new Date((new Date).getFullYear()+10,11,31);e.val()&&"date_start"===this.picker_type&&(t=e.val()),this.$el.find(".date input").mobiscroll().date({theme:"material",display:"bottom",defaultValue:this.date_due?new Date(this.date_due.$date):new Date,max:new Date(t),focusOnClose:!1,dateWheels:"M D d yy",min:moment().startOf("day").toDate()})},show_picker:function(e){return this.$el.find("input").mobiscroll("show"),!1},save_value:function(e){var t=this.$el.find(".date input").mobiscroll("getDate").getTime();this.date_due.$date=moment(t).endOf("day").toDate(),this.render(),this.on_select(t)},on_select:function(e){}}),we=Backbone.Marionette.ItemView.extend({template:"#tpl_task_reply_tabs",model:null,events:{"click .reply_type i":"update_task_reply_type","click .reply_type a":"update_task_reply_type"},update_task_reply_type:function(e){e&&e.preventDefault();var t=$(e.target).closest("div").data("type");this.model.set("type",t),this.render()}}),ye=Backbone.Marionette.CollectionView.extend({collection:null,itemView:s.IL,itemViewOptions:function(e){return{hide_caption:!e.get("notes")}},onShow:function(){this.$el.addClass("historical_submission"),this.$el.find("textarea").attr("disabled","disabled"),this.$el.find("textarea").attr("readonly","readonly"),this.$el.find("select").attr("disabled","disabled")}}),ke=l.IO.extend({template:"#tpl_task_details_page",model:null,className:"task_details_page",toolbarnav_title:null,use_transitions:!0,tabs:[],comments:null,auto_resize_page_scrollable:!1,active_comment_id:null,regions:{r_tabbed_layout:".task_details_tabbed_layout"},events:{"click .edit_task_action":"click_edit_task_action","click .delete_task_action":"click_delete_task_action","click .archive_task_action":"click_archive_task_action"},initialize:function(e){e=e||{},$.extend(this,e),this.toolbarnav_title=this.toolbarnav_title||function(){return _t("mobile_common_tasks")},this.tabs=[{id:"task_info",name:_t("mobile_dashboard_tab_title_info"),view_class:$e,view_options:{model:this.model}}]},onShow:function(){var e=this;ke.__super__.onShow.apply(this,arguments),$f.mobile.notifications.show_loading_dialog(),this.is_historic_view?this._fetch_comments():this.model.fetch({success:function(){e._fetch_comments()},error:function(){e._fetch_comments()}})},_fetch_comments:function(){var e=this;this.fetch_comments({task:e.model,success:function(){return x(this,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return $f.mobile.notifications.hide_loading_dialog(),[4,e.add_comments_tab()];case 1:return t.sent(),e._show_tabbed_layout(),e.on_orientation_change(),[2]}}))}))},error:function(t){return x(this,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return $f.mobile.notifications.hide_loading_dialog(),[4,e.add_comments_tab()];case 1:return t.sent(),e._show_tabbed_layout(),[2]}}))}))}})},on_toolbarnav_init:function(){if(!this.model.is_fulfilled()&&this.model.user_can_edit($f.active_user)){var e=[];this.model.is_archived()||(e.push({container_class:"edit_task_action",icon_class:"df-edit",i18n_key_text:"mobile_common_button_edit"}),e.push({container_class:"archive_task_action",icon_class:"df-remove-circle",i18n_key_text:"mobile_common_button_archive"})),e.push({container_class:"delete_task_action",icon_class:"df-remove-circle",i18n_key_text:"mobile_drafts_button_delete"}),this.toolbarnav.add_actions(e)}},on_orientation_change:function(){ke.__super__.on_orientation_change.apply(this,arguments)},go_back:function(){if(!this.is_comments_tab()){var e=this;if("closed"==this.model.get("status").get("type"))return $f.mobile.nav.go_back(),!1;if("quick"!=this.model.get("reply").get("type"))return $f.mobile.nav.go_back(),!1;var t=this.model.get("fulfillment").get("fields")[0];return t&&(t.has_value()||t.get("notes"))?($f.mobile.notifications.confirm(_t("mobile_message_task_detials_confirm_message"),(function(t){t&&($f.mobile.uploads.clear_pending_file_uploads(e.model.id),$f.mobile.nav.go_back())}),_t("mobile_message_task_detials_confirm_title"),_t("mobile_common_button_yes"),_t("mobile_common_button_no")),!1):($f.mobile.nav.go_back(),!1)}this.go_back_comments_tab()},click_edit_task_action:function(e){var t=this;return this.toolbarnav.hide_overflow_menu(),$f.mobile.is.connected()?($f.mobile.new_tasks.get_pending_task(t.model.id,(function(e){e?$f.mobile.notifications.show_error_msg(_t("mobile_task_edition_already_in_progress")):($f.mobile.notifications.show_loading_dialog(),t.model.fetch({timeout:1e4,success:function(){$f.mobile.notifications.hide_loading_dialog(),t.model.set("title_image_field",new p._q({id:1,type:"image",value:t.model.get("title_image").toJSON()},{task_or_project:t.model}),{silent:!0}),t.model.set("is_edit_mode",!0),Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/tasks/views.js")).then((function(e){$f.mobile.nav.show(e.TaskEditPage,{model:t.model,mode:"edit"})}))},error:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg(_t("mobile_message_show_error_message"))}}))})),!1):($f.mobile.notifications.show_offline_msg(),!1)},execute_task_action:function(e,t){var i=this;if(this.toolbarnav.hide_overflow_menu(),!$f.mobile.is.connected())return $f.mobile.notifications.show_offline_msg(),!1;var n=function(){$f.mobile.notifications.show_success_msg(t.success_message)},s=function(e){$f.mobile.notifications.show_error_msg(t.error_message),i.toolbarnav.hide_overflow_menu(),$f.mobile.logging.log_error(t.log_message,e)},o=function(){$f.mobile.nav.show(J,{prioritize_cached_results:!0})},a=null;return a="delete"===t.method?function(){i.model.delete_from_collection_and_caches((function(){o(),i.model.delete({success:function(){i.model.trigger("destroy",i.model,i.model.collection),n()},error:function(e,t){s(t)}})}))}:function(){i.model.mark_as_archived_in_caches((function(){o(),i.model.destroy({wait:!0,success:function(e,t){n()},error:function(e,t){s(t)}})}))},this._confirm_archive_delete_action(t,(function(){a()})),!1},click_archive_task_action:function(e){return this.execute_task_action(e,{success_message:_t("mobile_task_task_archived"),error_message:_t("mobile_task_error_archiving_task"),log_message:"Closing task failed.",title_message:_t("mobile_task_archive_task"),button_labels_arr:[_t("mobile_task_archive_task")],confirm_message:_t("mobile_task_archive_task_confirm"),confirm_action_message:_t("mobile_task_archive_task"),method:"close"}),!1},click_delete_task_action:function(e){return this.execute_task_action(e,{success_message:_t("mobile_task_task_deleted"),error_message:_t("mobile_task_error_deleting_task"),log_message:"Deleting task failed.",title_message:_t("mobile_tasks_delete_task"),button_labels_arr:[_t("mobile_tasks_delete_task")],confirm_message:_t("mobile_task_delete_task_confirm"),confirm_action_message:_t("mobile_tasks_delete_task"),method:"delete"}),!1},_confirm_archive_delete_action:function(e,t){if($f.mobile.is.native()){var i={title:e.title_message,subtitle:e.confirm_message,buttonLabels:e.button_labels_arr,position:[50,60],addCancelButtonWithLabel:_t("mobile_action_sheet_cancel")};return $f.mobile.is.android()&&(i.androidTheme=$f.mobile.cordova.actionsheet.ANDROID_THEMES.THEME_DEVICE_DEFAULT_LIGHT,i.androidEnableCancelButton=!0),void $f.mobile.notifications.decide(i,(function(e){2!==e&&t()}))}$f.mobile.notifications.confirm(e.confirm_message,(function(e){e&&t()}),e.confirm_action_message,_t("mobile_common_button_yes"),_t("mobile_common_button_no"))},_show_tabbed_layout:function(){this.r_tabbed_layout&&this.r_tabbed_layout.show(new d.WD({is_tabs_full_width:!0,hide_tabs:!1,tab_pages:new m.sR(this.tabs),active_tab_id:this.active_comment_id?$f.shared.comments.utils.COMMENTS_TAB_ID:null}))}});Cocktail.mixin(ke,a.R);var $e=d.OY.extend({template:"#tpl_task_info",model:null,regions:{r_title_images:".title_images",r_task_image_field:".form_container",r_triggering_image_fields:".triggering_image_fields",r_cooldown_stages:".cooldown_stages"},initialize:function(e){e=e||{},$.extend(this,e),this.model.set_default_fulfillment(),this.model.get("fulfillment").set("date_created",{$date:(new Date).getTime()})},templateHelpers:function(){var e=this.model.get("assignee")&&this.model.get("assignee").id,t=_t("mobile_message_task_detials_error_not_assigned_to_you");e&&(t=_t("mobile_message_task_detials_error_assigned_to",{user:this.model.get("assignee").get_display_name()}));var i=null;this.model.get("source")&&this.model.get("source").get("form_submission")&&(i=this.model.get("source").get("form_submission").metadata.get("form_template_type"));var n={can_complete_task:e==$f.active_user.id||null==e,form_template_title:this.model.get("reply").get("form_template")?this.model.get("reply").get("form_template").get("title"):"",m_date_due:void 0===this.model.get("date_due")?moment(new Date(this.model.get("date_due").$date)):null,time_due:this.model.get_time_start_and_due_str(),submit_msg:t,is_fulfilled:this.model.is_fulfilled(),source_form_template_type:i};if(this.model.is_fulfilled()){var s=[];"quick"===this.model.get("fulfillment").get("type")&&_.each(this.model.get("fulfillment").get("fields"),(function(e,t){var i=[];_.each(e.get("value"),(function(e){i.push(e)})),s.push({notes:e.get("notes"),images:i,field_id:e.get("id")})})),$.extend(n,{date_completed:this.model.get("fulfillment").get("date_submitted")?moment(new Date(this.model.get("fulfillment").get("date_submitted").$date)).format("ddd, MMM D, h:mm a"):null,completed_by:this.model.get("fulfillment").get("user")?this.model.get("fulfillment").get("user").display_name:"",quick_fulfill_images:s})}return n},events:{"click #submit_form":"click_submit_task","click .thumbnail":"open_image_preview","click .view_source_submission":function(e){return this.view_task_submission(e,!0),!1},"click .view_task_account":"view_task_account","click .task_fulfilled_info":function(e){return this.view_task_submission(e,!1),!1}},onRender:function(){var e=this.model.get("fulfillment").get("fields"),t=new p._q({id:1,type:"image",value:this.model.get("title_image").toJSON()},{task_or_project:this.model},{silent:!0});"quick"==this.model.get("reply").get("type")&&this.r_task_image_field.show(new s.IL({task:this.model,model:0===e.length?t:e[0]})),this.templateHelpers().is_fulfilled&&(this.$el.find("textarea").attr("readonly","readonly"),this.model.get("fulfillment").get("fields")[0]&&!this.model.get("fulfillment").get("fields")[0].get("notes")&&this.$el.find(".notes_field").hide()),this.model.get("cooldown")&&$f.active_company.has_feature("sensor_cool_down")&&this._show_cooldown_stages(),this.model.get("source").get("triggering_image_fields")&&this.r_triggering_image_fields.show(new ye({collection:this.model.get("source").get("triggering_image_fields")}));var i=new g.rU;!this.model.get("title_image_field")&&this.model.get("title_image")&&this.model.get("title_image").length&&i.add(this.model.get("title_image").models),this.model.get("title_image_field")&&this.model.get("title_image_field").get("value")&&$.each(this.model.get("title_image_field").get("value"),(function(e,t){i.add(new g.Ee({url:t}))})),this.model.get("title_image_field")&&this.model.get("title_image_field").get("file")&&this.model.get("title_image_field").get("file").each((function(e){i.add(new g.Ee({url:e.get_display_url(),native_url:e.get_url_native()}))})),_.size(i)>0&&this.r_title_images.show(new n.cu({collection:i}))},view_task_account:function(e){if(!$f.mobile.is.connected())return $f.mobile.notifications.show_offline_msg(),!1;var t=new g.mR({id:this.model.get("account").get("id")});return $f.mobile.notifications.show_loading_dialog(),t.fetch({success:function(){$f.mobile.notifications.hide_loading_dialog(),Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/dashboard/views.js")).then((function(e){$f.mobile.nav.show(e.MobileDashboard,{active_account_or_group:t})}))},error:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg(_t("mobile_message_task_detials_error_view_account"))}}),!1},view_task_submission:function(e,t){if(!$f.mobile.is.connected())return $f.mobile.notifications.show_error_msg(),!1;var n=null;if(t)n=this.model.get("source").get("form_submission")._id.$oid;else{if("form_submission"!==this.model.get("reply").get("type"))return!1;n=this.model.get("fulfillment").get("form_submission").id}return $f.mobile.notifications.show_loading_dialog(),$f.mobile.ajax({url:"/api/v1/forms/get/"+n+"?include_rules=true",dataType:"json",type:"POST",cache:!1,success:function(e){return x(this,void 0,void 0,(function(){var t,n;return E(this,(function(s){switch(s.label){case 0:return $f.mobile.notifications.hide_loading_dialog(),t=e.expanded_metadata,delete e.expanded_metadata,[4,Promise.resolve().then(i.bind(i,"./src/backbone/features/mobileForm/views.jsx"))];case 1:return n=s.sent(),$f.mobile.nav.show(n.SubmittedFormPage,{collection:new o.M5(e),use_transitions:!0,expanded_metadata:t}),[2]}}))}))},error:function(){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg()}}),!1},click_submit_task:function(e){var t=this;$f.mobile.notifications.show_loading_dialog(),$f.mobile.get_device_location({success:function(e){t.model.set("lat",e.coords.lat),t.model.set("lon",e.coords.lon),t.model.get("fulfillment").set("lat",e.coords.lat),t.model.get("fulfillment").set("lon",e.coords.lon)},error:function(e){$f.mobile.logging.log_event("couldnt get GPS")},complete:function(){$f.mobile.notifications.hide_loading_dialog(),t._click_submit_task(e)}})},_click_submit_task:function(e){var t=this;if($(e.target).hasClass("disabled")||$(e.target).attr("disabled"))return!1;if(this.model.is_missed()){var i=this.model.get_date_due(),n=_t("mobile_tasks_cannot_submit_missed");if(i){var s=$f.utils.get_full_formatted_time(i);n=_t("mobile_tasks_cannot_submit_missed_after",{date:s})}$f.mobile.notifications.show_error_msg(n)}else if(this.model.can_start()){if("processing"!==this.model.get("current_state")){if("form_submission"==this.model.get("reply").get("type")){var o=t.model.get("account");return $f.mobile.load_collection(this.model.get("reply").get("form_template").id,t.model.get("id"),!0,(function(e){var i=t.model.get("project"),n=e.where({type:"account"}),s={task:{id:t.model.get("id"),title:t.model.get("title"),account_id:t.model.get("account")&&t.model.get("account").id}};i&&(s.project={id:i.get("id"),title:i.get("title")}),e.smetadata.set(s),o&&1==n.length&&(o=o.toJSON(),e.get(n.pop().id).set({value:o.id,account:o}))})),!1}return"quick"!=this.model.get("reply").get("type")||this.model.get("fulfillment").get("fields")[0].isValid(!0)?($f.mobile.pending_task_submissions.add_records(this.model,(function(){t.model.mark_as_complete_in_caches((function(){$f.mobile.is.native()&&$f.mobile.nav.go_back(),$f.mobile.uploads.start_upload({success:function(){$f.mobile.is.web()&&$f.mobile.nav.go_back()},msg:_t("mobile_message_task_detials_success_task_complete")})}))}),(function(){$f.mobile.notifications.show_error_msg(_t("mobile_message_task_detials_error_submit_task_pending"))})),!1):($f.mobile.notifications.show_error_msg(_t("mobile_message_task_detials_error_submit_task")),!1)}var a=_t("mobile_tasks_cannot_submit_processing");$f.mobile.notifications.show_error_msg(a)}else{var r=_t("mobile_tasks_cannot_submit_upcoming");$f.mobile.notifications.show_error_msg(r)}},_show_cooldown_stages:function(){return x(this,void 0,void 0,(function(){var e;return E(this,(function(t){switch(t.label){case 0:return[4,Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/sensors/views.js"))];case 1:return e=t.sent().CooldownStageListViewForTask,this.r_cooldown_stages.show(new e({collection:this.model.get("cooldown").get("stages")})),[2]}}))}))}}),Te=Backbone.Marionette.Layout.extend({template:"#tpl_login",active_locale:b.Z.DEFAULT_LOCALE,selected_form:null,show_password:!1,email_prefill:null,password_prefill:null,login_as_prefill:null,regions:{r_language_selector:".language_selector"},events:{"click .signup_btn":"show_signup","click .forgot_password_btn":"forgot_password","click .login_btn":"show_login","submit #signup_form":"signup_submit","submit #login_form":"login_submit","click .login_as_test":"login_as_test","click #login_continue":"login_continue","click .change_email_btn":"change_email","click .force_oauth_logout":"force_logout","keypress input[name='email']":"handle_continue_keypress"},templateHelpers:function(){return{show_password:this.show_password,email_prefill:this.email_prefill,password_prefill:this.password_prefill,login_as_prefill:this.login_as_prefill,version_info:$f.mobile.get_version_string()}},initialize:function(e){e=e||{},$.extend(this,e),$f.mobile.notifications.hide_loading_dialog()},onShow:function(){this._set_status_bar_color()},onRender:function(){this._set_status_bar_color();var e=$.get_url_var("invite"),t=this;this.r_language_selector.show(new O({active_locale:t.active_locale,on_select:function(e){t.active_locale=e,$f.mobile.localization.set_locale(e,!0,(function(){t.render()}))}})),e&&e.length>4&&(this.$el.find('input[name="invite_code"]').val(e.trim().replace(/\//g,"")).hide(),$f.user.invite.sms_number&&$f.user.invite.sms_number.length>0&&this.$el.find('input[name="phone"]').val($f.user.invite.sms_number),$f.user.invite.email&&$f.user.invite.email.length>0&&this.$el.find('input[name="email"]').val($f.user.invite.email),this.$el.find("#login_form").hide(),this.show_signup()),$f.mobile.is_oia_dialog_overdue((function(e){e&&$f.mobile.nav.show_modal(q,{})})),"login"===this.selected_form?this.show_login():"signup"===this.selected_form&&this.show_signup();var i=this.$el.find("input[type=password]");this.show_password&&!i.val()&&i.first().focus()},forgot_password:function(){return $f.mobile.open_uri($f.base_url+"/password_reset"),!1},show_signup:function(e){var t=this;return this.$el.find("#login_form, #show_signup_btn_wrapper").fadeOut("fast",(function(){t.$el.find(".page_scrollable").scrollTop(0),t.$el.find("#signup_form, #show_login_btn_wrapper").fadeIn("fast")})),this.selected_form="signup",this.r_language_selector.currentView.render(),!1},show_login:function(e){var t=this;return this.$el.find("#signup_form, #show_login_btn_wrapper, #login_form .splash").fadeOut("fast",(function(){t.$el.find(".page_scrollable").scrollTop(0),t.$el.find("#login_form .login, #login_form, #show_signup_btn_wrapper").fadeIn("fast")})),this.selected_form="login",this.r_language_selector.currentView.render(),!1},login_as_test:function(e){return"local"!==$f.deploy_env||(this.$el.find('input[type="email"]').val("test@zenput.com"),this.$el.find('input[type="password"]').val("zenput")),!1},signup_submit:function(e){e.stopPropagation(),e.preventDefault();var t=$(e.target),i={invite_code:t.find('input[name="invite_code"]').val(),first_name:t.find('input[name="first_name"]').val(),last_name:t.find('input[name="last_name"]').val(),email:t.find('input[name="email"]').val(),phone:t.find('input[name="phone"]').val(),password:t.find('input[name="password"]').val(),password_confirm:t.find('input[name="password_confirm"]').val(),locale:this.active_locale};return $f.mobile.notifications.show_loading_dialog(),$f.mobile.ajax({url:"/api/v1/users/authorize_invite/",timeout:15e3,dataType:"json",type:"POST",cache:!1,data:JSON.stringify(i),success:function(e){$f.mobile.localization.set_locale(i.locale,!0,(function(){if($f.mobile.is.native())$f.mobile.login();else{try{var t=e.results;if((t.is_owner||t.is_admin||t.is_manager)&&$f.mobile.is.web())return void(window.location="/home/")}catch(e){}$f.mobile.login()}}))},error:function(e){$f.mobile.notifications.hide_loading_dialog(),$f.mobile.notifications.show_error_msg(e&&e.message,null,6e3)}}),!1},login_continue:function(e){var t=this,i=this.$el.find("input[name=email]"),n=this.$el.find("input[type=password]"),s=this.$el.find("input[name=login_as]"),o=i.val();if(!o||i.get(0).checkValidity&&!i.get(0).checkValidity())return $f.mobile.notifications.show_error_msg(_t("mobile_login_no_email_error"));this.$el.find(".oauth-login-error-sub-message").hide(),(0,y.H)(o,(function(e){var i=e.message;if(e.success&&i){var a=i.sp_type,r=i.idp_entity_id,l=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i}(i,["sp_type","idp_entity_id"]),_=l.state;if(t.$el.find(".login").hide(),t.$el.find(".oauth-intermediary").show(),"djangosaml2"===a){if($f.mobile.is.web()){var c=encodeURIComponent("/api/v3/sso/process_login/mobile_web/?token=".concat(_));return void(window.location.href="/saml2/login/?idp=".concat(r,"&next=").concat(c))}return void setTimeout((function(){(0,h.B)(r,_)}),1500)}setTimeout((function(){$f.utils.auth0.authorize(l)}),1500)}else t.show_password=!0,t.email_prefill=o,t.password_prefill=n.val()||null,t.login_as_prefill=s.val()||null,t.render()}))},handle_continue_keypress:function(e){13==e.charCode&&this.login_continue()},change_email:function(){this.email_prefill=null,this.password_prefill=null,this.show_password=!1,this.render()},force_logout:function(e){e.preventDefault(),$f.utils.auth0.logout()},login_submit:function(e){var t=this,i=$(e.target);if(!$f.mobile.is.connected())return $f.mobile.notifications.show_offline_msg(),!1;var n={email:i.find('input[name="email"]').val(),password:i.find('input[name="password"]').val(),login_as:i.find('input[name="login_as"]').val(),locale:this.active_locale};return"test@zenput.com"==n.email&&"debug"==n.password?($f.mobile.debugging.enable(),this.$el.find(".logo").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500),setTimeout((function(){t.render()}),1e3),!1):($f.mobile.notifications.show_loading_dialog(),$f.mobile.ajax({url:"/api/v1/users/login/",dataType:"json",type:"POST",cache:!1,data:JSON.stringify(n),timeout:2e4,success:$f.mobile.login,error:function(e){e=e||{},$f.mobile.notifications.hide_loading_dialog(),$f.mobile.logging.log_event("Mobile Login Failure",{attempted_username:n.email,status_code:e.status,status_text:e.statusText,message:e.message,user_agent:navigator.userAgent}),$f.mobile.notifications.show_error_msg(e.message)}}),!1)},_set_status_bar_color:function(){(0,T.Q)("#191919")}}),xe=Backbone.Marionette.Layout.extend({template:"#tpl_tasks_legend_modal",attributes:{id:"tasks_legend_modal"},ANIMATION_TIME_MS:500,title:null,description:null,_close_trigger_els:null,templateHelpers:function(){return{title:this.title,description:this.description}},initialize:function(e){if(e=e||{},$.extend(this,e),!this.title)throw new Error("Programmer Error: TasksLegendModal must have a title")},onRender:function(){this._setup_close_events()},onShow:function(){var e=this;$f.mobile.nav.show_modal_touchblock({duration:e.ANIMATION_TIME_MS},(function(){e.close(),e.$el.css("opacity",0),e.$el.velocity({opacity:1},{duration:e.ANIMATION_TIME_MS/2})}))},close:function(){var e=arguments,t=this;this._destroy_close_events(),$f.mobile.nav.hide_modal_touchblock({duration:t.ANIMATION_TIME_MS}),t.$el.velocity({opacity:0},{duration:this.ANIMATION_TIME_MS/2,complete:function(){xe.__super__.close.apply(t,e)}})},_setup_close_events:function(){var e=this;this._close_trigger_els=this.$el.find(".modal_footer .close_modal"),this._destroy_close_events(),this._close_trigger_els.on("click",(function(t){e.close(t)}))},_destroy_close_events:function(){this._close_trigger_els.off("click")}}),Ee=l.mp.extend({template:"#tpl_company_status_page",inactive_display:!1,title:"",message:"",initialize:function(e){e=e||{},$.extend(this,e),$f.mobile.notifications.hide_loading_dialog(),this.messaging&&(this.title=this.messaging.title,this.message=this.messaging.message)},templateHelpers:function(){return{title:this.title,message:this._get_display_message()}},_get_display_message:function(){return this.message.replace(/(\w+@zenput\.com)/g,'<a href="mailto:$1">$1</a>')},show_back_button:function(){return!1},toolbarnav_title:"",onRender:function(){this.inactive_display||$f.active_company.fetch({force:!0,success:function(e){e.is_subscription_inactive()?$f.mobile.logout(!1):e.is_subscription_valid()&&Promise.resolve().then(i.bind(i,"./src/backbone-unorganized/dashboard/views.js")).then((function(e){$f.mobile.nav.show(e.MobileDashboard,{is_top_level_page:!0})}))}})}})}}]);
//# sourceMappingURL=bundle-9f7267ef246553901aca.mobile-f4193393.bundle.js.map